<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pay As You Mow | Professional Garden Maintenance</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #2e7d32;
            --primary-light: #4caf50;
            --primary-dark: #1b5e20;
            --secondary: #ff9800;
            --text: #333333;
            --text-light: #666666;
            --background: #f9f9f9;
            --white: #ffffff;
            --shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
            --header-height: 92px;
            --nav-backdrop: rgba(10, 18, 12, 0.58);
        }

        html {
            scroll-padding-top: calc(var(--header-height, 92px) + 16px);
        }

        .nav-backdrop {
            position: fixed;
            inset: 0;
            background: var(--nav-backdrop);
            opacity: 0;
            pointer-events: none;
            transition: opacity 200ms ease;
            z-index: 1040;
            backdrop-filter: blur(2px);
        }

        .nav-backdrop.visible {
            opacity: 1;
            pointer-events: auto;
        }

        body.nav-open {
            overflow: hidden;
        }

        /* Preloader Styles */
        #preloader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #2e7d32 0%, #4caf50 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease, visibility 0.5s ease;
        }

        #preloader.hidden {
            opacity: 0;
            visibility: hidden;
        }

        .preloader-content {
            text-align: center;
            color: white;
            animation: fadeInUp 0.8s ease;
        }

        .preloader-logo {
            font-size: 3rem;
            margin-bottom: 1rem;
            animation: bounce 2s infinite;
        }

        .preloader-title {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }

        .preloader-subtitle {
            font-size: 1.2rem;
            font-weight: 400;
            margin-bottom: 2rem;
            opacity: 0.9;
        }

        .progress-container {
            width: 300px;
            height: 6px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 1rem;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #ffb347, #ff7e5f);
            border-radius: 10px;
            width: 0%;
            transition: width 0.3s ease;
            box-shadow: 0 0 10px rgba(255, 179, 71, 0.5);
        }

        .progress-text {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-top: 0.5rem;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes bounce {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-20px);
            }
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            line-height: 1.6;
            color: var(--text);
            background-color: var(--background);
            overflow-x: hidden;
        }

        h1, h2, h3, h4 {
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
            line-height: 1.2;
            margin-bottom: 1rem;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        section {
            padding: 80px 0;
        }

        .btn {
            display: inline-block;
            padding: 12px 30px;
            background-color: var(--primary);
            color: var(--white);
            border: none;
            border-radius: 30px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            transition: var(--transition);
            text-decoration: none;
        }

        .btn:hover {
            background-color: var(--primary-dark);
            transform: translateY(-3px);
            box-shadow: var(--shadow);
        }

        .btn-secondary {
            background-color: var(--secondary);
        }

        .btn-secondary:hover {
            background-color: #f57c00;
        }

        .btn-quote {
            background: linear-gradient(135deg, #ffb347, #ff7e5f);
            padding: 10px 26px;
            font-size: 0.95rem;
            border-radius: 999px;
            box-shadow: 0 12px 22px rgba(255, 126, 95, 0.25);
            text-transform: none;
            letter-spacing: 0.5px;
        }

        .btn-quote:hover {
            background: linear-gradient(135deg, #ff9566, #ff5f6d);
            transform: translateY(-2px);
            box-shadow: 0 16px 28px rgba(255, 95, 109, 0.3);
        }

        .whatsapp-button {
            position: fixed;
            bottom: 120px;
            right: 32px;
            z-index: 1200;
            display: inline-flex;
            align-items: center;
            gap: 10.5px;
            padding: 12px 21px;
            background: linear-gradient(135deg, #25d366 0%, #128c7e 45%, #075e54 100%);
            color: var(--white);
            text-decoration: none;
            border-radius: 999px;
            box-shadow: 0 18px 35px rgba(7, 94, 84, 0.35);
            font-weight: 600;
            letter-spacing: 0.5px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            isolation: isolate;
        }

        .whatsapp-button::after {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: inherit;
            background: radial-gradient(circle at top left, rgba(255, 255, 255, 0.45), transparent 55%);
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
            z-index: 1;
        }

        .whatsapp-button:hover {
            transform: translateY(-6px) scale(1.02);
            box-shadow: 0 22px 40px rgba(7, 94, 84, 0.4);
        }

        .whatsapp-button:hover::after {
            opacity: 1;
        }

        .whatsapp-button .icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 31.5px;
            height: 31.5px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            font-size: 16.5px;
            box-shadow: inset 0 4px 10px rgba(0, 0, 0, 0.15);
        }

        .whatsapp-button .whatsapp-text {
            display: flex;
            flex-direction: column;
            line-height: 1.1;
        }

        .whatsapp-button .whatsapp-text span:first-child {
            font-size: 0.53rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            opacity: 0.85;
        }

        .whatsapp-button .whatsapp-text span:last-child {
            font-size: 0.79rem;
        }

        .live-chat-whatsapp {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 10px 16px;
            border-radius: 999px;
            background: linear-gradient(135deg, #25d366 0%, #128c7e 45%, #075e54 100%);
            color: var(--white);
            font-size: 0.85rem;
            font-weight: 600;
            text-decoration: none;
            box-shadow: 0 12px 24px rgba(7, 94, 84, 0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            margin-bottom: 18px;
        }

        .live-chat-whatsapp:focus-visible {
            outline: 3px solid rgba(37, 211, 102, 0.55);
            outline-offset: 3px;
        }

        .live-chat-whatsapp:hover {
            transform: translateY(-3px);
            box-shadow: 0 16px 28px rgba(7, 94, 84, 0.3);
        }

        .live-chat-whatsapp.is-highlighted {
            box-shadow: 0 18px 36px rgba(7, 94, 84, 0.35);
            transform: translateY(-2px) scale(1.01);
        }

        .live-chat-whatsapp .icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            font-size: 16px;
        }

        .chat-gardener {
            position: fixed;
            right: 116px;
            bottom: 34px;
            width: 132px;
            padding: 14px 16px 18px;
            border-radius: 28px;
            background: var(--white);
            box-shadow: 0 24px 44px rgba(26, 54, 35, 0.28);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            z-index: 1190;
            transform: translateY(12px) scale(0.92);
            opacity: 0;
            transition: opacity 0.3s ease, transform 0.3s ease;
            overflow: hidden;
            pointer-events: none;
        }

        .chat-gardener.visible {
            opacity: 1;
            transform: translateY(0) scale(1);
        }

        .chat-gardener::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 28px;
            background: linear-gradient(135deg, rgba(46, 125, 50, 0.06), rgba(255, 152, 0, 0.08));
            pointer-events: none;
        }

        .chat-gardener-inner {
            position: relative;
            z-index: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
        }

        .chat-gardener-illustration {
            width: 96px;
            height: 96px;
            border-radius: 24px;
            object-fit: cover;
            box-shadow: 0 14px 28px rgba(33, 64, 35, 0.28);
        }

        .chat-gardener-caption {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 999px;
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--primary-dark);
            background: rgba(76, 175, 80, 0.12);
            box-shadow: 0 10px 22px rgba(0, 0, 0, 0.12);
            z-index: 1;
        }

        .chat-gardener-caption::before {
            content: '\f0eb';
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
        }

        @media (min-width: 992px) {
            .whatsapp-button {
                display: none;
            }
        }

        @media (max-width: 991px) {
            .chat-gardener {
                display: none !important;
            }
        }

        /* Auto Quote Popup */
        .auto-quote-popup {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(8px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.4s ease, visibility 0.4s ease;
            padding: max(16px, env(safe-area-inset-top)) 16px max(16px, env(safe-area-inset-bottom));
        }

        .auto-quote-popup.visible {
            opacity: 1;
            visibility: visible;
        }

        .auto-quote-card {
            background: linear-gradient(145deg, #ffffff, #f8f9fa);
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 560px;
            width: 100%;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            max-height: calc(100dvh - 32px);
            transform: scale(0.9) translateY(30px);
            transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .auto-quote-popup.visible .auto-quote-card {
            transform: scale(1) translateY(0);
        }

        /* Appointments section */
        .appointments {
            padding: 70px 0;
            background: radial-gradient(circle at 20% 10%, rgba(76, 175, 80, 0.18), transparent 45%),
                radial-gradient(circle at 80% 0%, rgba(255, 152, 0, 0.12), transparent 40%),
                linear-gradient(180deg, rgba(255, 255, 255, 0.9), rgba(244, 248, 244, 0.9));
        }

        .appointments-shell {
            display: grid;
            grid-template-columns: 1fr;
            gap: 22px;
        }

        @media (min-width: 992px) {
            .appointments-shell {
                grid-template-columns: 1.05fr 1.35fr;
                gap: 30px;
                align-items: start;
            }
        }

        .appointments-intro {
            background: rgba(255, 255, 255, 0.92);
            border-radius: 24px;
            padding: 26px 26px;
            box-shadow: 0 20px 44px rgba(9, 35, 15, 0.12);
            border: 1px solid rgba(46, 125, 50, 0.12);
        }

        .appointments-eyebrow {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            font-weight: 800;
            font-size: 0.95rem;
            color: var(--primary-dark);
            letter-spacing: 0.02em;
            text-transform: uppercase;
            margin-bottom: 10px;
        }

        .appointments-intro h2 {
            margin: 0 0 10px;
            font-size: clamp(1.6rem, 3vw, 2.2rem);
            line-height: 1.1;
            color: var(--primary-dark);
        }

        .appointments-intro p {
            margin: 0 0 14px;
            color: var(--text);
        }

        .appointments-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 8px;
        }

        .appointments-meta span {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            border-radius: 999px;
            background: rgba(76, 175, 80, 0.10);
            border: 1px solid rgba(46, 125, 50, 0.14);
            color: var(--primary-dark);
            font-weight: 700;
            font-size: 0.92rem;
        }

        .appointments-grid {
            background: rgba(255, 255, 255, 0.72);
            border-radius: 24px;
            padding: 22px;
            border: 1px solid rgba(46, 125, 50, 0.12);
            box-shadow: 0 18px 40px rgba(9, 35, 15, 0.10);
        }

        .appointments-grid-header {
            display: flex;
            align-items: baseline;
            justify-content: space-between;
            gap: 12px;
            margin-bottom: 14px;
        }

        .appointments-grid-header h3 {
            margin: 0;
            font-size: 1.15rem;
            color: var(--primary-dark);
        }

        .appointments-grid-header p {
            margin: 0;
            color: var(--text-light);
            font-weight: 600;
            font-size: 0.95rem;
        }

        .appointments-help {
            margin-top: 16px;
            padding-top: 14px;
            border-top: 1px dashed rgba(46, 125, 50, 0.18);
            color: var(--text-light);
        }

        .appointments-help p {
            margin: 0 0 10px;
            font-weight: 700;
        }

        .appointments-help-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }

        .auto-quote-close {
            position: absolute;
            top: 16px;
            right: 16px;
            width: 36px;
            height: 36px;
            border: none;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: var(--text);
            transition: all 0.3s ease;
            z-index: 10;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .auto-quote-close:hover {
            background: var(--secondary);
            color: white;
            transform: rotate(90deg);
        }

        .auto-quote-header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            padding: 18px 22px;
            text-align: center;
            position: relative;
            overflow: hidden;
            flex: 0 0 auto;
            border-bottom: 1px solid rgba(255, 255, 255, 0.12);
        }

        .auto-quote-header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
            animation: shimmer 3s ease-in-out infinite;
        }

        @keyframes shimmer {
            0%, 100% { transform: translate(0, 0); }
            50% { transform: translate(20px, 20px); }
        }

        .auto-quote-icon {
            font-size: 34px;
            color: white;
            margin-bottom: 8px;
            display: inline-block;
            animation: bounce 2s ease-in-out infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .auto-quote-header h3 {
            color: white;
            font-size: 1.45rem;
            margin: 0;
            font-weight: 700;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .auto-quote-body {
            padding: 18px 18px;
            min-height: 160px;
            flex: 1 1 auto;
            overflow: auto;
            -webkit-overflow-scrolling: touch;
        }

        .auto-quote-content {
            min-height: 100%;
            display: flex;
            flex-direction: column;
        }

        /* Landscape layout on desktop: header left, questions right */
        @media (min-width: 720px) {
            .auto-quote-card {
                max-width: 860px;
                display: flex;
                flex-direction: row;
                align-items: stretch;
            }

            .auto-quote-header {
                width: 38%;
                text-align: left;
                display: flex;
                flex-direction: column;
                justify-content: center;
                padding: 22px 22px;
            }

            .auto-quote-header::before {
                opacity: 0.85;
            }

            .auto-quote-icon {
                margin-bottom: 10px;
                font-size: 36px;
            }

            .auto-quote-header h3 {
                font-size: 1.4rem;
                line-height: 1.15;
            }

            .auto-quote-body {
                width: 62%;
                padding: 20px 20px;
                min-height: 0;
            }

            .auto-quote-text {
                margin-bottom: 16px;
                text-align: left;
            }

            .auto-quote-text p {
                font-size: 1.02rem;
            }
        }

        .auto-quote-content {
            opacity: 1;
            transform: translateX(0) scale(1);
            transition: opacity 0.4s cubic-bezier(0.4, 0, 0.2, 1), 
                        transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .auto-quote-content.fading {
            opacity: 0;
            transform: translateX(-30px) scale(0.95);
        }

        .auto-quote-content.entering {
            opacity: 0;
            transform: translateX(30px) scale(0.95);
        }

        .auto-quote-content.entered {
            opacity: 1;
            transform: translateX(0) scale(1);
        }

        .auto-quote-text {
            text-align: center;
            margin-bottom: 18px;
        }

        .auto-quote-text p {
            font-size: 1.1rem;
            color: var(--text);
            line-height: 1.6;
            margin: 0;
        }

        .auto-quote-actions {
            display: flex;
            gap: 12px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .auto-quote-btn {
            padding: 14px 32px;
            border: none;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .auto-quote-btn-yes {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            min-width: 140px;
        }

        .auto-quote-btn-yes:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(46, 125, 50, 0.4);
        }

        .auto-quote-btn-no {
            background: linear-gradient(135deg, #6c757d, #5a6268);
            color: white;
            min-width: 140px;
        }

        .auto-quote-btn-no:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(108, 117, 125, 0.4);
        }

        .auto-quote-form {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .auto-quote-form.compact {
            gap: 12px;
        }

        .auto-quote-form-row {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        @media (min-width: 720px) {
            .auto-quote-form-row {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 12px;
            }
        }

        .auto-quote-form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .auto-quote-form.compact .auto-quote-form-group {
            gap: 6px;
        }

        .auto-quote-form-group label {
            font-weight: 600;
            color: var(--text);
            font-size: 0.95rem;
        }

        .auto-quote-form.compact .auto-quote-form-group label {
            font-size: 0.85rem;
        }

        .auto-quote-form-group input,
        .auto-quote-form-group select {
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 1rem;
            font-family: 'Montserrat', sans-serif;
            transition: all 0.3s ease;
            background: white;
        }

        .auto-quote-form.compact .auto-quote-form-group input,
        .auto-quote-form.compact .auto-quote-form-group select {
            padding: 9px 12px;
            border-radius: 10px;
            font-size: 0.95rem;
        }

        .auto-quote-form-group input:focus,
        .auto-quote-form-group select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(46, 125, 50, 0.1);
        }

        .auto-quote-submit {
            background: linear-gradient(135deg, var(--secondary), #f57c00);
            color: white;
            padding: 14px;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .auto-quote-form.compact .auto-quote-submit {
            padding: 12px;
            font-size: 1rem;
            margin-top: 4px;
        }

        .auto-quote-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 152, 0, 0.4);
        }

        .auto-quote-submit:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .auto-quote-feedback {
            text-align: center;
            padding: 12px;
            border-radius: 8px;
            margin-top: 12px;
            font-weight: 600;
            display: none;
        }

        .auto-quote-feedback.visible {
            display: block;
        }

        .auto-quote-feedback.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .auto-quote-feedback.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        @media (max-width: 576px) {
            .auto-quote-card {
                max-width: 100%;
                border-radius: 22px;
                max-height: calc(100dvh - 24px);
                border: 1px solid rgba(46, 125, 50, 0.12);
                box-shadow: 0 26px 70px rgba(0, 0, 0, 0.38);
            }

            .auto-quote-close {
                top: 12px;
                right: 12px;
                width: 42px;
                height: 42px;
                font-size: 20px;
            }

            .auto-quote-body {
                padding: 16px 16px;
            }

            .auto-quote-body::before {
                content: '';
                position: sticky;
                top: 0;
                display: block;
                height: 10px;
                margin: -16px -16px 10px;
                background: linear-gradient(180deg, rgba(255, 255, 255, 0.92), rgba(255, 255, 255, 0));
                pointer-events: none;
                z-index: 1;
            }

            .auto-quote-body::after {
                content: '';
                position: sticky;
                bottom: 0;
                display: block;
                height: 18px;
                margin: 12px -16px -16px;
                background: linear-gradient(0deg, rgba(255, 255, 255, 0.98), rgba(255, 255, 255, 0));
                pointer-events: none;
                z-index: 1;
            }

            .auto-quote-text {
                margin-bottom: 18px;
                text-align: left;
            }

            .auto-quote-text p {
                font-size: 1.02rem;
            }

            .auto-quote-actions {
                flex-direction: column;
                align-items: stretch;
                gap: 12px;
                position: sticky;
                bottom: 0;
                padding-top: 10px;
                padding-bottom: 10px;
                background: rgba(255, 255, 255, 0.86);
                backdrop-filter: blur(10px);
                z-index: 2;
            }

            .auto-quote-btn {
                width: 100%;
                min-width: 0;
            }

            .auto-quote-btn:active {
                transform: translateY(0) scale(0.99);
            }

            .auto-quote-submit {
                position: sticky;
                bottom: 0;
                z-index: 2;
                border-radius: 16px;
            }

            .auto-quote-header h3 {
                font-size: 1.5rem;
            }

            .auto-quote-btn {
                padding: 12px 24px;
                font-size: 0.95rem;
            }
        }

        @keyframes whatsapp-pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(37, 211, 102, 0.4);
            }
            70% {
                box-shadow: 0 0 0 18px rgba(37, 211, 102, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(37, 211, 102, 0);
            }
        }

        .whatsapp-button::before {
            content: '';
            position: absolute;
            inset: -6px;
            border-radius: inherit;
            border: 1px solid rgba(255, 255, 255, 0.25);
            animation: whatsapp-pulse 2.8s infinite;
            pointer-events: none;
            z-index: 0;
        }

        .live-chat-widget {
            position: fixed;
            bottom: 32px;
            right: 32px;
            z-index: 1250;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 14px;
            font-family: 'Montserrat', sans-serif;
        }

        .live-chat-toggle {
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            padding: 0;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: var(--white);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 14px 28px rgba(27, 94, 32, 0.3);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative;
        }

        .live-chat-toggle:hover {
            transform: translateY(-3px);
            box-shadow: 0 18px 34px rgba(27, 94, 32, 0.38);
        }

        .live-chat-toggle:focus-visible {
            outline: 3px solid rgba(255, 255, 255, 0.85);
            outline-offset: 3px;
        }

        .live-chat-toggle .live-chat-indicator {
            position: absolute;
            top: 7px;
            right: 7px;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #66bb6a;
            border: 2px solid rgba(255, 255, 255, 0.9);
            box-shadow: 0 0 0 4px rgba(102, 187, 106, 0.2);
            transition: background 0.3s ease, box-shadow 0.3s ease;
        }

        .live-chat-toggle .live-chat-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 26px;
            height: 26px;
            font-size: 1.15rem;
            pointer-events: none;
        }

        .live-chat-toggle .live-chat-label {
            display: none;
        }

        .live-chat-toggle.is-offline {
            background: linear-gradient(135deg, #9e9e9e 0%, #616161 100%);
            box-shadow: 0 18px 32px rgba(66, 66, 66, 0.28);
        }

        .live-chat-toggle.is-offline .live-chat-indicator {
            background: #ff6b6b;
            box-shadow: 0 0 0 6px rgba(255, 107, 107, 0.2);
        }

        .live-chat-toggle.has-unread::after {
            content: '';
            position: absolute;
            inset: -12px;
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.75);
            animation: live-chat-pulse 2.6s infinite;
            pointer-events: none;
        }

        @keyframes live-chat-pulse {
            0% {
                opacity: 0.75;
                transform: scale(0.85);
            }
            60% {
                opacity: 0;
                transform: scale(1.35);
            }
            100% {
                opacity: 0;
                transform: scale(1.35);
            }
        }

        .live-chat-window {
            position: absolute;
            bottom: 88px;
            right: 0;
            width: 360px;
            max-width: calc(100vw - 32px);
            max-height: calc(100vh - 160px);
            max-height: min(620px, calc(100vh - 160px));
            background: var(--white);
            border-radius: 22px;
            box-shadow: 0 30px 65px rgba(12, 28, 18, 0.32);
            overflow: hidden;
            opacity: 0;
            transform: translateY(16px);
            pointer-events: none;
            transition: opacity 0.25s ease, transform 0.25s ease;
            display: flex;
            flex-direction: column;
        }

        .live-chat-window.visible {
            opacity: 1;
            transform: translateY(0);
            pointer-events: auto;
        }

        .live-chat-header {
            background: linear-gradient(135deg, rgba(46, 125, 50, 0.96), rgba(67, 160, 71, 0.92));
            padding: 18px 22px;
            color: var(--white);
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 12px;
            flex-shrink: 0;
        }

        .live-chat-header strong {
            display: block;
            font-size: 1.05rem;
            letter-spacing: 0.4px;
        }

        .live-chat-header p {
            margin: 0;
            font-size: 0.85rem;
            opacity: 0.85;
        }

        .live-chat-close {
            border: none;
            background: rgba(255, 255, 255, 0.18);
            color: var(--white);
            border-radius: 50%;
            width: 34px;
            height: 34px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background 0.2s ease, transform 0.2s ease;
        }

        .live-chat-close:hover {
            background: rgba(255, 255, 255, 0.28);
            transform: rotate(90deg);
        }

        .live-chat-body {
            display: flex;
            flex-direction: column;
            flex: 1;
            min-height: 0;
            background: linear-gradient(180deg, rgba(249, 249, 249, 1) 0%, rgba(255, 255, 255, 1) 65%);
            overflow: hidden;
        }

        .live-chat-status-banner {
            display: none;
            padding: 12px 18px;
            font-size: 0.85rem;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        .live-chat-status-banner.visible {
            display: block;
        }

        .live-chat-status-banner.online {
            background: rgba(76, 175, 80, 0.12);
            color: var(--primary-dark);
        }

        .live-chat-status-banner.offline {
            background: rgba(255, 107, 107, 0.12);
            color: #c62828;
        }

        .live-chat-status-banner.error {
            background: rgba(255, 152, 0, 0.18);
            color: #e65100;
        }

        .live-chat-messages {
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            flex: 1;
            min-height: 0;
            overflow-y: auto;
        }

        .live-chat-empty {
            text-align: center;
            color: var(--text-light);
            font-size: 0.92rem;
            padding: 12px 8px 4px;
        }

        .live-chat-empty i {
            display: block;
            font-size: 1.5rem;
            color: var(--primary);
            margin-bottom: 8px;
        }

        .live-chat-empty.hidden {
            display: none;
        }

        .live-chat-message {
            display: flex;
            flex-direction: column;
            gap: 6px;
            max-width: 85%;
        }

        .live-chat-message.from-admin {
            align-self: flex-start;
        }

        .live-chat-message.from-visitor {
            align-self: flex-end;
        }

        .live-chat-message .message-bubble {
            padding: 10px 14px;
            border-radius: 18px;
            background: rgba(46, 125, 50, 0.12);
            color: var(--text);
            border: 1px solid rgba(46, 125, 50, 0.18);
            box-shadow: 0 8px 18px rgba(46, 125, 50, 0.12);
            white-space: pre-wrap;
            word-break: break-word;
        }

        .live-chat-message.typing .message-bubble {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            min-width: 52px;
        }

        .live-chat-message.typing .message-meta {
            font-style: italic;
        }

        .live-chat-message.from-visitor .message-bubble {
            background: linear-gradient(135deg, var(--secondary), #ff7e5f);
            color: var(--white);
            border-color: rgba(255, 126, 95, 0.4);
            box-shadow: 0 14px 26px rgba(255, 126, 95, 0.3);
        }

        .live-chat-message.autopilot .message-bubble {
            background: linear-gradient(135deg, rgba(48, 195, 166, 0.18), rgba(29, 164, 136, 0.32));
            border-color: rgba(48, 195, 166, 0.35);
            box-shadow: 0 12px 26px rgba(48, 195, 166, 0.22);
        }

        .live-chat-message.autopilot.typing .message-bubble {
            background: linear-gradient(135deg, rgba(48, 195, 166, 0.15), rgba(29, 164, 136, 0.25));
        }

        .live-chat-typing-dot {
            width: 7px;
            height: 7px;
            border-radius: 50%;
            background: currentColor;
            opacity: 0.2;
            animation: live-chat-typing 1s ease-in-out infinite;
        }

        .live-chat-typing-dot:nth-child(2) {
            animation-delay: 0.15s;
        }

        .live-chat-typing-dot:nth-child(3) {
            animation-delay: 0.3s;
        }

        @keyframes live-chat-typing {
            0%,
            80%,
            100% {
                opacity: 0.2;
                transform: translateY(0);
            }
            40% {
                opacity: 1;
                transform: translateY(-3px);
            }
        }

        .live-chat-message .message-meta {
            font-size: 0.75rem;
            color: var(--text-light);
            opacity: 0.9;
        }

        .live-chat-message.autopilot .message-meta {
            color: var(--primary);
        }

        .live-chat-form {
            padding: 16px 18px 18px;
            border-top: 1px solid rgba(0, 0, 0, 0.05);
            background: rgba(255, 255, 255, 0.95);
            display: flex;
            align-items: flex-end;
            gap: 12px;
            flex-shrink: 0;
        }

        .live-chat-form textarea {
            flex: 1;
            border: 1px solid rgba(46, 125, 50, 0.18);
            border-radius: 14px;
            padding: 10px 14px;
            font-family: 'Montserrat', sans-serif;
            font-size: 0.95rem;
            resize: none;
            min-height: 60px;
            max-height: 140px;
            background: rgba(249, 249, 249, 0.9);
            transition: border 0.2s ease, box-shadow 0.2s ease;
        }

        .live-chat-form textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(46, 125, 50, 0.2);
        }

        .live-chat-form button {
            border: none;
            border-radius: 14px;
            padding: 12px 18px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: var(--white);
            font-weight: 600;
            letter-spacing: 0.5px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .live-chat-form button:hover {
            transform: translateY(-2px);
            box-shadow: 0 16px 26px rgba(27, 94, 32, 0.32);
        }

        .live-chat-form button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .chat-invite-overlay {
            position: fixed;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 24px;
            background: rgba(6, 17, 11, 0.68);
            backdrop-filter: blur(6px);
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.35s ease;
            z-index: 1600;
        }

        .chat-invite-overlay.visible {
            opacity: 1;
            pointer-events: auto;
        }

        .chat-invite-overlay::before {
            content: '';
            position: absolute;
            width: 340px;
            height: 340px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(46, 125, 50, 0.45), transparent 65%);
            filter: blur(2px);
            animation: chat-invite-glow 3.6s ease-in-out infinite;
            z-index: -1;
        }

        .chat-invite-card {
            position: relative;
            max-width: 420px;
            width: 100%;
            padding: 32px 30px;
            border-radius: 24px;
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.98), rgba(236, 253, 243, 0.98));
            box-shadow: 0 40px 70px rgba(6, 31, 18, 0.35);
            text-align: center;
            color: var(--text);
            transform: translateY(24px) scale(0.95);
            opacity: 0;
            transition: transform 0.45s cubic-bezier(0.22, 1, 0.36, 1), opacity 0.45s ease;
            overflow: hidden;
        }

        .chat-invite-overlay.visible .chat-invite-card {
            transform: translateY(0) scale(1);
            opacity: 1;
        }

        .chat-invite-card::before {
            content: '';
            position: absolute;
            inset: -30%;
            background: conic-gradient(from 120deg, rgba(46, 125, 50, 0.14), transparent 45%, rgba(255, 152, 0, 0.18), transparent 70%);
            animation: chat-invite-shimmer 6s linear infinite;
            z-index: 0;
        }

        .chat-invite-content {
            position: relative;
            z-index: 1;
            display: flex;
            flex-direction: column;
            gap: 18px;
        }

        .chat-invite-title {
            font-size: 1.45rem;
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
            color: var(--primary-dark);
            text-shadow: 0 8px 22px rgba(46, 125, 50, 0.25);
        }

        .chat-invite-message {
            font-size: 1.02rem;
            line-height: 1.55;
            color: var(--text-light);
        }

        .chat-invite-actions {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .chat-invite-actions button {
            border: none;
            border-radius: 16px;
            padding: 14px 20px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.25s ease, box-shadow 0.25s ease, filter 0.25s ease;
            font-family: 'Montserrat', sans-serif;
        }

        .chat-invite-actions .chat-invite-accept {
            background: linear-gradient(135deg, var(--primary), #2e8b57 45%, #1b5e20 100%);
            color: var(--white);
            box-shadow: 0 24px 38px rgba(46, 125, 50, 0.35);
        }

        .chat-invite-actions .chat-invite-accept:hover {
            transform: translateY(-3px) scale(1.01);
            box-shadow: 0 32px 48px rgba(27, 94, 32, 0.38);
        }

        .chat-invite-actions .chat-invite-decline {
            background: rgba(255, 255, 255, 0.88);
            color: var(--primary-dark);
            border: 1px solid rgba(46, 125, 50, 0.3);
            box-shadow: 0 16px 26px rgba(46, 125, 50, 0.18);
        }

        .chat-invite-actions .chat-invite-decline:hover {
            transform: translateY(-2px);
            filter: brightness(1.02);
        }

        @keyframes chat-invite-glow {
            0%, 100% {
                transform: scale(0.85);
                opacity: 0.8;
            }
            50% {
                transform: scale(1.05);
                opacity: 1;
            }
        }

        @keyframes chat-invite-shimmer {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }

        .live-chat-form.is-disabled textarea {
            opacity: 0.6;
            cursor: not-allowed;
        }

        @media (max-width: 768px) {
            .whatsapp-button {
                display: none;
            }

            .live-chat-widget {
                right: 16px;
                bottom: 16px;
            }

            .live-chat-window {
                position: fixed;
                bottom: 84px;
                right: auto;
                left: 50%;
                width: min(340px, calc(100vw - 28px));
                max-width: calc(100vw - 28px);
                max-height: calc(100vh - 140px);
                transform: translate(-50%, 20px);
                border-radius: 20px;
            }

            .live-chat-window.visible {
                transform: translate(-50%, 0);
            }

            .live-chat-form textarea {
                min-height: 48px;
                max-height: 110px;
            }

            .chat-invite-overlay {
                padding: 18px;
            }

            .chat-invite-card {
                padding: 26px 22px;
            }

            .chat-invite-title {
                font-size: 1.3rem;
            }

            .chat-invite-message {
                font-size: 0.98rem;
            }
        }

        /* Header Styles */
        header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
            background: linear-gradient(135deg, #0a2010 0%, #163d1e 40%, #1e5c28 75%, #1a4d22 100%);
            box-shadow: 0 8px 32px rgba(5, 20, 10, 0.55), 0 1px 0 rgba(255, 215, 80, 0.18) inset;
            transition: var(--transition);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 215, 80, 0.14);
            overflow: hidden;
        }

        header::before {
            content: '';
            position: absolute;
            inset: 0;
            background:
                radial-gradient(ellipse 80% 60% at 0% 0%, rgba(255, 220, 60, 0.1) 0%, transparent 60%),
                radial-gradient(ellipse 50% 80% at 100% 100%, rgba(46, 125, 50, 0.18) 0%, transparent 65%);
            pointer-events: none;
            z-index: 1;
        }

        header.scrolled {
            padding: 10px 0;
            background: rgba(255, 255, 255, 0.98);
            border-bottom-color: rgba(46, 125, 50, 0.15);
            box-shadow: 0 12px 25px rgba(23, 61, 32, 0.15);
        }

        header.scrolled::before {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.65) 0%, rgba(46, 125, 50, 0.1) 65%);
            opacity: 0.85;
        }

        .header-container {
            position: relative;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 22px 0;
            gap: 40px;
            z-index: 2;
        }

        .logo {
            display: inline-flex;
            align-items: center;
            gap: 18px;
            text-decoration: none;
            letter-spacing: 0.5px;
            color: var(--white);
        }

        .logo-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 58px;
            height: 58px;
            border-radius: 18px;
            background: linear-gradient(135deg, rgba(56, 142, 60, 0.9), rgba(27, 94, 32, 0.9));
            padding: 10px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 14px 28px rgba(12, 53, 25, 0.32);
            isolation: isolate;
        }

        .logo-icon::before {
            content: '';
            position: absolute;
            inset: -12px;
            border-radius: 24px;
            background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.45), transparent 60%);
            z-index: 0;
            opacity: 0.8;
            filter: blur(12px);
        }

        .logo-icon::after {
            content: '';
            position: absolute;
            inset: 3px;
            border-radius: 15px;
            background: linear-gradient(135deg, rgba(220, 255, 199, 0.25), rgba(255, 255, 255, 0.05));
            z-index: 1;
            border: 1px solid rgba(255, 255, 255, 0.25);
        }

        .logo-icon svg {
            position: relative;
            z-index: 2;
            width: 100%;
            height: 100%;
        }

        .logo-wordmark {
            display: inline-flex;
            flex-direction: column;
            line-height: 1.05;
            font-family: 'Montserrat', sans-serif;
        }

        .logo-eyebrow {
            font-size: 0.6em;
            letter-spacing: 5px;
            text-transform: uppercase;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 4px;
        }

        .logo-title {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.42em;
            font-weight: 700;
            display: inline-flex;
            align-items: baseline;
            gap: 6px;
            color: var(--white);
        }

        .logo-title-text {
            display: inline-flex;
        }

        .logo-title .highlight {
            color: #ffe082;
        }

        .logo-tagline {
            font-size: 0.64em;
            letter-spacing: 3.2px;
            text-transform: uppercase;
            font-weight: 500;
            color: rgba(255, 255, 255, 0.7);
            margin-top: 6px;
        }

        header.scrolled .logo {
            color: var(--primary-dark);
        }

        header.scrolled .logo-icon {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.92), rgba(220, 255, 199, 0.9));
            box-shadow: 0 10px 22px rgba(23, 61, 32, 0.18);
        }

        header.scrolled .logo-icon::after {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.35), rgba(210, 255, 210, 0.25));
            border-color: rgba(46, 125, 50, 0.25);
        }

        header.scrolled .logo-eyebrow {
            color: var(--primary-light);
        }

        header.scrolled .logo-title {
            color: var(--primary);
        }

        header.scrolled .logo-title .highlight {
            color: var(--secondary);
        }

        header.scrolled .logo-tagline {
            color: var(--text-light);
        }

        nav ul {
            display: flex;
            list-style: none;
            align-items: center;
            gap: 24px;
        }

        nav ul li {
            position: relative;
        }

        nav ul li a {
            color: rgba(255, 255, 255, 0.85);
            text-decoration: none;
            font-weight: 600;
            letter-spacing: 0.4px;
            transition: var(--transition);
            padding: 6px 4px;
            display: inline-flex;
            align-items: center;
            position: relative;
        }

        nav ul li a::after {
            content: '';
            position: absolute;
            left: 0;
            bottom: -8px;
            width: 0;
            height: 3px;
            border-radius: 999px;
            background: linear-gradient(120deg, var(--secondary), #ffe082);
            transition: var(--transition);
        }

        nav ul li a:hover {
            color: var(--white);
        }

        nav ul li a:hover::after {
            width: 100%;
        }

        header.scrolled nav ul li a {
            color: var(--text);
        }

        header.scrolled nav ul li a:hover {
            color: var(--primary);
        }

        header.scrolled nav ul li a::after {
            background: linear-gradient(120deg, var(--primary), var(--secondary));
        }

        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            font-size: 26px;
            color: var(--white);
            cursor: pointer;
            transition: var(--transition);
        }

        .mobile-menu-btn:hover {
            transform: scale(1.05);
            color: var(--secondary);
        }

        header.scrolled .mobile-menu-btn {
            color: var(--primary);
        }

        /* Hero Section */
        .hero {
            position: relative;
            min-height: 80vh;
            color: var(--white);
            overflow: hidden;
            margin-top: clamp(12px, 2vw, 24px);
        }

        .hero-slide {
            --hero-image: none;
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 60px 20px 0;
            background-image: var(--hero-image);
            background-size: cover;
            background-position: center;
            opacity: 0;
            transform: scale(1.04);
            transition: opacity 1s ease, transform 8s ease;
            pointer-events: none;
        }

        .hero-slide::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(rgba(0, 0, 0, 0.55), rgba(0, 0, 0, 0.35));
            z-index: 1;
        }

        .hero-slide.active {
            opacity: 1;
            z-index: 2;
            transform: scale(1);
            pointer-events: auto;
        }

        .hero-slide .container {
            position: relative;
            z-index: 3;
            width: 100%;
        }

        .hero-content {
            max-width: 800px;
            margin: 0 auto;
            opacity: 0;
            transform: translateY(30px);
            transition: opacity 0.8s ease, transform 0.8s ease;
            text-align: center;
        }

        .hero-slide.active .hero-content {
            opacity: 1;
            transform: translateY(0);
        }

        .hero h1 {
            font-size: clamp(3rem, 4.2vw, 4.5rem);
            margin-bottom: 20px;
            text-shadow: 0 10px 25px rgba(0, 0, 0, 0.45);
            letter-spacing: 0.6px;
        }

        .hero-title-desktop {
            display: inline-flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            font-weight: 700;
            line-height: 1.1;
        }

        .hero-title-desktop .hero-title-line,
        .hero-title-desktop .hero-title-accent {
            display: block;
            padding: 0 18px;
            border-radius: 32px;
        }

        .hero-title-desktop .hero-title-line {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.8), rgba(255, 255, 255, 0.35));
            color: #103218;
            text-shadow: none;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        .hero-title-desktop .hero-title-accent {
            background: linear-gradient(135deg, rgba(255, 152, 0, 0.95), rgba(46, 125, 50, 0.85));
            color: var(--white);
            box-shadow: 0 12px 30px rgba(16, 50, 24, 0.45);
        }

        .hero-title-mobile {
            display: none;
            white-space: normal;
            width: 100%;
            max-width: 100%;
        }

        @media (max-width: 768px) {
            .hero-title-desktop {
                display: none;
            }

            .hero-title-mobile {
                display: inline;
            }
        }

        .hero p {
            font-size: 1.2rem;
            margin-bottom: 30px;
            max-width: 650px;
            margin-left: auto;
            margin-right: auto;
        }

        .hero-actions {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        /* Services Section */
        .services {
            background-color: var(--white);
        }

        .section-title {
            text-align: center;
            margin-bottom: 50px;
        }

        .section-title h2 {
            font-size: 2.5rem;
            color: var(--primary);
            position: relative;
            display: inline-block;
        }

        .section-title h2::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 3px;
            background-color: var(--secondary);
        }

        .services-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
        }

        .service-card {
            background-color: var(--white);
            border-radius: 24px;
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: var(--transition);
            display: flex;
            flex-direction: column;
        }

        .service-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.15);
        }

        .service-image {
            position: relative;
            width: 100%;
            padding-top: 62%;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .service-image img {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 100%;
            height: 100%;
            transform: translate(-50%, -50%) scale(1);
            object-fit: cover;
            object-position: center;
            filter: saturate(1.05);
            transition: transform 0.5s ease;
        }

        .service-card:hover .service-image img {
            transform: translate(-50%, -50%) scale(1.05);
        }

        .service-content {
            padding: 28px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            height: 100%;
        }

        .service-content h3 {
            font-size: 1.5rem;
            margin: 0;
        }

        .service-content p {
            color: var(--text-light);
            margin: 0;
        }

        /* Why Choose Section */
        .why-choose {
            position: relative;
            background: radial-gradient(circle at top left, rgba(255, 152, 0, 0.16), transparent 52%),
                        radial-gradient(circle at bottom right, rgba(46, 125, 50, 0.14), transparent 55%),
                        linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(249, 249, 249, 0.95));
            overflow: hidden;
        }

        .why-choose::before {
            content: "";
            position: absolute;
            top: -220px;
            left: -180px;
            width: 520px;
            height: 520px;
            background: radial-gradient(circle at center, rgba(46, 125, 50, 0.22), rgba(46, 125, 50, 0) 70%);
            opacity: 0.65;
            pointer-events: none;
        }

        .why-choose .container {
            position: relative;
            z-index: 1;
        }

        .why-board {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 16px;
            margin-top: 28px;
        }

        .why-note {
            background: rgba(255, 255, 255, 0.98);
            border-radius: 18px;
            padding: 18px 18px 16px;
            box-shadow: 0 18px 45px rgba(37, 68, 35, 0.12);
            border: 1px solid rgba(37, 68, 35, 0.1);
            position: relative;
            overflow: hidden;
        }

        .why-note::before {
            content: "";
            position: absolute;
            top: 12px;
            right: 14px;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: radial-gradient(circle at 35% 35%, rgba(255, 255, 255, 0.95), rgba(255, 152, 0, 0.85));
            box-shadow: 0 10px 18px rgba(255, 152, 0, 0.25);
        }

        .why-note::after {
            content: "";
            position: absolute;
            inset: 0;
            background: linear-gradient(145deg, rgba(46, 125, 50, 0.08), rgba(255, 255, 255, 0));
            pointer-events: none;
            opacity: 0.8;
        }

        .why-note h3 {
            margin: 0 0 8px;
            font-size: 1.05rem;
            color: var(--primary-dark);
            display: flex;
            align-items: center;
            gap: 10px;
            position: relative;
            z-index: 1;
        }

        .why-note h3 i {
            color: var(--secondary);
        }

        .why-note p {
            margin: 0;
            color: var(--text);
            font-weight: 500;
            line-height: 1.6;
            position: relative;
            z-index: 1;
        }

        .why-comparison {
            margin-top: 34px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 24px;
            box-shadow: 0 26px 65px rgba(37, 68, 35, 0.16);
            border: 1px solid rgba(37, 68, 35, 0.1);
            overflow: hidden;
        }

        .why-row {
            display: grid;
            grid-template-columns: minmax(200px, 1.15fr) minmax(200px, 1fr) minmax(200px, 1fr);
            gap: 0;
            align-items: stretch;
        }

        .why-row + .why-row {
            border-top: 1px solid rgba(37, 68, 35, 0.1);
        }

        .why-row.why-head {
            background: linear-gradient(135deg, rgba(46, 125, 50, 0.92), rgba(27, 94, 32, 0.92));
            color: var(--white);
        }

        .why-cell {
            padding: 16px 18px;
            display: flex;
            gap: 10px;
            align-items: flex-start;
            line-height: 1.5;
        }

        .why-head .why-cell {
            font-weight: 700;
            letter-spacing: 0.3px;
        }

        .why-cell.feature {
            font-weight: 700;
            color: var(--primary-dark);
            background: rgba(46, 125, 50, 0.06);
        }

        .why-head .why-cell.feature {
            background: transparent;
            color: var(--white);
        }

        .why-cell.you {
            background: rgba(76, 175, 80, 0.07);
        }

        .why-head .why-cell.you {
            background: rgba(255, 255, 255, 0.08);
        }

        .why-cell.other {
            background: rgba(0, 0, 0, 0.02);
        }

        .why-cell i {
            margin-top: 2px;
        }

        .why-cell.you i {
            color: var(--primary);
        }

        .why-cell.other i {
            color: rgba(0, 0, 0, 0.45);
        }

        .why-cta {
            margin-top: 26px;
            display: flex;
            justify-content: center;
            gap: 14px;
            flex-wrap: wrap;
        }

        .why-cta .btn {
            box-shadow: 0 16px 32px rgba(27, 94, 32, 0.18);
        }

        @media (max-width: 880px) {
            .why-row {
                grid-template-columns: 1fr;
            }

            .why-row.why-head {
                display: none;
            }

            .why-row-local {
                display: none;
            }

            .why-cell {
                padding: 14px 16px;
            }

            .why-cell.feature {
                border-bottom: 1px solid rgba(37, 68, 35, 0.08);
            }

            .why-cell.you,
            .why-cell.other {
                position: relative;
                padding-top: 34px;
            }

            .why-cell.you::before,
            .why-cell.other::before {
                content: attr(data-col);
                position: absolute;
                top: 12px;
                left: 16px;
                font-size: 0.78rem;
                text-transform: uppercase;
                letter-spacing: 0.1em;
                font-weight: 700;
                opacity: 0.75;
            }
        }

        /* About Section */
        .about {
            background-color: var(--background);
            padding-bottom: 56px;
        }

        .about-content {
            display: flex;
            align-items: center;
            gap: 50px;
            background: linear-gradient(135deg, rgba(103, 159, 87, 0.18) 0%, rgba(255, 255, 255, 0) 65%);
            border-radius: 18px;
            padding: 50px;
            position: relative;
            overflow: hidden;
        }

        .about-content::before {
            content: "";
            position: absolute;
            top: -40%;
            left: -20%;
            width: 55%;
            aspect-ratio: 1 / 1;
            background: radial-gradient(circle at center, rgba(255, 255, 255, 0.5) 0%, rgba(103, 159, 87, 0.25) 55%, rgba(103, 159, 87, 0) 80%);
            z-index: 0;
            opacity: 0.8;
            pointer-events: none;
        }

        .about-text {
            flex: 1;
            position: relative;
            z-index: 1;
        }

        .about-text p {
            text-align: justify;
        }

        .about-text .btn-quote {
            margin-top: 24px;
            font-size: 0.85rem;
            padding: 8px 22px;
        }

        .about-video {
            flex: 1;
            border-radius: 18px;
            overflow: hidden;
            box-shadow: 0 30px 60px rgba(37, 68, 35, 0.25);
            position: relative;
            background: radial-gradient(circle at top left, rgba(37, 68, 35, 0.35), rgba(37, 68, 35, 0.15) 45%, rgba(0, 0, 0, 0) 75%);
            isolation: isolate;
        }

        .about-video::before {
            content: "";
            position: absolute;
            inset: 0;
            background: linear-gradient(140deg, rgba(37, 68, 35, 0.4) 0%, rgba(37, 68, 35, 0.05) 60%, rgba(255, 255, 255, 0) 100%);
            mix-blend-mode: soft-light;
            pointer-events: none;
            z-index: 1;
        }

        .about-video .video-frame {
            width: 100%;
            height: 100%;
            border-radius: inherit;
            position: relative;
            z-index: 2;
        }

        /* FAQ Section */
        .faq {
            background-color: var(--background);
            padding-top: 56px;
        }

        .faq .section-title {
            margin-bottom: 32px;
        }

        .faq .section-title h2 {
            font-size: 2.2rem;
            letter-spacing: -0.01em;
        }

        .faq-intro {
            max-width: 760px;
            margin: 0 auto 36px;
            text-align: center;
            color: var(--text-light);
            font-size: 1rem;
            line-height: 1.65;
        }

        .faq-grid {
            display: grid;
            gap: 38px 60px;
            grid-template-columns: repeat(2, minmax(0, 1fr));
            align-items: stretch;
        }

        .faq-card {
            background-color: var(--white);
            border-radius: 22px;
            padding: 32px 34px;
            box-shadow: 0 22px 45px rgba(37, 68, 35, 0.12);
            border: 1px solid rgba(37, 68, 35, 0.08);
            position: relative;
            overflow: hidden;
        }

        .faq-card::before {
            content: "";
            position: absolute;
            inset: 0;
            border-radius: inherit;
            border-top: 4px solid rgba(46, 125, 50, 0.5);
            pointer-events: none;
            box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.35);
        }

        .faq-card h3 {
            font-size: 1.3rem;
            color: var(--text);
            margin-bottom: 14px;
        }

        .faq-card p {
            color: var(--text-light);
            font-size: 1rem;
            line-height: 1.75;
        }

        @media (max-width: 900px) {
            .faq-grid {
                grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
                gap: 32px;
            }

            .faq {
                padding-top: 48px;
            }
        }

        @media (max-width: 620px) {
            .about {
                padding-bottom: 48px;
            }

            .faq {
                padding-top: 44px;
            }

            .faq-grid {
                grid-template-columns: 1fr;
            }
        }

        .faq-card p + p {
            margin-top: 12px;
        }

        /* Video Showcase Section */
        .video-showcase {
            background: linear-gradient(135deg, rgba(37, 68, 35, 0.1) 0%, rgba(37, 68, 35, 0.3) 55%, rgba(37, 68, 35, 0.05) 100%);
            position: relative;
            overflow: hidden;
        }

        .video-showcase::before {
            content: "";
            position: absolute;
            top: -220px;
            right: -160px;
            width: 480px;
            height: 480px;
            background: radial-gradient(circle at center, rgba(255, 255, 255, 0.25) 0%, rgba(103, 159, 87, 0.4) 45%, rgba(37, 68, 35, 0) 75%);
            filter: blur(0px);
            opacity: 0.75;
            pointer-events: none;
        }

        .video-showcase::after {
            content: "";
            position: absolute;
            bottom: -180px;
            left: -120px;
            width: 380px;
            height: 380px;
            background: radial-gradient(circle at center, rgba(103, 159, 87, 0.3) 0%, rgba(103, 159, 87, 0.15) 40%, rgba(37, 68, 35, 0) 70%);
            opacity: 0.5;
            pointer-events: none;
        }

        .video-showcase .section-title h2 {
            font-size: 2.4rem;
        }

        .video-showcase .section-eyebrow {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            font-size: 0.78rem;
            text-transform: uppercase;
            letter-spacing: 0.12em;
            font-weight: 600;
            color: var(--primary-dark);
            background: rgba(255, 255, 255, 0.65);
            padding: 6px 18px;
            border-radius: 999px;
            box-shadow: 0 10px 30px rgba(37, 68, 35, 0.12);
        }

        .video-showcase .section-eyebrow i {
            color: var(--primary);
        }

        .video-showcase .section-title p {
            max-width: 680px;
            margin: 18px auto 0;
        }

        .video-grid {
            display: grid;
            grid-template-columns: repeat(3, minmax(0, 1fr));
            gap: 32px;
            position: relative;
            z-index: 1;
        }

        .video-card {
            background: rgba(255, 255, 255, 0.96);
            border-radius: 24px;
            padding: 26px 26px 32px;
            box-shadow: 0 24px 60px rgba(37, 68, 35, 0.22);
            border: 1px solid rgba(255, 255, 255, 0.6);
            position: relative;
            overflow: hidden;
            transition: transform 0.4s ease, box-shadow 0.4s ease;
        }

        .video-card::after {
            content: "";
            position: absolute;
            inset: 0;
            background: linear-gradient(145deg, rgba(103, 159, 87, 0.18), rgba(103, 159, 87, 0));
            opacity: 0;
            transition: opacity 0.4s ease;
            pointer-events: none;
        }

        .video-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 30px 70px rgba(37, 68, 35, 0.26);
        }

        .video-card:hover::after {
            opacity: 1;
        }

        .video-card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            position: relative;
            z-index: 2;
        }

        .video-card-label {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            padding: 6px 16px;
            border-radius: 999px;
            background: rgba(103, 159, 87, 0.12);
            color: var(--primary-dark);
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.08em;
        }

        .video-card-label i {
            color: var(--primary);
        }

        .video-card-metric {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text-light);
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .video-card-metric i {
            color: var(--primary);
        }

        .video-card h3 {
            font-size: 1.35rem;
            margin-bottom: 12px;
            color: var(--text);
            position: relative;
            z-index: 2;
        }

        .video-card p {
            color: var(--text-light);
            line-height: 1.7;
            margin-bottom: 22px;
            position: relative;
            z-index: 2;
        }

        .video-frame {
            border-radius: 18px;
            overflow: hidden;
            position: relative;
            aspect-ratio: 16 / 9;
            box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.45);
        }

        .video-frame::before {
            content: "";
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at top left, rgba(255, 255, 255, 0.4), rgba(255, 255, 255, 0));
            mix-blend-mode: soft-light;
            pointer-events: none;
            z-index: 1;
        }

        .video-frame iframe {
            width: 100%;
            height: 100%;
            border: 0;
            display: block;
            border-radius: inherit;
        }

        .video-thumbnail {
            position: absolute;
            inset: 0;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            border-radius: inherit;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease;
            cursor: pointer;
            pointer-events: none;
            z-index: 3;
        }

        .video-thumbnail::after {
            content: 'Replay video';
            font-size: 0.9rem;
            letter-spacing: 0.6px;
            text-transform: uppercase;
            color: var(--white);
            background: rgba(0, 0, 0, 0.65);
            padding: 10px 22px;
            border-radius: 999px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.25);
        }

        .video-thumbnail.visible {
            opacity: 1;
            visibility: visible;
            pointer-events: auto;
        }

        @media (max-width: 1024px) {
            .video-grid {
                grid-template-columns: repeat(2, minmax(0, 1fr));
            }
        }

        @media (max-width: 720px) {
            .video-grid {
                grid-template-columns: 1fr;
            }

            .video-showcase .section-title h2 {
                font-size: 2rem;
            }
        }

        /* Testimonials Section */
        .testimonials {
            background-color: var(--background);
        }

        .testimonials-slider {
            max-width: 800px;
            margin: 0 auto;
            position: relative;
        }

        .testimonial {
            background-color: var(--white);
            border-radius: 10px;
            padding: 40px;
            box-shadow: var(--shadow);
            text-align: center;
            display: none;
        }

        .testimonial.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .testimonial-text {
            font-style: italic;
            margin-bottom: 20px;
            font-size: 1.1rem;
        }

        .testimonial-author {
            font-weight: 600;
            color: var(--primary);
        }

        .testimonial-status {
            text-align: center;
            padding: 2rem 1.5rem;
            font-size: 1.05rem;
            color: rgba(0, 0, 0, 0.65);
        }

        .testimonial-status.error {
            color: #c53030;
        }

        .testimonial-nav {
            display: flex;
            justify-content: center;
            margin-top: 30px;
        }

        .testimonial-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: #ddd;
            margin: 0 5px;
            cursor: pointer;
            transition: var(--transition);
        }

        .testimonial-dot.active {
            background-color: var(--primary);
        }

        /* Booking Section */
        .booking {
            position: relative;
            background: radial-gradient(circle at top left, rgba(255, 255, 255, 0.12), transparent 45%),
                        linear-gradient(140deg, rgba(46, 125, 50, 0.95) 0%, rgba(27, 94, 32, 0.92) 55%, rgba(67, 160, 71, 0.9) 100%);
            color: var(--white);
            overflow: hidden;
        }

        .booking::before,
        .booking::after {
            content: '';
            position: absolute;
            width: 480px;
            height: 480px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.2), transparent 65%);
            filter: blur(0.5px);
            opacity: 0.45;
            z-index: 0;
        }

        .booking::before {
            top: -240px;
            right: -120px;
        }

        .booking::after {
            bottom: -220px;
            left: -160px;
        }

        .booking .container {
            position: relative;
            z-index: 1;
        }

        .booking-header {
            max-width: 780px;
            margin: 0 auto 60px;
            text-align: center;
        }

        .booking-eyebrow {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 9px 18px;
            border-radius: 999px;
            background: rgba(255, 255, 255, 0.12);
            font-size: 0.85rem;
            letter-spacing: 0.6px;
            text-transform: uppercase;
            color: rgba(255, 255, 255, 0.88);
            margin-bottom: 18px;
        }

        .booking-header h2 {
            font-size: 2.8rem;
            color: var(--white);
            margin-bottom: 18px;
        }

        .booking-header p {
            color: rgba(255, 255, 255, 0.85);
            font-size: 1.05rem;
        }

        .booking-content {
            display: grid;
            grid-template-columns: 1fr;
            gap: 32px;
            justify-items: center;
            align-items: start;
        }

        .booking-info {
            display: flex;
            flex-direction: column;
            gap: 20px;
            color: rgba(255, 255, 255, 0.85);
        }

        .booking-intro h3 {
            font-size: 2rem;
            color: var(--white);
            margin-bottom: 10px;
        }

        .booking-intro p {
            font-size: 1.05rem;
            line-height: 1.7;
        }

        .booking-highlights {
            list-style: none;
            margin: 0;
            padding: 0;
            display: grid;
            gap: 16px;
        }

        .booking-highlights li {
            position: relative;
            padding-left: 34px;
            line-height: 1.6;
        }

        .booking-highlights li::before {
            content: '\2713';
            position: absolute;
            left: 0;
            top: 4px;
            font-size: 1rem;
            color: #a5f2c6;
            background: rgba(165, 242, 198, 0.12);
            width: 22px;
            height: 22px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: inset 0 0 0 1px rgba(165, 242, 198, 0.28);
        }

        .booking-assurance {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 18px;
        }

        .booking-assurance .assurance-item {
            background: rgba(255, 255, 255, 0.12);
            padding: 18px 20px;
            border-radius: 18px;
            border: 1px solid rgba(255, 255, 255, 0.16);
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .booking-assurance .assurance-item strong {
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.7px;
            color: rgba(255, 255, 255, 0.7);
        }

        .booking-assurance .assurance-item span {
            font-size: 1.1rem;
            color: var(--white);
            font-weight: 600;
        }

        .booking-form-wrapper {
            max-width: 820px;
            width: 100%;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.14);
            border-radius: 26px;
            padding: 40px;
            backdrop-filter: blur(8px);
            box-shadow: 0 20px 45px rgba(9, 35, 15, 0.25);
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .booking-form-wrapper::after {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: inherit;
            border: 1px solid rgba(255, 255, 255, 0.18);
            pointer-events: none;
        }

        .booking-form {
            position: relative;
            z-index: 1;
        }

        .availability-grid-header {
            display: flex;
            flex-direction: column;
            gap: 6px;
            margin-bottom: 14px;
        }

        .availability-grid-header h3 {
            margin: 0;
            font-size: 1.15rem;
            color: var(--white);
        }

        .availability-grid-header p {
            margin: 0;
            color: rgba(255, 255, 255, 0.82);
            font-size: 0.95rem;
        }

        .availability-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 14px;
            position: relative;
            z-index: 1;
        }

        .availability-slot {
            width: 100%;
            text-align: left;
            border: 1px solid rgba(46, 125, 50, 0.18);
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.96), rgba(255, 255, 255, 0.88));
            border-radius: 16px;
            padding: 16px;
            cursor: pointer;
            transition: transform 0.18s ease, box-shadow 0.18s ease, border-color 0.18s ease;
            box-shadow: 0 14px 30px rgba(27, 94, 32, 0.12);
            position: relative;
            overflow: hidden;
        }

        .availability-slot::before {
            content: '';
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at top left, rgba(76, 175, 80, 0.18), transparent 55%);
            opacity: 0;
            transition: opacity 0.18s ease;
            pointer-events: none;
        }

        .availability-slot:hover {
            transform: translateY(-4px);
            border-color: rgba(46, 125, 50, 0.35);
            box-shadow: 0 18px 36px rgba(27, 94, 32, 0.16);
        }

        .availability-slot:hover::before {
            opacity: 1;
        }

        .availability-slot:focus-visible {
            outline: 3px solid rgba(255, 152, 0, 0.6);
            outline-offset: 3px;
        }

        .availability-slot .slot-label {
            display: block;
            font-weight: 700;
            font-size: 1.02rem;
            color: var(--primary-dark);
            margin-bottom: 6px;
            position: relative;
            z-index: 1;
        }

        .availability-slot .slot-sub {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            color: var(--text-light);
            position: relative;
            z-index: 1;
        }

        .availability-slot .slot-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 4px 10px;
            border-radius: 999px;
            font-size: 0.78rem;
            font-weight: 700;
            background: rgba(255, 152, 0, 0.14);
            color: #c96a00;
            border: 1px solid rgba(255, 152, 0, 0.22);
        }

        .availability-empty {
            grid-column: 1 / -1;
            padding: 16px;
            border-radius: 14px;
            background: rgba(255, 255, 255, 0.82);
            border: 1px dashed rgba(46, 125, 50, 0.2);
            color: var(--text-light);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--white);
            font-size: 0.95rem;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.9);
            color: var(--text);
            font-family: 'Montserrat', sans-serif;
            font-size: 1rem;
            transition: border 0.2s ease, box-shadow 0.2s ease;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: rgba(255, 255, 255, 0.5);
            box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.15);
        }

        .form-group select {
            cursor: pointer;
        }

        .form-hint {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.82);
            margin-top: 8px;
        }

        .form-hint i {
            margin-right: 6px;
            color: rgba(255, 255, 255, 0.9);
        }

        .booking-submit {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #ffb347, #ff7e5f);
            color: var(--white);
            border: none;
            border-radius: 12px;
            font-weight: 700;
            font-size: 1.05rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .booking-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 16px 28px rgba(255, 95, 109, 0.3);
        }

        .booking-submit:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .booking-response {
            margin-top: 20px;
            padding: 14px;
            border-radius: 12px;
            text-align: center;
            font-weight: 600;
            display: none;
        }

        .booking-response.visible {
            display: block;
        }

        .booking-response.success {
            background: rgba(76, 175, 80, 0.12);
            border: 1px solid rgba(76, 175, 80, 0.35);
            color: #1b5e20;
        }

        .booking-response.error {
            background: rgba(244, 67, 54, 0.12);
            border: 1px solid rgba(244, 67, 54, 0.35);
            color: #b71c1c;
        }

        body.modal-open {
            overflow: hidden;
        }

        .mobile-offer-popup {
            position: fixed;
            inset: 0;
            display: none;
            align-items: flex-start;
            justify-content: center;
            padding: 48px 20px 24px;
            background: rgba(10, 24, 14, 0.48);
            backdrop-filter: blur(6px);
            z-index: 2050;
            opacity: 0;
            transition: opacity 0.35s ease;
        }

        .mobile-offer-popup.visible {
            display: flex;
            opacity: 1;
        }

        .mobile-offer-card {
            position: relative;
            width: min(420px, 100%);
            background: var(--white);
            border-radius: 26px;
            box-shadow: 0 28px 60px rgba(15, 31, 16, 0.35);
            overflow: hidden;
            animation: mobileOfferPopupSlideUp 0.4s ease forwards;
        }

        .mobile-offer-visual {
            position: relative;
            width: 100%;
            aspect-ratio: 16 / 9;
            overflow: hidden;
        }

        .mobile-offer-visual img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .mobile-offer-content {
            padding: 22px 22px 26px;
            text-align: left;
        }

        .mobile-offer-content h3 {
            font-size: 1.65rem;
            color: var(--primary);
            margin-bottom: 12px;
        }

        .mobile-offer-content p {
            margin-bottom: 12px;
            color: var(--text);
            font-weight: 600;
        }

        .mobile-offer-list {
            list-style: none;
            display: grid;
            gap: 8px;
            padding: 0;
            margin: 0;
        }

        .mobile-offer-list li {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            color: var(--primary-dark);
        }

        .mobile-offer-list li::before {
            content: '\f058';
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            color: var(--secondary);
        }

        .mobile-offer-close {
            position: absolute;
            top: 12px;
            right: 12px;
            width: 36px;
            height: 36px;
            border: none;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.9);
            color: var(--primary);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 10px 24px rgba(0, 0, 0, 0.15);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .mobile-offer-close:hover {
            transform: translateY(-2px);
            box-shadow: 0 14px 28px rgba(0, 0, 0, 0.2);
        }

        .mobile-offer-close i {
            font-size: 1rem;
        }

        @keyframes mobileOfferPopupSlideUp {
            from {
                transform: translateY(40px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        @media (min-width: 769px) {
            .mobile-offer-popup {
                display: none !important;
            }
        }

        .character-popup {
            position: fixed;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 24px;
            background: rgba(12, 34, 24, 0.72);
            backdrop-filter: blur(8px);
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.35s ease;
            z-index: 1950;
        }

        .character-popup.visible {
            opacity: 1;
            pointer-events: auto;
        }

        .character-popup-card {
            position: relative;
            max-width: 560px;
            width: 100%;
            border-radius: 28px;
            overflow: hidden;
            background: radial-gradient(circle at top, rgba(255, 255, 255, 0.98), rgba(236, 253, 243, 0.98));
            box-shadow: 0 46px 80px rgba(8, 28, 16, 0.35);
            padding: 36px 32px 32px;
            display: grid;
            grid-template-columns: minmax(0, 1fr);
            gap: 26px;
        }

        .character-popup-close {
            position: absolute;
            top: 18px;
            right: 18px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            background: rgba(46, 125, 50, 0.1);
            color: var(--primary-dark);
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.3s ease, background 0.3s ease;
        }

        .character-popup-close:hover {
            background: rgba(46, 125, 50, 0.2);
            transform: rotate(90deg);
        }

        .character-popup-body {
            display: grid;
            grid-template-columns: 220px minmax(0, 1fr);
            gap: 24px;
            align-items: center;
        }

        .character-popup-illustration {
            width: 100%;
            max-width: 220px;
            aspect-ratio: 1 / 1;
            border-radius: 22px;
            box-shadow: 0 26px 48px rgba(21, 64, 42, 0.28);
            animation: character-float 6s ease-in-out infinite;
        }

        @keyframes character-float {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-10px);
            }
        }

        .character-popup-content {
            display: flex;
            flex-direction: column;
            gap: 14px;
        }

        .character-popup-eyebrow {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 14px;
            border-radius: 999px;
            background: rgba(46, 125, 50, 0.12);
            color: var(--primary-dark);
            font-weight: 600;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.6px;
        }

        .character-popup-title {
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
            font-size: 1.9rem;
            color: var(--primary-dark);
            line-height: 1.2;
        }

        .character-popup-copy {
            color: var(--text-light);
            line-height: 1.7;
        }

        .character-popup-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-top: 6px;
        }

        .character-popup-actions .btn {
            text-transform: none;
            letter-spacing: 0.5px;
        }

        .character-popup-secondary {
            background: rgba(46, 125, 50, 0.1);
            color: var(--primary-dark);
        }

        .character-popup-secondary:hover {
            background: rgba(46, 125, 50, 0.18);
        }

        @media (max-width: 720px) {
            .character-popup-card {
                padding: 28px 24px;
            }

            .character-popup-body {
                grid-template-columns: minmax(0, 1fr);
                text-align: center;
            }

            .character-popup-illustration {
                margin: 0 auto;
            }

            .character-popup-actions {
                justify-content: center;
            }
        }

        @media (max-width: 480px) {
            .character-popup-card {
                border-radius: 22px;
            }

            .character-popup-title {
                font-size: 1.6rem;
            }
        }

        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(15, 23, 42, 0.55);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            z-index: 2000;
        }

        .modal-overlay.visible {
            opacity: 1;
            pointer-events: auto;
        }

        .booking-thanks-overlay {
            position: fixed;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 24px;
            background: rgba(15, 23, 42, 0.55);
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            z-index: 2200;
        }

        .booking-thanks-overlay.visible {
            opacity: 1;
            pointer-events: auto;
        }

        .booking-thanks-card {
            position: relative;
            max-width: 460px;
            width: 100%;
            background: linear-gradient(135deg, #fff7ed, #fff);
            border-radius: 24px;
            padding: 32px 30px 28px;
            box-shadow: 0 35px 70px rgba(15, 23, 42, 0.2);
            overflow: hidden;
        }

        .booking-thanks-card::after {
            content: "";
            position: absolute;
            inset: -90px auto auto -60px;
            width: 240px;
            height: 240px;
            background: radial-gradient(circle at center, rgba(255, 152, 0, 0.2), transparent 60%);
            z-index: 0;
        }

        .booking-thanks-emoji {
            width: 70px;
            height: 70px;
            border-radius: 18px;
            background: #fff;
            display: grid;
            place-items: center;
            font-size: 32px;
            box-shadow: 0 12px 26px rgba(255, 152, 0, 0.2);
            margin-bottom: 14px;
            position: relative;
            z-index: 1;
        }

        .booking-thanks-title {
            font-size: 1.6rem;
            color: var(--text);
            margin-bottom: 8px;
            position: relative;
            z-index: 1;
        }

        .booking-thanks-text {
            color: var(--text-light);
            line-height: 1.6;
            font-size: 1rem;
            margin-bottom: 18px;
            position: relative;
            z-index: 1;
        }

        .booking-thanks-close {
            position: relative;
            z-index: 1;
            background: linear-gradient(135deg, #ff9800, #ffb74d);
            color: var(--white);
            border: none;
            border-radius: 999px;
            padding: 12px 20px;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 18px 30px rgba(255, 152, 0, 0.25);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .booking-thanks-close:hover,
        .booking-thanks-close:focus-visible {
            transform: translateY(-2px);
            box-shadow: 0 22px 40px rgba(255, 152, 0, 0.35);
            outline: none;
        }

        .modal-card {
            position: relative;
            width: min(440px, 96%);
            background: var(--white);
            border-radius: 24px;
            box-shadow: 0 40px 70px rgba(15, 23, 42, 0.25);
            padding: 28px;
            overflow: hidden;
        }

        .modal-card::before {
            content: "";
            position: absolute;
            inset: -80px -120px auto auto;
            width: 240px;
            height: 240px;
            background: radial-gradient(circle at center, rgba(76, 175, 80, 0.18), transparent 60%);
            z-index: 0;
        }

        .modal-close {
            position: absolute;
            top: 18px;
            right: 18px;
            width: 38px;
            height: 38px;
            border-radius: 50%;
            border: none;
            background: rgba(46, 125, 50, 0.08);
            color: var(--primary-dark);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.3s ease, transform 0.3s ease;
            z-index: 2;
        }

        .modal-close:hover {
            background: rgba(46, 125, 50, 0.18);
            transform: rotate(90deg);
        }

        .modal-header {
            position: relative;
            z-index: 1;
            margin-bottom: 24px;
        }

        .modal-header .modal-eyebrow {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 14px;
            border-radius: 999px;
            background: rgba(46, 125, 50, 0.12);
            color: var(--primary-dark);
            font-weight: 600;
            font-size: 0.8rem;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }

        .modal-header h3 {
            font-size: 1.6rem;
            margin-top: 14px;
            margin-bottom: 8px;
        }

        .modal-header p {
            color: var(--text-light);
            line-height: 1.5;
        }

        .modal-header p strong {
            color: var(--primary-dark);
        }

        .modal-form {
            position: relative;
            z-index: 1;
            display: grid;
            gap: 18px;
        }

        .modal-feedback {
            border-radius: 12px;
            padding: 12px 14px;
            font-weight: 600;
            font-size: 0.95rem;
            display: none;
        }

        .modal-feedback.visible {
            display: block;
        }

        .modal-feedback.error {
            background: rgba(244, 67, 54, 0.12);
            color: #b71c1c;
        }

        .modal-group label {
            display: block;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 6px;
        }

        .modal-group input,
        .modal-group select {
            width: 100%;
            padding: 12px 14px;
            border-radius: 14px;
            border: 1px solid rgba(46, 125, 50, 0.18);
            background: rgba(255, 255, 255, 0.9);
            font-size: 1rem;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        .modal-group input:focus,
        .modal-group select:focus {
            outline: none;
            border-color: rgba(46, 125, 50, 0.55);
            box-shadow: 0 0 0 4px rgba(76, 175, 80, 0.15);
        }

        .modal-submit {
            margin-top: 10px;
            padding: 16px;
            border-radius: 16px;
            border: none;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: var(--white);
            font-weight: 700;
            font-size: 1.05rem;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .modal-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 18px 28px rgba(46, 125, 50, 0.25);
        }

        .modal-submit[disabled] {
            opacity: 0.7;
            cursor: not-allowed;
            box-shadow: none;
        }

        .booking-support {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 24px;
            margin-top: 60px;
        }

        .support-card {
            background: rgba(255, 255, 255, 0.12);
            padding: 26px;
            border-radius: 22px;
            backdrop-filter: blur(6px);
            box-shadow: 0 18px 40px rgba(10, 36, 15, 0.28);
            position: relative;
        }

        .support-card h3 {
            color: var(--white);
            margin-bottom: 12px;
            font-size: 1.25rem;
        }

        .support-card p {
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 14px;
        }

        .support-card form {
            display: grid;
            gap: 14px;
        }

        .support-card form .field-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
        }

        .support-card input,
        .support-card textarea {
            width: 100%;
            border: none;
            border-radius: 14px;
            padding: 12px 14px;
            font-size: 0.95rem;
            background: rgba(255, 255, 255, 0.2);
            color: var(--white);
            box-shadow: inset 0 2px 6px rgba(9, 30, 15, 0.2);
        }

        .support-card input::placeholder,
        .support-card textarea::placeholder {
            color: rgba(255, 255, 255, 0.75);
        }

        .support-card input:focus,
        .support-card textarea:focus {
            outline: none;
            box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.28);
        }

        .support-card textarea {
            min-height: 120px;
            resize: vertical;
        }

        .support-card .btn {
            background: var(--white);
            color: var(--primary);
            text-transform: none;
            letter-spacing: 0.5px;
        }

        .support-card .btn:hover {
            background: #f1f8e9;
            color: var(--primary-dark);
        }

        .support-card button[type="submit"] {
            background: var(--secondary);
            color: var(--white);
            border: none;
            border-radius: 999px;
            padding: 12px 24px;
            font-weight: 600;
            text-transform: none;
            letter-spacing: 0.5px;
            cursor: pointer;
            transition: var(--transition);
            justify-self: flex-start;
        }

        .support-card button[type="submit"]:hover {
            background: #f57c00;
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        /* Existing customer portal */
        .customer-portal {
            background: linear-gradient(180deg, rgba(46, 125, 50, 0.05), rgba(46, 125, 50, 0.12));
            padding: 80px 0;
        }

        .customer-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 24px;
        }

        .customer-card {
            background: var(--white);
            border-radius: 18px;
            box-shadow: var(--shadow);
            padding: 26px;
            border: 1px solid rgba(46, 125, 50, 0.1);
        }

        .customer-card h3 {
            margin-bottom: 6px;
        }

        .customer-card p {
            color: var(--text-light);
            margin-bottom: 12px;
        }

        .customer-login-form {
            display: grid;
            gap: 12px;
        }

        .customer-login-form input {
            padding: 12px 14px;
            border: 1px solid rgba(46, 125, 50, 0.25);
            border-radius: 12px;
            font-size: 1rem;
        }

        .customer-login-form button,
        .customer-booking-form button {
            width: 100%;
            padding: 12px;
            background: var(--primary);
            color: var(--white);
            border: none;
            border-radius: 12px;
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition);
        }

        .customer-login-form button:hover,
        .customer-booking-form button:hover {
            background: var(--primary-dark);
            box-shadow: var(--shadow);
        }

        .customer-login-status {
            margin-top: 8px;
            font-weight: 600;
        }

        .customer-login-status.error {
            color: #c62828;
        }

        .customer-login-status.success {
            color: var(--primary);
        }

        .customer-slot-list {
            display: grid;
            gap: 10px;
            margin: 18px 0;
        }

        .customer-slot {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px 16px;
            border: 1px solid rgba(46, 125, 50, 0.18);
            border-radius: 12px;
            background: rgba(76, 175, 80, 0.06);
        }

        .customer-slot button {
            padding: 8px 14px;
            border-radius: 10px;
            border: none;
            background: var(--secondary);
            color: var(--white);
            font-weight: 700;
            cursor: pointer;
        }

        .customer-slot button:hover {
            background: #f57c00;
        }

        .customer-booking-form {
            border-top: 1px solid rgba(46, 125, 50, 0.14);
            padding-top: 16px;
            display: grid;
            gap: 12px;
        }

        .customer-booking-form .field-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 12px;
        }

        .customer-booking-form input {
            padding: 12px 14px;
            border: 1px solid rgba(46, 125, 50, 0.25);
            border-radius: 12px;
        }

        .customer-selected-slot {
            font-weight: 700;
            color: var(--primary-dark);
        }

        .customer-locked {
            opacity: 0.65;
            pointer-events: none;
        }

        /* Footer */
        footer {
            background-color: var(--primary-dark);
            color: var(--white);
            padding: 60px 0 30px;
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 40px;
            margin-bottom: 40px;
        }

        .footer-column h3 {
            font-size: 1.3rem;
            margin-bottom: 20px;
            position: relative;
            padding-bottom: 10px;
        }

        .footer-column h3::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 40px;
            height: 2px;
            background-color: var(--secondary);
        }

        .footer-links {
            list-style: none;
        }

        .footer-links li {
            margin-bottom: 10px;
        }

        .footer-links a {
            color: #ccc;
            text-decoration: none;
            transition: var(--transition);
        }

        .footer-links a:hover {
            color: var(--white);
            padding-left: 5px;
        }

        .social-links {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .social-links a {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            color: var(--white);
            transition: var(--transition);
        }

        .social-links a:hover {
            background-color: var(--secondary);
            transform: translateY(-3px);
        }

        .footer-admin-link {
            color: #ccc;
            text-decoration: none;
            display: inline-block;
            margin-top: 12px;
            font-weight: 600;
            letter-spacing: 0.3px;
        }

        .footer-admin-link:hover,
        .footer-admin-link:focus-visible {
            color: var(--white);
            text-decoration: none;
            outline: none;
        }

        .copyright {
            text-align: center;
            padding-top: 30px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 0.9rem;
            color: #ccc;
        }

        /* Responsive Styles */
        @media (max-width: 992px) {
            .about-content {
                padding: 40px;
            }

            .faq-grid {
                gap: 28px;
            }

            .booking-content {
                grid-template-columns: 1fr;
                gap: 36px;
            }

            .booking-form-wrapper {
                margin: 0 auto;
            }

            .support-card {
                text-align: center;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding-left: 20px;
                padding-right: 20px;
            }

            section {
                padding: 60px 0;
            }

            header {
                overflow: visible;
                padding-top: env(safe-area-inset-top);
            }

            nav {
                z-index: 1050;
            }

            .hero {
                min-height: 100vh;
                overflow: visible;
                padding-top: 12px;
            }

            .hero-slide {
                align-items: flex-start;
                justify-content: flex-start;
                background-position: center 62%;
            }

            .hero-slide .container {
                padding-top: 140px;
                padding-bottom: 36px;
            }

            .hero-content {
                width: 100%;
                max-width: 420px;
                margin: 0 auto;
                padding: 26px 24px;
                border-radius: 24px;
                border: 1px solid rgba(255, 255, 255, 0.12);
                background: linear-gradient(150deg, rgba(0, 0, 0, 0.52), rgba(0, 0, 0, 0.2));
                gap: 18px;
                box-shadow: 0 22px 52px rgba(0, 0, 0, 0.38);
                backdrop-filter: blur(8px);
                display: flex;
                flex-direction: column;
                align-items: center;
                text-align: center;
                transition: opacity 1.4s ease, transform 1.4s ease;
            }

            .hero h1 {
                font-size: 2.6rem;
                line-height: 1.2;
            }

            .hero p {
                font-size: 1.08rem;
                line-height: 1.65;
            }

            .hero-actions {
                width: 100%;
                flex-direction: column;
                align-items: stretch;
                gap: 14px;
            }

            .hero-title-desktop {
                display: none;
            }

            .hero-title-mobile {
                display: block;
                width: 100%;
                max-width: 100%;
                padding: 0;
                border-radius: 0;
                font-size: clamp(1.4rem, 6vw, 2.2rem);
                line-height: 1.15;
                letter-spacing: 0.04em;
                text-transform: uppercase;
                font-weight: 700;
                color: #ffffff;
                background: none;
                border: none;
                box-shadow: none;
                text-shadow: 0 6px 18px rgba(0, 0, 0, 0.4);
                word-break: break-word;
            }

            .hero-title-mobile::after {
                content: none;
            }

            .hero-actions .btn {
                flex: 1 1 100%;
                min-width: 0;
                padding: 12px 18px;
                font-size: 0.95rem;
                border-radius: 20px;
            }

            .about-content {
                flex-direction: column;
                padding: 30px;
                gap: 35px;
            }

            .about-video {
                width: 100%;
                min-height: 200px;
            }

            .about-video .video-frame {
                height: auto;
                aspect-ratio: 16 / 9;
                min-height: 200px;
            }

            .faq .section-title h2 {
                font-size: 1.9rem;
            }

            .faq-intro {
                font-size: 0.95rem;
            }

            .faq-grid {
                gap: 24px;
            }

            .faq-card {
                padding: 28px 24px;
            }

            .faq-card h3 {
                font-size: 1.25rem;
            }

            .booking-intro h3 {
                font-size: 1.65rem;
            }

            .booking-assurance {
                grid-template-columns: 1fr 1fr;
            }

            .mobile-menu-btn {
                display: block;
            }

            .logo {
                gap: 14px;
            }

            .logo-icon {
                width: 68px;
                height: 68px;
                padding: 10px;
            }

            .header-container {
                gap: 24px;
                padding: 18px 0;
            }

            .logo {
                padding: 8px 16px;
                border-radius: 18px;
                background: linear-gradient(135deg, rgba(255, 255, 255, 0.12), rgba(255, 255, 255, 0.02));
                box-shadow: 0 20px 36px rgba(12, 53, 25, 0.28);
                position: relative;
                overflow: hidden;
                isolation: isolate;
            }

            .logo::before {
                content: '';
                position: absolute;
                inset: 0;
                background: linear-gradient(130deg, rgba(255, 255, 255, 0.18), rgba(255, 255, 255, 0));
                opacity: 0.65;
                pointer-events: none;
                z-index: 0;
            }

            .logo-icon {
                width: 50px;
                height: 50px;
                border-radius: 16px;
                box-shadow: 0 14px 28px rgba(12, 53, 25, 0.32);
                position: relative;
                z-index: 1;
            }

            .logo-title {
                font-size: 1.12em;
                flex-direction: row;
                align-items: center;
                gap: 6px;
                line-height: 1.08;
                padding: 0;
                border-radius: 0;
                background: transparent;
                border: none;
                box-shadow: none;
                backdrop-filter: none;
            }

            .logo-wordmark {
                position: relative;
                z-index: 1;
            }

            header.scrolled .logo {
                background: linear-gradient(135deg, rgba(46, 125, 50, 0.15), rgba(46, 125, 50, 0.03));
                box-shadow: 0 18px 30px rgba(23, 61, 32, 0.18);
            }

            header.scrolled .logo::before {
                background: linear-gradient(130deg, rgba(46, 125, 50, 0.22), rgba(255, 255, 255, 0));
                opacity: 0.75;
            }

            .logo-title-text,
            .logo-title .highlight {
                display: inline-flex;
                align-items: center;
                padding: 0;
                border-radius: 0;
                text-transform: none;
                letter-spacing: 0.02em;
                font-weight: 700;
            }

            .logo-title .highlight {
                color: #ffe082;
            }

            .logo-eyebrow {
                font-size: 0.64em;
                letter-spacing: 4.4px;
            }

            .logo-tagline {
                font-size: 0.56em;
                letter-spacing: 3px;
            }

            nav {
                position: fixed;
                left: 50%;
                right: auto;
                top: calc(var(--header-height, 92px) + 10px);
                width: min(300px, calc(100vw - 24px));
                background: linear-gradient(135deg, rgba(46, 125, 50, 0.99), rgba(26, 94, 32, 0.98));
                border-radius: 16px;
                border: 1px solid rgba(255, 255, 255, 0.14);
                box-shadow: 0 16px 36px rgba(0, 0, 0, 0.3);
                /* NOTE: backdrop-filter can make text look blurry on some mobile devices */
                backdrop-filter: none;
                -webkit-backdrop-filter: none;
                max-height: min(380px, calc(100vh - var(--header-height, 92px) - 24px));
                overflow: auto;
                opacity: 0;
                transform: translate(-50%, -10px) scale(0.985);
                pointer-events: none;
                transition: transform 200ms ease, opacity 200ms ease;
                z-index: 1090;
            }

            nav.active {
                opacity: 1;
                transform: translate(-50%, 0) scale(1);
                pointer-events: auto;
            }

            nav ul {
                flex-direction: column;
                padding: 8px;
                gap: 4px;
            }

            nav ul li {
                margin: 0;
                width: 100%;
            }

            nav ul li a {
                color: rgba(255, 255, 255, 0.92);
                font-size: 0.92rem;
                width: 100%;
                justify-content: space-between;
                padding: 9px 12px;
                border-radius: 12px;
                background: rgba(255, 255, 255, 0.12);
                text-shadow: 0 1px 0 rgba(0, 0, 0, 0.14);
            }

            .nav-backdrop {
                /* Keep dim, but remove blur to avoid any compositor weirdness on some phones */
                backdrop-filter: none;
                -webkit-backdrop-filter: none;
            }

            nav ul li a:hover,
            nav ul li a:focus-visible {
                background: rgba(255, 255, 255, 0.14);
                outline: none;
            }

            nav ul li a::after {
                content: none;
            }

            header.scrolled nav ul li a {
                color: rgba(255, 255, 255, 0.92);
            }

            .mobile-menu-btn {
                width: 40px;
                height: 40px;
                display: grid;
                place-items: center;
                border-radius: 16px;
                background: rgba(255, 255, 255, 0.12);
                border: 1px solid rgba(255, 255, 255, 0.14);
                box-shadow: 0 16px 28px rgba(12, 53, 25, 0.22);
                position: relative;
                z-index: 1100;
                pointer-events: auto;
            }

            .mobile-menu-btn {
                font-size: 22px;
            }

            header.scrolled .mobile-menu-btn {
                background: rgba(46, 125, 50, 0.12);
                border-color: rgba(46, 125, 50, 0.22);
                box-shadow: 0 14px 24px rgba(23, 61, 32, 0.18);
            }

            .section-title h2 {
                font-size: 2rem;
            }

            .service-content {
                padding: 24px;
            }

            .booking-header {
                margin-bottom: 40px;
            }

            .booking-header h2 {
                font-size: 2.3rem;
            }

            .booking-form-wrapper {
                padding: 30px;
            }

            .modal-card {
                padding: 30px 24px;
                border-radius: 22px;
            }

            .modal-header h3 {
                font-size: 1.55rem;
            }

            .modal-header p {
                font-size: 0.95rem;
            }

            .modal-group input,
            .modal-group select {
                padding: 12px 14px;
            }

            .modal-feedback {
                font-size: 0.9rem;
            }

            .form-hint {
                font-size: 0.85rem;
            }
        }

        @media (max-width: 640px) {
            .logo-eyebrow {
                display: none;
            }

            .logo {
                padding: 8px 14px;
            }

            .logo-icon {
                width: 46px;
                height: 46px;
            }

            .logo-title {
                font-size: 1.04em;
            }

            .logo-title-text,
            .logo-title .highlight {
                letter-spacing: 0.04em;
            }

            .logo-tagline {
                display: none;
            }

            .booking-info {
                display: none;
            }
        }

        @media (max-width: 576px) {
            .container {
                padding-left: 16px;
                padding-right: 16px;
            }

            section {
                padding: 48px 0;
            }

            .hero-slide {
                background-position: center 66%;
            }

            .hero-slide .container {
                padding-top: 120px;
                padding-bottom: 28px;
            }

            .hero-content {
                padding: 18px;
                border-radius: 18px;
                gap: 14px;
                border: 1px solid rgba(255, 255, 255, 0.1);
                background: linear-gradient(150deg, rgba(0, 0, 0, 0.36), rgba(0, 0, 0, 0.16));
            }

            .hero-actions {
                flex-direction: column;
                gap: 12px;
            }

            .hero-actions [aria-label="Existing customer login"] {
                display: none;
            }

            .hero h1 {
                font-size: 2.3rem;
            }

            .hero p {
                font-size: 1rem;
                line-height: 1.6;
            }

            .hero-actions .btn {
                font-size: 0.88rem;
                padding: 10px 15px;
                border-radius: 18px;
            }

            .btn {
                padding: 10px 18px;
            }

            .live-chat-window {
                max-height: calc(100vh - 120px);
                bottom: 78px;
                border-radius: 18px;
            }

            .live-chat-form {
                padding: 14px 16px 16px;
            }

            .live-chat-form textarea {
                min-height: 44px;
            }

            .service-content {
                padding: 20px;
            }

            .faq .section-title h2 {
                font-size: 1.7rem;
            }

            .faq-intro {
                font-size: 0.92rem;
            }

            .faq-card {
                padding: 26px 22px;
            }

            .faq-card h3 {
                font-size: 1.18rem;
            }

            .logo {
                font-size: 22px;
                gap: 12px;
            }

            .logo-icon {
                width: 56px;
                height: 56px;
                padding: 8px;
            }

            .logo-title {
                font-size: 0.96em;
            }

            .logo-title-text {
                letter-spacing: 0.02em;
            }

            .logo-title .highlight {
                margin-top: 1px;
            }

            .booking-header h2 {
                font-size: 2rem;
            }

            .booking-header p {
                font-size: 1rem;
            }

            .booking-content {
                gap: 28px;
            }

            .booking-assurance {
                grid-template-columns: 1fr;
            }

            .booking-form-wrapper {
                padding: 26px;
            }

            .live-chat-window {
                width: calc(100vw - 24px);
                max-width: calc(100vw - 24px);
            }
        }
    </style>
</head>
<body>
    <!-- Preloader -->
    <div id="preloader">
        <div class="preloader-content">
            <div class="preloader-logo" aria-label="Loading">
                <i class="fas fa-seedling" aria-hidden="true"></i>
            </div>
            <h1 class="preloader-title">Pay As You Mow</h1>
            <p class="preloader-subtitle">Professional Garden Maintenance</p>
            <div class="progress-container">
                <div class="progress-bar"></div>
            </div>
            <p class="progress-text">Loading 0%</p>
        </div>
    </div>

    <!-- Header -->
    <header id="header">
        <div class="container header-container">
            <a href="#" class="logo">
                <span class="logo-icon" aria-hidden="true">
                    <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" role="presentation" aria-hidden="true">
                        <defs>
                            <radialGradient id="logo-badge-gradient" cx="0.5" cy="0.2" r="0.85">
                                <stop offset="0%" stop-color="#f5ffe8" />
                                <stop offset="55%" stop-color="#b5f1a6" />
                                <stop offset="100%" stop-color="#1f6a28" />
                            </radialGradient>
                            <linearGradient id="logo-ground-gradient" x1="14" y1="46" x2="50" y2="56" gradientUnits="userSpaceOnUse">
                                <stop offset="0%" stop-color="#66bb6a" />
                                <stop offset="50%" stop-color="#2e7d32" />
                                <stop offset="100%" stop-color="#0c3f18" />
                            </linearGradient>
                            <linearGradient id="logo-stripe-gradient" x1="16" y1="42" x2="48" y2="48" gradientUnits="userSpaceOnUse">
                                <stop offset="0%" stop-color="rgba(255, 255, 255, 0.55)" />
                                <stop offset="100%" stop-color="rgba(255, 255, 255, 0)" />
                            </linearGradient>
                            <linearGradient id="logo-deck-gradient" x1="18" y1="36" x2="50" y2="48" gradientUnits="userSpaceOnUse">
                                <stop offset="0%" stop-color="#e0ffef" />
                                <stop offset="45%" stop-color="#47b46a" />
                                <stop offset="100%" stop-color="#0f5b2a" />
                            </linearGradient>
                            <linearGradient id="logo-top-gradient" x1="26" y1="30" x2="46" y2="38" gradientUnits="userSpaceOnUse">
                                <stop offset="0%" stop-color="#f4fff6" />
                                <stop offset="40%" stop-color="#9be8b8" />
                                <stop offset="100%" stop-color="#2a8150" />
                            </linearGradient>
                            <linearGradient id="logo-handle-gradient" x1="28" y1="14" x2="56" y2="30" gradientUnits="userSpaceOnUse">
                                <stop offset="0%" stop-color="#dffff3" />
                                <stop offset="50%" stop-color="#8be7c6" />
                                <stop offset="100%" stop-color="#2d9470" />
                            </linearGradient>
                            <radialGradient id="logo-wheel-gradient" cx="0.5" cy="0.45" r="0.7">
                                <stop offset="0%" stop-color="#ffffff" />
                                <stop offset="45%" stop-color="#b0bec5" />
                                <stop offset="100%" stop-color="#1b2429" />
                            </radialGradient>
                            <radialGradient id="logo-glow-gradient" cx="0.5" cy="0.1" r="0.9">
                                <stop offset="0%" stop-color="rgba(255, 255, 255, 0.65)" />
                                <stop offset="100%" stop-color="rgba(255, 255, 255, 0)" />
                            </radialGradient>
                        </defs>
                        <circle cx="32" cy="32" r="27" fill="url(#logo-badge-gradient)" />
                        <circle cx="32" cy="22" r="18" fill="url(#logo-glow-gradient)" opacity="0.65" />
                        <path d="M14 45c4.8 4 12 6 18 6s13.2-2 18-6v6H14z" fill="url(#logo-ground-gradient)" />
                        <path d="M18 43c4 2.4 8.8 3.6 14 3.6S42 45.4 46 43" fill="none" stroke="url(#logo-stripe-gradient)" stroke-width="3.2" stroke-linecap="round" opacity="0.8" />
                        <path d="M26.5 28.5L44 17.2c1.5-0.9 3.4-0.5 4.4 0.9l4.6 6.4c1 1.3 0.4 3.2-1.3 3.9l-7.9 3.1" fill="none" stroke="url(#logo-handle-gradient)" stroke-width="3.4" stroke-linecap="round" stroke-linejoin="round" />
                        <g>
                            <path d="M18.6 36.8h22.4c4.4 0 8.5 2.5 10.5 6.4l2.1 4.1c0.8 1.6-0.4 3.5-2.2 3.5H20.8c-1.2 0-2.3-0.7-2.7-1.8l-2.1-5.7c-1.1-3.1 1.2-6.5 4.6-6.5z" fill="url(#logo-deck-gradient)" />
                            <path d="M24.4 34.8h16.5c2 0 3.9 1.2 4.6 3.1l1.4 3.5H22.1l-0.8-2.4c-0.8-2.7 1.3-5.4 4-5.4z" fill="url(#logo-top-gradient)" />
                            <path d="M24 37c-2.8 0.6-4.6 3.4-3.9 6.2l0.6 2.2c0.3 1.1 1.3 1.9 2.4 1.9h20.4c1.2 0 2.2-0.8 2.5-2l0.5-2.6c0.5-2.8-1.5-5.5-4.3-5.9" fill="none" stroke="rgba(255, 255, 255, 0.28)" stroke-width="2.2" stroke-linecap="round" />
                        </g>
                        <circle cx="24.5" cy="47.2" r="4.8" fill="url(#logo-wheel-gradient)" />
                        <circle cx="42.8" cy="47.6" r="5.6" fill="url(#logo-wheel-gradient)" />
                        <circle cx="24.5" cy="47.2" r="1.6" fill="rgba(255, 255, 255, 0.65)" />
                        <circle cx="42.8" cy="47.6" r="1.9" fill="rgba(255, 255, 255, 0.6)" />
                        <path d="M20 30.4c3.2 1.4 6.6 1.4 9.8 0" fill="none" stroke="rgba(255, 255, 255, 0.5)" stroke-width="2.4" stroke-linecap="round" />
                        <path d="M23.2 20.8c2.5-1.8 5.4-2.9 8.6-3.1" fill="none" stroke="rgba(255, 255, 255, 0.38)" stroke-width="2.2" stroke-linecap="round" />
                        <path d="M44.2 24.5l2.6 3" stroke="rgba(255, 255, 255, 0.82)" stroke-width="2" stroke-linecap="round" />
                    </svg>
                </span>
                <span class="logo-wordmark">
                    <span class="logo-title"><span class="logo-title-text">Pay As You</span><span class="highlight">Mow</span></span>
                    <span class="logo-tagline">Audenshaw &bull; Denton &bull; Dukinfield</span>
                </span>
            </a>
            <button class="mobile-menu-btn" id="mobileMenuBtn" type="button" aria-label="Open menu" aria-controls="nav" aria-expanded="false">
                <i class="fas fa-bars"></i>
            </button>
            <nav id="nav">
                <ul>
                    <li><a href="#home">Home</a></li>
                    <li><a href="#services">My Services</a></li>
                    <li><a href="#why">Why Choose Me</a></li>
                    <li><a href="#about">About</a></li>
                    <li><a href="#faq">FAQ</a></li>
                    <li><a href="#testimonials">Testimonials</a></li>
                    <li><a href="#appointments">Book</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero" id="home">
        <div class="hero-slide active" style="--hero-image: url('/static/images/hero-mowing.svg');">
            <div class="container">
                <div class="hero-content">
                    <h1>
                        <span class="hero-title-desktop">Garden Maintenance Service</span>
                        <span class="hero-title-mobile">Garden Maintenance</span>
                    </h1>
                    <p>Probably the best rates in Tameside.</p>
                    <div class="hero-actions">
                        <a href="#appointments" class="btn">Get a Free Quote</a>
                        <a href="#services" class="btn btn-secondary">My Services</a>
                        <a href="/customer-login" class="btn btn-secondary" aria-label="Existing customer login">Customer Login</a>
                    </div>
                </div>
            </div>
        </div>
        <div class="hero-slide" style="--hero-image: url('/static/images/hero-weeding.svg');">
            <div class="container">
                <div class="hero-content">
                    <h1>
                        <span class="hero-title-desktop">Garden Maintenance Service</span>
                        <span class="hero-title-mobile">Garden Maintenance</span>
                    </h1>
                    <p>Detailed border care, weeding, and mowing tailored to your garden.</p>
                    <div class="hero-actions">
                        <a href="#appointments" class="btn">Get a Free Quote</a>
                        <a href="#services" class="btn btn-secondary">My Services</a>
                        <a href="/customer-login" class="btn btn-secondary" aria-label="Existing customer login">Customer Login</a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <div class="mobile-offer-popup" id="mobileOfferPopup" aria-hidden="true">
        <div class="mobile-offer-card" role="dialog" aria-modal="true" aria-labelledby="mobileOfferTitle" aria-describedby="mobileOfferCopy mobileOfferList">
            <button type="button" class="mobile-offer-close" id="mobileOfferClose" aria-label="Close special garden offer">
                <i class="fas fa-times" aria-hidden="true"></i>
            </button>
            <div class="mobile-offer-visual" aria-hidden="true">
                <img src="/static/images/offer-gardener.svg" alt="Smiling gardener standing with folded arms in front of a neatly trimmed hedge">
            </div>
            <div class="mobile-offer-content">
                <h3 id="mobileOfferTitle">Gardens from only £10</h3>
                <p id="mobileOfferCopy">Includes mowing, weeding, tidying borders, and bushes.</p>
                <ul class="mobile-offer-list" id="mobileOfferList">
                    <li>Mowing</li>
                    <li>Weeding</li>
                    <li>Tidying borders</li>
                    <li>Bushes</li>
                </ul>
            </div>
        </div>
    </div>

    <section class="services" id="services">
        <div class="container">
            <div class="section-title">
                <h2>My Services</h2>
                <p>Comprehensive garden care tailored to your needs</p>
            </div>
            <div class="services-grid">
                <div class="service-card">
                    <div class="service-image">
                        <img src="/static/images/service-lawn-mowing.svg" alt="Close-up of a freshly mowed lawn with a modern electric mower and no people">
                    </div>
                    <div class="service-content">
                        <h3>Lawn Mowing</h3>
                        <p>We provide regular mowing to keep your lawn neat and healthy. Grass is cut to the right length, and edges are trimmed for a clean, polished look. Routine care helps maintain a lush, green lawn.</p>
                    </div>
                </div>
                <div class="service-card">
                    <div class="service-image">
                        <img src="/static/images/service-hedge-trimming.svg" alt="Neatly trimmed hedges with electric shears resting nearby and no people present">
                    </div>
                    <div class="service-content">
                        <h3>Hedge Trimming</h3>
                        <p>We trim and shape hedges and bushes to maintain a tidy appearance. Overgrown branches are carefully removed for healthy growth. Regular pruning enhances your garden's overall beauty.</p>
                    </div>
                </div>
                <div class="service-card">
                    <div class="service-image">
                        <img src="/static/images/service-weed-control.svg" alt="Eco-friendly weed control tools arranged beside colorful flowerbeds with no people in view">
                    </div>
                    <div class="service-content">
                        <h3>Weed Control</h3>
                        <p>We keep your garden neat by removing weeds from flower beds, borders, and pathways. Edges are trimmed, debris is cleared, and plants are arranged to maintain a tidy and well-kept appearance.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Why Choose Section -->
    <section class="why-choose" id="why">
        <div class="container">
            <div class="section-title">
                <h2>Why Choose Us</h2>
            </div>

            <div class="why-comparison" role="table" aria-label="Comparison table: Pay As You Mow vs typical gardener">
                <div class="why-row why-head" role="row">
                    <div class="why-cell feature" role="columnheader">What matters</div>
                    <div class="why-cell you" role="columnheader">Pay As You Mow</div>
                    <div class="why-cell other" role="columnheader">Typical gardener</div>
                </div>

                <div class="why-row why-row-local" role="row">
                    <div class="why-cell feature" role="rowheader">Local &amp; dependable</div>
                    <div class="why-cell you" data-col="Pay As You Mow"><i class="fas fa-check" aria-hidden="true"></i> Focused on your area, so you're not "one of many" across a huge patch.</div>
                    <div class="why-cell other" data-col="Typical gardener"><i class="fas fa-minus" aria-hidden="true"></i> Covers a wider area, which can mean less flexibility.</div>
                </div>

                <div class="why-row" role="row">
                    <div class="why-cell feature" role="rowheader">Experience</div>
                    <div class="why-cell you" data-col="Pay As You Mow"><i class="fas fa-check" aria-hidden="true"></i> 15 years experience — you get a clean, consistent finish.</div>
                    <div class="why-cell other" data-col="Typical gardener"><i class="fas fa-minus" aria-hidden="true"></i> Experience varies from person to person.</div>
                </div>

                <div class="why-row" role="row">
                    <div class="why-cell feature" role="rowheader">Equipment</div>
                    <div class="why-cell you" data-col="Pay As You Mow"><i class="fas fa-check" aria-hidden="true"></i> Good equipment for neat edges and tidy borders.</div>
                    <div class="why-cell other" data-col="Typical gardener"><i class="fas fa-minus" aria-hidden="true"></i> Sometimes basic kit or rushed results.</div>
                </div>

                <div class="why-row" role="row">
                    <div class="why-cell feature" role="rowheader">Price</div>
                    <div class="why-cell you" data-col="Pay As You Mow"><i class="fas fa-check" aria-hidden="true"></i> Competitive pricing — lower than most for the time spent.</div>
                    <div class="why-cell other" data-col="Typical gardener"><i class="fas fa-minus" aria-hidden="true"></i> Often higher, with less time on the job.</div>
                </div>

                <div class="why-row" role="row">
                    <div class="why-cell feature" role="rowheader">Time &amp; care</div>
                    <div class="why-cell you" data-col="Pay As You Mow"><i class="fas fa-check" aria-hidden="true"></i> More time spent so it's done properly and looks right.</div>
                    <div class="why-cell other" data-col="Typical gardener"><i class="fas fa-minus" aria-hidden="true"></i> Quicker "in and out" visits to fit more jobs in.</div>
                </div>

                <div class="why-row" role="row">
                    <div class="why-cell feature" role="rowheader">Booking</div>
                    <div class="why-cell you" data-col="Pay As You Mow"><i class="fas fa-check" aria-hidden="true"></i> Book online any time — pick a slot that suits you.</div>
                    <div class="why-cell other" data-col="Typical gardener"><i class="fas fa-minus" aria-hidden="true"></i> Usually call/text and wait for availability.</div>
                </div>
            </div>

            <div class="why-cta">
                <a href="#appointments" class="btn btn-quote">Book your free quote visit</a>
                <a href="#services" class="btn btn-secondary">See services</a>
            </div>
        </div>
    </section>

    <!-- About Section -->
    <section class="about" id="about">
        <div class="container">
            <div class="section-title">
                <h2>About Andy</h2>
                <p>Friendly, professional garden maintenance across Audenshaw and Denton</p>
            </div>
            <div class="about-content">
                <div class="about-text">
                    <h3>Meet Your Gardener</h3>
                    <p>Hi, I'm Andy, a dedicated garden maintenance professional with 15 years of experience serving Audenshaw and Denton. I take pride in delivering high-quality service at competitive rates while helping customers maintain beautiful outdoor spaces.</p>
                    <p>Gardening is more than a job—it's my passion. I enjoy working in nature, meeting people, and staying active. As I operate part-time, availability is limited, but I always strive to accommodate my customers. If you're looking for a reliable gardener, feel free to get in touch!</p>
                    <a href="#appointments" class="btn btn-quote">Arrange a Free Quote</a>
                </div>
                <div class="about-video">
                    <div class="video-frame" data-video-id="oJrPPeow__s">
                        <iframe src="https://www.youtube.com/embed/oJrPPeow__s?si=4qciSvhRowzZ9yMh&amp;rel=0&amp;modestbranding=1&amp;enablejsapi=1" title="Pay As You Mow introduction video" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- FAQ Section -->
    <section class="faq" id="faq">
        <div class="container">
            <div class="section-title">
                <h2>FAQ</h2>
            </div>
            <p class="faq-intro">We know choosing the right gardener raises a few questions. Here are the answers we share with new clients all the time.</p>
            <div class="faq-grid">
                <article class="faq-card">
                    <h3>What areas do you cover?</h3>
                    <p>The areas I cover are Audenshaw, Denton and some areas of Dukinfield. If you live outside any of these areas, please get in touch and I will look into whether I can accommodate your area.</p>
                </article>
                <article class="faq-card">
                    <h3>Are you a registered business?</h3>
                    <p>Yes, I am a fully registered gardener and submit my accounts every year.</p>
                    <p>Payment for my services can be made by cash or online which adds convenience for my customers.</p>
                </article>
                <article class="faq-card">
                    <h3>How much do you charge?</h3>
                    <p>I constantly receive feedback that my rates are too low for the effort and attention I put into each job.</p>
                    <p>My rates for a small garden start from £10 per visit, which can be arranged on a regular basis throughout the gardening season or as a one-off tidy up.</p>
                    <p>I still prefer to see your garden first so I can give you an accurate price.</p>
                </article>
                <article class="faq-card">
                    <h3>What can you do for me?</h3>
                    <p>I can visit every few weeks or arrange a one-off visit to do a garden tidy.</p>
                    <p>My work involves keeping your yard looking fresh during the growing season. A typical visit includes mowing, weeding, tidying borders and hedge/bush trimming.</p>
                    <p>If you need other garden work doing then this can be arranged.</p>
                </article>
            </div>
        </div>
    </section>

    <!-- Testimonials Section -->
    <section class="testimonials" id="testimonials">
        <div class="container">
            <div class="section-title">
                <h2>Customer Testimonials</h2>
                <p>What our clients say about our services</p>
            </div>
            <div class="testimonials-slider" id="testimonialSlider">
                {% if reviews is defined and reviews %}
                    {% for review in reviews %}
                        <div class="testimonial{% if loop.first %} active{% endif %}">
                            <p class="testimonial-text">“{{ (review.quote or '') | e }}”</p>
                            <p class="testimonial-author">- {{ (review.author or 'Anonymous') | e }}{% if review.location %}, {{ review.location | e }}{% endif %}</p>
                        </div>
                    {% endfor %}
                    {% if reviews|length > 1 %}
                        <div class="testimonial-nav">
                            {% for review in reviews %}
                                <span class="testimonial-dot{% if loop.first %} active{% endif %}" data-index="{{ loop.index0 }}"></span>
                            {% endfor %}
                        </div>
                    {% endif %}
                {% else %}
                    <div class="testimonial-status" id="testimonialStatus">Loading testimonials…</div>
                {% endif %}
            </div>
        </div>
    </section>

    <!-- Booking section removed -->

    <div class="chat-invite-overlay" id="liveChatInviteOverlay" aria-hidden="true">
        <div class="chat-invite-card" role="dialog" aria-modal="true" aria-labelledby="liveChatInviteTitle" aria-describedby="liveChatInviteMessage">
            <div class="chat-invite-content">
                <h3 class="chat-invite-title" id="liveChatInviteTitle">Need a hand?</h3>
                <p class="chat-invite-message" id="liveChatInviteMessage">We're right here if you have any questions about your garden.</p>
                <div class="chat-invite-actions">
                    <button type="button" class="chat-invite-accept" id="liveChatInviteAccept">Start chatting</button>
                    <button type="button" class="chat-invite-decline" id="liveChatInviteDecline">Not right now</button>
                </div>
            </div>
        </div>
    </div>

    <div class="live-chat-widget" id="liveChatWidget">
        <button type="button" class="live-chat-toggle" id="liveChatToggle" aria-expanded="false">
            <span class="live-chat-indicator" id="liveChatIndicator" aria-hidden="true"></span>
            <span class="live-chat-icon" aria-hidden="true"><i class="fas fa-comments"></i></span>
            <span class="sr-only">Open live chat</span>
        </button>
        <div class="live-chat-window" id="liveChatWindow" aria-hidden="true">
            <div class="live-chat-header">
                <div>
                    <strong>Need a hand?</strong>
                    <p>Chat with Pay As You Mow</p>
                </div>
                <button type="button" class="live-chat-close" id="liveChatClose" aria-label="Close live chat">
                    <i class="fas fa-times" aria-hidden="true"></i>
                </button>
            </div>
            <div class="live-chat-body">
                <a href="https://wa.me/447595289669" class="live-chat-whatsapp" id="liveChatWhatsAppButton" target="_blank" rel="noopener">
                    <span class="icon"><i class="fa-brands fa-whatsapp" aria-hidden="true"></i></span>
                    <span>Chat via WhatsApp</span>
                </a>
                <div class="live-chat-status-banner visible online" id="liveChatStatusBanner">Typically replies within a few minutes.</div>
                <div class="live-chat-messages" id="liveChatMessages" role="log" aria-live="polite">
                    <div class="live-chat-empty" id="liveChatEmptyState">
                        <i class="fas fa-leaf" aria-hidden="true"></i>
                        <p>Ask us anything about your garden. We're here to help!</p>
                    </div>
                </div>
                <form class="live-chat-form" id="liveChatForm" novalidate>
                    <label for="liveChatInput" class="sr-only">Type your message</label>
                    <textarea id="liveChatInput" name="message" placeholder="Type your message…" rows="2" required aria-label="Type your message"></textarea>
                    <button type="submit" id="liveChatSubmit">
                        <span>Send</span>
                        <i class="fas fa-paper-plane" aria-hidden="true"></i>
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Appointments Section (near the bottom of the page) -->
    <section class="appointments" id="appointments">
        <div class="container">
            <div class="appointments-shell">
                <div class="appointments-intro">
                    <span class="appointments-eyebrow"><i class="fas fa-calendar-alt" aria-hidden="true"></i> Available appointments</span>
                    <h2>Pick a date for your free quote</h2>
                    <p>Tap a slot and the quote form will pop up so you can answer a few quick questions.</p>
                    <div class="appointments-meta">
                        <span><i class="fas fa-check-circle" aria-hidden="true"></i> No obligation</span>
                        <span><i class="fas fa-bolt" aria-hidden="true"></i> Takes 1–2 minutes</span>
                        <span><i class="fas fa-map-marker-alt" aria-hidden="true"></i> Audenshaw • Denton • Dukinfield</span>
                    </div>
                </div>
                <div class="appointments-grid">
                    <div class="appointments-grid-header">
                        <h3>Available dates</h3>
                        <p>Choose one to continue</p>
                    </div>
                    <div class="availability-grid" id="availabilityGrid" aria-live="polite">
                        {% if availability and availability|length > 0 %}
                            {% for slot in availability %}
                                <button type="button" class="availability-slot" data-slot="{{ slot }}">
                                    <span class="slot-label">{{ slot }}</span>
                                    <span class="slot-sub"><span class="slot-badge">Free</span> Tap to continue</span>
                                </button>
                            {% endfor %}
                        {% else %}
                            <div class="availability-empty">Loading available appointments…</div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </section>

    <a href="https://wa.me/447595289669" class="whatsapp-button" target="_blank" rel="noopener" aria-label="Chat with Pay As You Mow on WhatsApp">
        <span class="icon"><i class="fa-brands fa-whatsapp"></i></span>
        <div class="whatsapp-text">
            <span>Message us on</span>
            <span>WhatsApp</span>
        </div>
    </a>

    <!-- Footer -->
    <footer id="contact">
        <div class="container">
            <div class="footer-content">
                <div class="footer-column">
                    <h3>Pay As You Mow</h3>
                    <p>Low prices, great work and happy customer</p>
                    <a class="footer-admin-link" href="/admin">Welcome to Pay As You Mow</a>
                    <div class="social-links">
                        <a href="#"><i class="fab fa-facebook-f"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-pinterest"></i></a>
                    </div>
                </div>
                <div class="footer-column">
                    <h3>Quick Links</h3>
                    <ul class="footer-links">
                        <li><a href="#home">Home</a></li>
                        <li><a href="#services">My Services</a></li>
                        <li><a href="#about">About Us</a></li>
                        <li><a href="#faq">FAQ</a></li>
                        <li><a href="#contact">Contact</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>My Services</h3>
                    <ul class="footer-links">
                        <li><a href="#">Lawn Mowing</a></li>
                        <li><a href="#">Hedge Trimming</a></li>
                        <li><a href="#">Weed Control</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Contact Info</h3>
                    <ul class="footer-links">
                        <li><i class="fas fa-map-marker-alt"></i> <a href="https://maps.google.com/?q=Leech+Brook+Close,+Audenshaw,+Manchester" target="_blank" rel="noopener">Leech Brook Close, Audenshaw. Manchester</a></li>
                        <li><i class="fas fa-phone"></i> <a href="tel:07595289669">07595 289 669</a></li>
                    </ul>
                </div>
            </div>
            <div class="copyright">
                <p>&copy; 2023 Pay As You Mow. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Auto Quote Popup -->
    <div class="auto-quote-popup" id="autoQuotePopup" aria-hidden="true">
        <div class="auto-quote-card" role="dialog" aria-modal="true" aria-labelledby="autoQuoteTitle">
            <button class="auto-quote-close" id="autoQuoteClose" aria-label="Close popup">
                <i class="fas fa-times"></i>
            </button>
            <div class="auto-quote-header" id="autoQuoteHeader">
                <div class="auto-quote-icon" aria-hidden="true"><i class="fas fa-seedling"></i></div>
                <h3 id="autoQuoteTitle">Would You Like a Free Quote?</h3>
            </div>
            <div class="auto-quote-body">
                <div class="auto-quote-content" id="autoQuoteContent">
                    <div class="auto-quote-text">
                        <p>Get a free, no-obligation quote for professional garden maintenance services in Tameside.</p>
                    </div>
                    <div class="auto-quote-actions">
                        <button type="button" class="auto-quote-btn auto-quote-btn-yes" id="autoQuoteBtnYes">Yes, Please!</button>
                        <button type="button" class="auto-quote-btn auto-quote-btn-no" id="autoQuoteBtnNo">No, Thanks</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Safe initial availability embed (won't break JS if this HTML is served statically) -->
    <script type="application/json" id="initialAvailabilityJson">{{ availability|default([])|tojson }}</script>

    <script>
        // Surface JS errors on-page (helps diagnose why flows stop working)
        (function initJsErrorBanner() {
            const ensureBanner = () => {
                let banner = document.getElementById('jsErrorBanner');
                if (banner) return banner;
                banner = document.createElement('div');
                banner.id = 'jsErrorBanner';
                banner.style.cssText = [
                    'position:fixed',
                    'left:12px',
                    'right:12px',
                    'bottom:12px',
                    'z-index:2147483647',
                    'background:#b71c1c',
                    'color:#fff',
                    'padding:10px 12px',
                    'border-radius:10px',
                    'box-shadow:0 10px 30px rgba(0,0,0,.35)',
                    'font:600 12px/1.35 system-ui, -apple-system, Segoe UI, Roboto, Arial',
                    'display:none',
                    'white-space:pre-wrap'
                ].join(';');
                document.body.appendChild(banner);
                return banner;
            };

            const show = (label, message) => {
                const banner = ensureBanner();
                banner.textContent = `${label}: ${message}`;
                banner.style.display = 'block';
            };

            window.addEventListener('error', (event) => {
                const msg = event?.error?.stack || event?.message || 'Unknown error';
                show('JS error', msg);
            });

            window.addEventListener('unhandledrejection', (event) => {
                const reason = event?.reason?.stack || event?.reason || 'Unhandled promise rejection';
                show('Promise rejection', String(reason));
            });
        })();

        // If this page is served by the Flask app, embed availability so the UI can render instantly.
        // If it's served statically (no template rendering), this will safely fall back to [].
        (function initInitialAvailability() {
            let initial = [];
            const el = document.getElementById('initialAvailabilityJson');
            if (el) {
                try {
                    initial = JSON.parse(el.textContent || '[]');
                } catch {
                    initial = [];
                }
            }
            window.INITIAL_AVAILABILITY = Array.isArray(initial) ? initial : [];
        })();

        // API base resolution
        // - If you host this page on a static site (GitHub Pages/Neocities/etc.),
        //   window.location.origin is NOT your Flask server. In that case, fall back
        //   to the Render backend unless window.APP_API_BASE is explicitly set.
        const DEFAULT_API_BASE = "https://booking-app-1-gh2v.onrender.com";
        const APP_API_BASE = typeof window.APP_API_BASE === 'string' ? window.APP_API_BASE.trim() : '';
        const PAGE_ORIGIN = window.location?.origin || '';
        // Only treat local dev and known backend hosts as same-origin API.
        // Note: payasyoumow.org / callansweringandy.uk may be front-end hosts, so don't assume they serve API routes.
        const ORIGIN_LOOKS_LIKE_BACKEND = /(localhost|127\.0\.0\.1|onrender\.com)/i.test(PAGE_ORIGIN);
        const API_BASE = APP_API_BASE || (ORIGIN_LOOKS_LIKE_BACKEND ? PAGE_ORIGIN : DEFAULT_API_BASE);

        // SMS verification is used instead of Firebase/Google sign-in.

        const PRESENCE_ENDPOINT = `${API_BASE}/presence`;
        const LIVE_CHAT_ENDPOINTS = {
            session: `${API_BASE}/chat/session`,
            messages: `${API_BASE}/chat/messages`,
            send: `${API_BASE}/chat/send`,
            status: `${API_BASE}/chat/status`,
        };
        const LIVE_CHAT_STORAGE_KEY = 'payAsYouMowChatSession';
        const LIVE_CHAT_POLL_INTERVAL = 4000;
        const CHARACTER_POPUP_DELAY = 10000;
        const CHARACTER_POPUP_STORAGE_KEY = 'payAsYouMowCharacterPopupShown';
        const MOBILE_OFFER_POPUP_DELAY = 600;
        const MOBILE_OFFER_POPUP_DURATION = 5000;

        const characterPopup = document.getElementById('heroCharacterPopup');
        const characterPopupClose = document.getElementById('characterPopupClose');
        const characterPopupDismiss = document.getElementById('characterPopupDismiss');
        const characterPopupCta = document.getElementById('characterPopupCta');
        const mobileOfferPopup = document.getElementById('mobileOfferPopup');
        const mobileOfferClose = document.getElementById('mobileOfferClose');
        const mobileOfferBreakpoint = window.matchMedia ? window.matchMedia('(max-width: 768px)') : null;

        let characterPopupTimer = null;
        let mobileOfferDelayTimer = null;
        let mobileOfferAutoCloseTimer = null;
        let mobileOfferShown = false;

        function isMobileOfferViewport() {
            if (mobileOfferBreakpoint) {
                return mobileOfferBreakpoint.matches;
            }
            return window.innerWidth <= 768;
        }

        function clearMobileOfferDelayTimer() {
            if (mobileOfferDelayTimer) {
                clearTimeout(mobileOfferDelayTimer);
                mobileOfferDelayTimer = null;
            }
        }

        function clearMobileOfferAutoCloseTimer() {
            if (mobileOfferAutoCloseTimer) {
                clearTimeout(mobileOfferAutoCloseTimer);
                mobileOfferAutoCloseTimer = null;
            }
        }

        function openMobileOfferPopup() {
            if (!mobileOfferPopup || mobileOfferPopup.classList.contains('visible')) {
                return;
            }
            mobileOfferPopup.classList.add('visible');
            mobileOfferPopup.setAttribute('aria-hidden', 'false');
            document.body.classList.add('modal-open');
            mobileOfferShown = true;
            clearMobileOfferAutoCloseTimer();
            mobileOfferAutoCloseTimer = window.setTimeout(() => {
                closeMobileOfferPopup();
            }, MOBILE_OFFER_POPUP_DURATION);
            if (mobileOfferClose && typeof mobileOfferClose.focus === 'function') {
                window.setTimeout(() => {
                    mobileOfferClose.focus({ preventScroll: true });
                }, 150);
            }
        }

        function closeMobileOfferPopup() {
            clearMobileOfferDelayTimer();
            clearMobileOfferAutoCloseTimer();
            if (!mobileOfferPopup || !mobileOfferPopup.classList.contains('visible')) {
                return;
            }
            mobileOfferPopup.classList.remove('visible');
            mobileOfferPopup.setAttribute('aria-hidden', 'true');
            if (!document.querySelector('.modal-overlay.visible') && !(characterPopup && characterPopup.classList.contains('visible'))) {
                document.body.classList.remove('modal-open');
            }
        }

        function scheduleMobileOfferPopup() {
            if (!mobileOfferPopup || mobileOfferShown || !isMobileOfferViewport()) {
                return;
            }
            clearMobileOfferDelayTimer();
            mobileOfferDelayTimer = window.setTimeout(() => {
                openMobileOfferPopup();
            }, MOBILE_OFFER_POPUP_DELAY);
        }

        function hasCharacterPopupBeenSeen() {
            try {
                return sessionStorage.getItem(CHARACTER_POPUP_STORAGE_KEY) === '1';
            } catch (error) {
                return false;
            }
        }

        function markCharacterPopupSeen() {
            try {
                sessionStorage.setItem(CHARACTER_POPUP_STORAGE_KEY, '1');
            } catch (error) {
                // Ignore storage issues (private mode, etc.)
            }
        }

        function cancelCharacterPopupTimer() {
            if (characterPopupTimer) {
                clearTimeout(characterPopupTimer);
                characterPopupTimer = null;
            }
        }

        function closeCharacterPopup() {
            cancelCharacterPopupTimer();
            if (!characterPopup) {
                return;
            }
            characterPopup.classList.remove('visible');
            characterPopup.setAttribute('aria-hidden', 'true');
            if (!document.querySelector('.modal-overlay.visible') && !(mobileOfferPopup && mobileOfferPopup.classList.contains('visible'))) {
                document.body.classList.remove('modal-open');
            }
        }

        function openCharacterPopup() {
            cancelCharacterPopupTimer();
            if (!characterPopup || characterPopup.classList.contains('visible')) {
                return;
            }
            characterPopup.classList.add('visible');
            characterPopup.setAttribute('aria-hidden', 'false');
            document.body.classList.add('modal-open');
            markCharacterPopupSeen();
            const focusTarget = characterPopupClose || characterPopupCta;
            window.setTimeout(() => {
                if (focusTarget && typeof focusTarget.focus === 'function') {
                    focusTarget.focus({ preventScroll: true });
                }
            }, 100);
        }

        function scheduleCharacterPopup() {
            if (!characterPopup || hasCharacterPopupBeenSeen()) {
                return;
            }
            cancelCharacterPopupTimer();
            characterPopupTimer = window.setTimeout(() => {
                openCharacterPopup();
            }, CHARACTER_POPUP_DELAY);
        }

        scheduleMobileOfferPopup();
        scheduleCharacterPopup();

        if (mobileOfferBreakpoint) {
            if (typeof mobileOfferBreakpoint.addEventListener === 'function') {
                mobileOfferBreakpoint.addEventListener('change', (event) => {
                    if (event.matches) {
                        scheduleMobileOfferPopup();
                    } else {
                        closeMobileOfferPopup();
                    }
                });
            } else if (typeof mobileOfferBreakpoint.addListener === 'function') {
                mobileOfferBreakpoint.addListener((event) => {
                    if (event.matches) {
                        scheduleMobileOfferPopup();
                    } else {
                        closeMobileOfferPopup();
                    }
                });
            }
        } else {
            window.addEventListener('resize', () => {
                if (isMobileOfferViewport()) {
                    scheduleMobileOfferPopup();
                } else {
                    closeMobileOfferPopup();
                }
            });
        }

        if (mobileOfferPopup) {
            mobileOfferPopup.addEventListener('click', (event) => {
                if (event.target === mobileOfferPopup) {
                    closeMobileOfferPopup();
                }
            });
        }

        if (mobileOfferClose) {
            mobileOfferClose.addEventListener('click', () => {
                closeMobileOfferPopup();
            });
        }

        if (characterPopup) {
            characterPopup.addEventListener('click', (event) => {
                if (event.target === characterPopup) {
                    closeCharacterPopup();
                }
            });
        }

        if (characterPopupClose) {
            characterPopupClose.addEventListener('click', () => {
                closeCharacterPopup();
            });
        }

        if (characterPopupDismiss) {
            characterPopupDismiss.addEventListener('click', () => {
                closeCharacterPopup();
            });
        }

        if (characterPopupCta) {
            characterPopupCta.addEventListener('click', () => {
                closeCharacterPopup();
            });
        }

        document.addEventListener('keydown', (event) => {
            if (event.key !== 'Escape') {
                return;
            }
            if (characterPopup && characterPopup.classList.contains('visible')) {
                closeCharacterPopup();
            }
            if (mobileOfferPopup && mobileOfferPopup.classList.contains('visible')) {
                closeMobileOfferPopup();
            }
        });

        function buildPresencePayload(status = 'online') {
            return {
                page: window.location.pathname || '/',
                timestamp: new Date().toISOString(),
                status,
            };
        }

        async function reportPresence() {
            const payload = buildPresencePayload('online');
            try {
                await fetch(PRESENCE_ENDPOINT, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload),
                    keepalive: true,
                });
            } catch (error) {
                console.warn('Unable to notify presence.', error);
            }
        }

        function sendPresenceBeacon(status = 'online') {
            const payload = JSON.stringify(buildPresencePayload(status));
            if (navigator.sendBeacon) {
                try {
                    const blob = new Blob([payload], { type: 'application/json' });
                    navigator.sendBeacon(PRESENCE_ENDPOINT, blob);
                    return;
                } catch (error) {
                    console.warn('Presence beacon failed, retrying with fetch.', error);
                }
            }
            fetch(PRESENCE_ENDPOINT, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: payload,
                keepalive: true,
            }).catch(() => {});
        }

        reportPresence();
        setInterval(reportPresence, 60000);
        window.addEventListener('visibilitychange', () => {
            if (document.visibilityState === 'hidden') {
                sendPresenceBeacon('online');
            }
        });
        window.addEventListener('pagehide', (event) => {
            if (!event.persisted) {
                sendPresenceBeacon('offline');
            }
        });
        window.addEventListener('beforeunload', () => sendPresenceBeacon('offline'));

        function getStoredChatSessionId() {
            try {
                return localStorage.getItem(LIVE_CHAT_STORAGE_KEY) || '';
            } catch (error) {
                return '';
            }
        }

        function storeChatSessionId(value) {
            try {
                if (value) {
                    localStorage.setItem(LIVE_CHAT_STORAGE_KEY, value);
                }
            } catch (error) {
                // Ignore storage errors
            }
        }

        const liveChatWidget = document.getElementById('liveChatWidget');
        if (liveChatWidget) {
            const liveChatToggle = document.getElementById('liveChatToggle');
            const liveChatClose = document.getElementById('liveChatClose');
            const liveChatWindow = document.getElementById('liveChatWindow');
            const liveChatMessages = document.getElementById('liveChatMessages');
            const liveChatEmptyState = document.getElementById('liveChatEmptyState');
            const liveChatForm = document.getElementById('liveChatForm');
            const liveChatInput = document.getElementById('liveChatInput');
            const liveChatSubmit = document.getElementById('liveChatSubmit');
            const liveChatStatusBanner = document.getElementById('liveChatStatusBanner');
            const liveChatInviteOverlay = document.getElementById('liveChatInviteOverlay');
            const liveChatInviteMessage = document.getElementById('liveChatInviteMessage');
            const liveChatInviteAccept = document.getElementById('liveChatInviteAccept');
            const liveChatInviteDecline = document.getElementById('liveChatInviteDecline');
            const chatGardener = document.getElementById('chatGardener');
            const liveChatWhatsAppButton = document.getElementById('liveChatWhatsAppButton');

            let liveChatSessionId = getStoredChatSessionId();
            let liveChatLastMessageId = 0;
            let liveChatPollingTimer = null;
            let liveChatOnline = true;
            let liveChatWindowOpen = false;
            let liveChatInitialized = false;
            let liveChatHasUnread = false;
            const liveChatHandledInvites = new Set();
            let liveChatActiveInviteId = null;
            let chatGardenerTimer = null;
            let chatGardenerShown = false;
            let chatGardenerHideTimer = null;
            let autopilotTypingQueue = Promise.resolve();

            function isDesktopViewport() {
                return window.matchMedia('(min-width: 992px)').matches;
            }

            function showChatGardener() {
                if (!chatGardener || chatGardenerShown || !isDesktopViewport()) {
                    return;
                }
                chatGardenerShown = true;
                chatGardener.classList.add('visible');
                chatGardener.setAttribute('aria-hidden', 'false');
                if (chatGardenerHideTimer) {
                    clearTimeout(chatGardenerHideTimer);
                }
                chatGardenerHideTimer = window.setTimeout(() => {
                    hideChatGardener();
                }, 5000);
            }

            function hideChatGardener() {
                if (!chatGardener) {
                    return;
                }
                chatGardener.classList.remove('visible');
                chatGardener.setAttribute('aria-hidden', 'true');
                chatGardenerShown = false;
                if (chatGardenerHideTimer) {
                    clearTimeout(chatGardenerHideTimer);
                    chatGardenerHideTimer = null;
                }
            }

            function scheduleChatGardener() {
                if (!chatGardener) {
                    return;
                }
                if (!isDesktopViewport()) {
                    hideChatGardener();
                    if (chatGardenerTimer) {
                        clearTimeout(chatGardenerTimer);
                        chatGardenerTimer = null;
                    }
                    return;
                }
                if (chatGardenerShown || chatGardenerTimer) {
                    return;
                }
                chatGardenerTimer = window.setTimeout(() => {
                    showChatGardener();
                    chatGardenerTimer = null;
                }, 20000);
            }

            scheduleChatGardener();
            window.addEventListener('resize', () => scheduleChatGardener());

            if (liveChatWhatsAppButton) {
                liveChatWhatsAppButton.setAttribute('aria-label', 'Chat via WhatsApp (opens in a new tab)');
            }

            function formatLiveChatTime(value) {
                if (!value) return '';
                const parsed = new Date(value);
                if (Number.isNaN(parsed.getTime())) return '';
                return parsed.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            }

            function createLiveChatMessageElement(message) {
                if (!message) return null;
                const sender = typeof message.sender === 'string' ? message.sender : 'visitor';
                const isAutopilot = sender === 'autopilot';
                const isAdminMessage = sender === 'admin' || isAutopilot;

                const wrapper = document.createElement('div');
                wrapper.className = `live-chat-message ${isAdminMessage ? 'from-admin' : 'from-visitor'}`;
                if (isAutopilot) {
                    wrapper.classList.add('autopilot');
                }

                const bubble = document.createElement('div');
                bubble.className = 'message-bubble';
                bubble.textContent = message.text || '';
                wrapper.appendChild(bubble);

                const meta = document.createElement('span');
                meta.className = 'message-meta';
                const senderLabel = isAutopilot ? 'Agent' : isAdminMessage ? 'Team' : 'You';
                const timeLabel = formatLiveChatTime(message.timestamp);
                meta.textContent = timeLabel ? `${senderLabel} • ${timeLabel}` : senderLabel;
                wrapper.appendChild(meta);

                return wrapper;
            }

            function appendLiveChatMessageElement(element) {
                if (!element || !liveChatMessages) return;
                liveChatMessages.appendChild(element);
                liveChatMessages.scrollTop = liveChatMessages.scrollHeight;
            }

            function getRandomBetween(minValue, maxValue) {
                const minNum = Number(minValue);
                const maxNum = Number(maxValue);
                if (!Number.isFinite(minNum) || !Number.isFinite(maxNum) || maxNum <= minNum) {
                    return 0;
                }
                return minNum + Math.random() * (maxNum - minNum);
            }

            function getAutopilotTypingDelay(text) {
                const content = typeof text === 'string' ? text.trim() : '';
                const length = content.length;

                // Short replies: 2–4s
                if (length <= 90) {
                    return getRandomBetween(2000, 4000);
                }

                // Medium replies: keep within 2–8s overall but bias longer
                if (length <= 240) {
                    return getRandomBetween(3500, 6500);
                }

                // Longer replies: 5–8s
                return getRandomBetween(5000, 8000);
            }

            function getAutopilotTypingIndicatorDelay() {
                // Human-like "reading" pause before typing: 2–7s
                return getRandomBetween(2000, 7000);
            }

            function createAutopilotTypingIndicator() {
                const wrapper = document.createElement('div');
                wrapper.className = 'live-chat-message from-admin autopilot typing';

                const bubble = document.createElement('div');
                bubble.className = 'message-bubble';
                for (let index = 0; index < 3; index += 1) {
                    const dot = document.createElement('span');
                    dot.className = 'live-chat-typing-dot';
                    bubble.appendChild(dot);
                }
                wrapper.appendChild(bubble);

                const meta = document.createElement('span');
                meta.className = 'message-meta';
                meta.textContent = 'Agent is typing…';
                wrapper.appendChild(meta);

                return wrapper;
            }

            function queueAutopilotMessageDisplay(message) {
                autopilotTypingQueue = autopilotTypingQueue.then(
                    () =>
                        new Promise((resolve) => {
                            if (!liveChatMessages) {
                                appendLiveChatMessageElement(createLiveChatMessageElement(message));
                                resolve();
                                return;
                            }

                            const indicator = createAutopilotTypingIndicator();
                            const typingDelay = getAutopilotTypingDelay(message && message.text);
                            const indicatorDelay = getAutopilotTypingIndicatorDelay();

                            const displayMessage = () => {
                                const messageElement = createLiveChatMessageElement(message);
                                if (indicator.parentNode && messageElement) {
                                    indicator.replaceWith(messageElement);
                                    liveChatMessages.scrollTop = liveChatMessages.scrollHeight;
                                } else if (messageElement) {
                                    appendLiveChatMessageElement(messageElement);
                                } else if (indicator.parentNode) {
                                    indicator.remove();
                                }
                                resolve();
                            };

                            window.setTimeout(() => {
                                appendLiveChatMessageElement(indicator);
                            }, indicatorDelay);

                            window.setTimeout(() => {
                                displayMessage();
                            }, indicatorDelay + typingDelay);
                        })
                );
            }

            function setChatUnreadIndicator(isActive) {
                liveChatHasUnread = Boolean(isActive);
                if (liveChatToggle) {
                    liveChatToggle.classList.toggle('has-unread', liveChatHasUnread);
                    liveChatToggle.setAttribute(
                        'aria-label',
                        liveChatHasUnread ? 'Open live chat (new reply)' : 'Open live chat'
                    );
                }
            }

            function setChatOnlineState(isOnline) {
                liveChatOnline = Boolean(isOnline);
                if (liveChatToggle) {
                    liveChatToggle.classList.toggle('is-offline', !liveChatOnline);
                }
                if (liveChatStatusBanner) {
                    liveChatStatusBanner.classList.remove('error');
                    liveChatStatusBanner.classList.toggle('offline', !liveChatOnline);
                    liveChatStatusBanner.classList.toggle('online', liveChatOnline);
                    liveChatStatusBanner.classList.add('visible');
                    liveChatStatusBanner.textContent = liveChatOnline
                        ? 'Typically replies within a few minutes.'
                        : 'We\'re offline right now. Please reach out via the contact form or WhatsApp.';
                }
                if (liveChatForm) {
                    liveChatForm.classList.toggle('is-disabled', !liveChatOnline);
                }
                if (liveChatInput) {
                    liveChatInput.disabled = !liveChatOnline;
                    liveChatInput.placeholder = liveChatOnline
                        ? 'Type your message…'
                        : 'Live chat is offline right now';
                }
                if (liveChatSubmit) {
                    liveChatSubmit.disabled = !liveChatOnline;
                }
                if (liveChatWhatsAppButton) {
                    liveChatWhatsAppButton.classList.toggle('is-highlighted', !liveChatOnline);
                }
            }

            function showChatError(message) {
                if (!liveChatStatusBanner) return;
                liveChatStatusBanner.textContent = message;
                liveChatStatusBanner.classList.add('visible', 'error');
                liveChatStatusBanner.classList.remove('online');
                liveChatStatusBanner.classList.remove('offline');
            }

            function clearChatBanner() {
                if (!liveChatStatusBanner) return;
                liveChatStatusBanner.classList.remove('error');
                liveChatStatusBanner.classList.add(liveChatOnline ? 'online' : 'offline');
                liveChatStatusBanner.textContent = liveChatOnline
                    ? 'Typically replies within a few minutes.'
                    : 'We\'re offline right now. Please reach out via the contact form or WhatsApp.';
            }

            function hideLiveChatInvite(markHandled = false) {
                if (!liveChatInviteOverlay) return;
                if (markHandled && Number.isFinite(liveChatActiveInviteId)) {
                    liveChatHandledInvites.add(liveChatActiveInviteId);
                }
                liveChatActiveInviteId = null;
                liveChatInviteOverlay.classList.remove('visible');
                liveChatInviteOverlay.setAttribute('aria-hidden', 'true');
            }

            function showLiveChatInvite(message) {
                if (!liveChatInviteOverlay) return;
                const inviteId = Number(message.id);
                if (Number.isFinite(inviteId)) {
                    if (liveChatWindowOpen) {
                        liveChatHandledInvites.add(inviteId);
                        return;
                    }
                    if (liveChatHandledInvites.has(inviteId)) {
                        return;
                    }
                    liveChatActiveInviteId = inviteId;
                } else {
                    liveChatActiveInviteId = null;
                }

                if (liveChatInviteMessage) {
                    liveChatInviteMessage.textContent = message.text ||
                        'We\'re right here if you have any questions about your garden.';
                }

                liveChatInviteOverlay.classList.add('visible');
                liveChatInviteOverlay.setAttribute('aria-hidden', 'false');
                setChatUnreadIndicator(true);
                if (liveChatInviteAccept) {
                    setTimeout(() => {
                        liveChatInviteAccept.focus({ preventScroll: true });
                    }, 120);
                }
            }

            function renderLiveChatMessage(message) {
                if (!message || typeof message !== 'object' || !liveChatMessages) return;
                const messageId = Number(message.id);
                if (Number.isFinite(messageId) && messageId <= liveChatLastMessageId) {
                    return;
                }
                if (Number.isFinite(messageId)) {
                    liveChatLastMessageId = messageId;
                }
                const messageType = typeof message.type === 'string' ? message.type : 'message';
                if (messageType === 'invite') {
                    showLiveChatInvite(message);
                    return;
                }
                if (liveChatEmptyState) {
                    liveChatEmptyState.classList.add('hidden');
                }

                const sender = typeof message.sender === 'string' ? message.sender : 'visitor';
                const isAutopilot = sender === 'autopilot';

                if (isAutopilot && liveChatInitialized) {
                    queueAutopilotMessageDisplay(message);
                    return;
                }

                appendLiveChatMessageElement(createLiveChatMessageElement(message));
            }

            function resetLiveChatMessages(messages = []) {
                if (!liveChatMessages) return;
                liveChatMessages.innerHTML = '';
                liveChatLastMessageId = 0;
                if (Array.isArray(messages) && messages.length) {
                    messages.forEach((entry) => renderLiveChatMessage(entry));
                } else if (liveChatEmptyState) {
                    liveChatEmptyState.classList.remove('hidden');
                }
                liveChatInitialized = true;
                setChatUnreadIndicator(false);
            }

            function toggleLiveChatWindow(forceOpen) {
                if (!liveChatWindow || !liveChatToggle) return;
                const shouldOpen = typeof forceOpen === 'boolean' ? forceOpen : !liveChatWindowOpen;
                liveChatWindowOpen = shouldOpen;
                liveChatWindow.classList.toggle('visible', shouldOpen);
                liveChatWindow.setAttribute('aria-hidden', String(!shouldOpen));
                liveChatToggle.setAttribute('aria-expanded', String(shouldOpen));
                if (shouldOpen) {
                    hideLiveChatInvite(true);
                    setChatUnreadIndicator(false);
                    fetchLiveChatMessages(true);
                    setTimeout(() => {
                        if (liveChatInput && !liveChatInput.disabled) {
                            liveChatInput.focus();
                        }
                    }, 120);
                }
            }

            function startLiveChatPolling() {
                if (liveChatPollingTimer) return;
                liveChatPollingTimer = setInterval(() => {
                    fetchLiveChatMessages(false);
                }, LIVE_CHAT_POLL_INTERVAL);
            }

            function stopLiveChatPolling() {
                if (liveChatPollingTimer) {
                    clearInterval(liveChatPollingTimer);
                    liveChatPollingTimer = null;
                }
            }

            async function fetchLiveChatMessages(forceRefresh = false) {
                if (!liveChatSessionId) return;
                const params = new URLSearchParams({ session_id: liveChatSessionId, page: window.location.pathname || '/' });
                if (!forceRefresh && liveChatLastMessageId) {
                    params.set('after', String(liveChatLastMessageId));
                }

                try {
                    const res = await fetch(`${LIVE_CHAT_ENDPOINTS.messages}?${params.toString()}`);
                    if (!res.ok) {
                        throw new Error('Unable to fetch chat updates.');
                    }
                    const data = await res.json();
                    if (typeof data.online === 'boolean') {
                        setChatOnlineState(data.online);
                    }
                    if (Array.isArray(data.messages)) {
                        let hasAdminMessage = false;
                        data.messages.forEach((entry) => {
                            const entryType = entry && typeof entry.type === 'string' ? entry.type : 'message';
                            const sender = entry && typeof entry.sender === 'string' ? entry.sender : '';
                            if (entry && entryType !== 'invite' && (sender === 'admin' || sender === 'autopilot')) {
                                hasAdminMessage = true;
                            }
                            renderLiveChatMessage(entry);
                        });
                        if (hasAdminMessage && !liveChatWindowOpen) {
                            setChatUnreadIndicator(true);
                            if (liveChatInitialized) {
                                toggleLiveChatWindow(true);
                            }
                        }
                    }
                } catch (error) {
                    console.warn('Live chat polling failed.', error);
                }
            }

            async function initialiseLiveChat() {
                if (!liveChatForm) return;
                try {
                    const response = await fetch(LIVE_CHAT_ENDPOINTS.session, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            session_id: liveChatSessionId,
                            page: window.location.pathname || '/',
                        }),
                    });
                    const data = await response.json();
                    if (!response.ok) {
                        throw new Error(data.message || 'Unable to start live chat.');
                    }
                    if (data.session_id) {
                        liveChatSessionId = data.session_id;
                        storeChatSessionId(liveChatSessionId);
                    }
                    setChatOnlineState(typeof data.online === 'boolean' ? data.online : true);
                    resetLiveChatMessages(Array.isArray(data.messages) ? data.messages : []);
                    startLiveChatPolling();
                } catch (error) {
                    setChatOnlineState(false);
                    showChatError('We could not connect to live chat right now.');
                    console.warn('Unable to initialise live chat.', error);
                }
            }

            async function sendLiveChatMessage(event) {
                event.preventDefault();
                if (!liveChatForm || !liveChatInput || !liveChatSubmit) return;
                if (!liveChatOnline || !liveChatSessionId) {
                    return;
                }

                const message = liveChatInput.value.trim();
                if (!message) {
                    liveChatInput.focus();
                    return;
                }

                liveChatSubmit.disabled = true;
                try {
                    const res = await fetch(LIVE_CHAT_ENDPOINTS.send, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            session_id: liveChatSessionId,
                            message,
                            page: window.location.pathname || '/',
                        }),
                    });
                    const data = await res.json();
                    if (!res.ok) {
                        if (res.status === 503) {
                            setChatOnlineState(false);
                        }
                        throw new Error(data.message || 'Unable to send your message.');
                    }
                    if (data.entry) {
                        renderLiveChatMessage(data.entry);
                    }
                    if (data.autopilot_entry) {
                        renderLiveChatMessage(data.autopilot_entry);
                        if (!liveChatWindowOpen) {
                            setChatUnreadIndicator(true);
                        }
                    }
                    liveChatInput.value = '';
                    clearChatBanner();
                    fetchLiveChatMessages(false);
                } catch (error) {
                    showChatError(error.message || 'Unable to send your message.');
                } finally {
                    liveChatSubmit.disabled = !liveChatOnline;
                }
            }

            if (liveChatToggle) {
                liveChatToggle.addEventListener('click', () => toggleLiveChatWindow());
            }
            if (liveChatClose) {
                liveChatClose.addEventListener('click', () => toggleLiveChatWindow(false));
            }
            if (liveChatForm) {
                liveChatForm.addEventListener('submit', sendLiveChatMessage);
                liveChatForm.dataset.liveChatBound = '1';
                window.__payAsYouMowLiveChatBound = true;
            }
            if (liveChatInviteAccept) {
                liveChatInviteAccept.addEventListener('click', () => {
                    hideLiveChatInvite(true);
                    toggleLiveChatWindow(true);
                });
            }
            if (liveChatInviteDecline) {
                liveChatInviteDecline.addEventListener('click', () => {
                    hideLiveChatInvite(true);
                    setChatUnreadIndicator(false);
                    if (liveChatToggle) {
                        liveChatToggle.focus({ preventScroll: true });
                    }
                });
            }
            if (liveChatInviteOverlay) {
                liveChatInviteOverlay.addEventListener('click', (event) => {
                    if (event.target === liveChatInviteOverlay) {
                        hideLiveChatInvite(true);
                        setChatUnreadIndicator(false);
                        if (liveChatToggle) {
                            liveChatToggle.focus({ preventScroll: true });
                        }
                    }
                });
            }
            document.addEventListener('keydown', (event) => {
                if (event.key === 'Escape') {
                    if (liveChatInviteOverlay && liveChatInviteOverlay.classList.contains('visible')) {
                        hideLiveChatInvite(true);
                        setChatUnreadIndicator(false);
                        if (liveChatToggle) {
                            liveChatToggle.focus({ preventScroll: true });
                        }
                        return;
                    }
                    if (liveChatWindowOpen) {
                        toggleLiveChatWindow(false);
                    }
                }
            });

            initialiseLiveChat();
            window.__payAsYouMowLiveChatInitOk = true;
        }

        // Mobile Menu Toggle
        const mobileMenuBtn = document.getElementById('mobileMenuBtn');
        const nav = document.getElementById('nav');

        const header = document.getElementById('header');

        const navBackdrop = document.createElement('div');
        navBackdrop.className = 'nav-backdrop';
        document.body.appendChild(navBackdrop);

        function syncHeaderHeightVar() {
            if (!header) return;
            const height = Math.max(0, Math.round(header.getBoundingClientRect().height));
            if (height) {
                document.documentElement.style.setProperty('--header-height', `${height}px`);
            }
        }

        function setNavOpen(open) {
            if (!nav || !mobileMenuBtn) return;
            const nextOpen = typeof open === 'boolean' ? open : !nav.classList.contains('active');
            nav.classList.toggle('active', nextOpen);
            document.body.classList.toggle('nav-open', nextOpen);
            navBackdrop.classList.toggle('visible', nextOpen);
            mobileMenuBtn.setAttribute('aria-expanded', nextOpen ? 'true' : 'false');
            mobileMenuBtn.setAttribute('aria-label', nextOpen ? 'Close menu' : 'Open menu');
            mobileMenuBtn.innerHTML = nextOpen ? '<i class="fas fa-times"></i>' : '<i class="fas fa-bars"></i>';
        }

        // Scroll to a section after closing the nav menu.
        // Handles iOS Safari where overflow:hidden can freeze window.scrollY.
        function navScrollTo(targetEl) {
            if (!targetEl) return;
            // Use setTimeout(100) so the browser has fully re-painted and
            // restored the scroll position after removing overflow:hidden.
            window.setTimeout(() => {
                const headerH = header ? Math.round(header.getBoundingClientRect().height) : 92;
                const top = Math.max(0, targetEl.getBoundingClientRect().top + (window.scrollY || window.pageYOffset || 0) - headerH - 8);
                window.scrollTo({ top, behavior: 'smooth' });
            }, 100);
        }

        if (mobileMenuBtn && nav) {
            mobileMenuBtn.addEventListener('click', () => setNavOpen());
            mobileMenuBtn.dataset.navToggleBound = '1';
        }

        // Mobile nav links: close menu then scroll to section.
        // NOTE: This is the ONLY handler that scrolls for nav links.
        // The general anchor listener below bails out for anchors inside <nav>.
        if (nav) {
            nav.addEventListener('click', (event) => {
                const link = event.target && event.target.closest ? event.target.closest('a[href^="#"]') : null;
                if (!link) return;

                const href = link.getAttribute('href');
                if (!href || href === '#') return;

                const target = document.querySelector(href);

                event.preventDefault();
                event.stopPropagation();

                setNavOpen(false);
                navScrollTo(target);
            });
        }

        navBackdrop.addEventListener('click', () => setNavOpen(false));
        document.addEventListener('keydown', (event) => {
            if (event.key === 'Escape' && nav && nav.classList.contains('active')) {
                setNavOpen(false);
            }
        });

        syncHeaderHeightVar();
        window.addEventListener('resize', syncHeaderHeightVar);

        // Header Scroll Effect
        
        window.addEventListener('scroll', () => {
            if (window.scrollY > 100) {
                header.classList.add('scrolled');
            } else {
                header.classList.remove('scrolled');
            }
            syncHeaderHeightVar();
        });

        // Hero Slider
        const heroSlides = document.querySelectorAll('.hero-slide');
        let currentHeroSlide = 0;
        const heroInterval = 4000;

        function showHeroSlide(index) {
            if (index === currentHeroSlide || !heroSlides[index]) {
                return;
            }

            const currentSlide = heroSlides[currentHeroSlide];
            const nextSlide = heroSlides[index];

            nextSlide.classList.add('active');
            currentSlide.classList.remove('active');

            currentHeroSlide = index;
        }

        if (heroSlides.length > 0) {
            heroSlides[0].classList.add('active');

            if (heroSlides.length > 1) {
                setInterval(() => {
                    const nextIndex = (currentHeroSlide + 1) % heroSlides.length;
                    showHeroSlide(nextIndex);
                }, heroInterval);
            }
        }

        // Testimonial Slider
        const testimonialSlider = document.getElementById('testimonialSlider');
        let testimonialCards = [];
        let testimonialDots = [];
        const BUILT_IN_TESTIMONIALS = [
            {
                quote: 'Pay As You Mow transformed my neglected garden into a beautiful oasis. Their flexible payment model meant I could get the help I needed without breaking the bank. Highly recommended!',
                author: 'Sarah Johnson',
                location: 'Northwood',
            },
            {
                quote: 'As someone who travels frequently, I love that I can schedule garden maintenance only when I need it. The team is professional, reliable, and does an amazing job every time.',
                author: 'Michael Chen',
                location: 'Westfield',
            },
            {
                quote: 'The quality of work is exceptional. My hedges have never looked better, and the lawn is always perfectly manicured. The pay-as-you-go model is perfect for my budget.',
                author: 'Emma Davis',
                location: 'Riverside',
            },
        ];

        let testimonialTimer = null;
        let currentTestimonialIndex = 0;

        function clearTestimonialRotation() {
            if (testimonialTimer) {
                clearInterval(testimonialTimer);
                testimonialTimer = null;
            }
        }

        function setActiveTestimonial(index) {
            if (!testimonialCards.length) {
                return;
            }

            const nextIndex = ((index % testimonialCards.length) + testimonialCards.length) % testimonialCards.length;
            testimonialCards.forEach((card, cardIndex) => {
                card.classList.toggle('active', cardIndex === nextIndex);
            });
            testimonialDots.forEach((dot, dotIndex) => {
                dot.classList.toggle('active', dotIndex === nextIndex);
            });
            currentTestimonialIndex = nextIndex;
        }

        function startTestimonialRotation() {
            clearTestimonialRotation();
            if (testimonialCards.length <= 1) {
                return;
            }
            testimonialTimer = setInterval(() => {
                setActiveTestimonial(currentTestimonialIndex + 1);
            }, 5000);
        }

        function showTestimonialStatus(message, isError = false) {
            if (!testimonialSlider) {
                return;
            }
            testimonialSlider.innerHTML = '';
            const status = document.createElement('div');
            status.className = 'testimonial-status';
            if (isError) {
                status.classList.add('error');
            }
            status.textContent = message;
            testimonialSlider.appendChild(status);
        }

        function renderTestimonials(reviews) {
            if (!testimonialSlider) {
                return;
            }

            testimonialSlider.innerHTML = '';
            testimonialCards = [];
            testimonialDots = [];
            clearTestimonialRotation();

            if (!Array.isArray(reviews) || !reviews.length) {
                showTestimonialStatus('No testimonials have been published yet.');
                return;
            }

            const fragment = document.createDocumentFragment();
            const nav = document.createElement('div');
            nav.className = 'testimonial-nav';

            reviews.forEach((review, index) => {
                const card = document.createElement('div');
                card.className = 'testimonial';
                if (index === 0) {
                    card.classList.add('active');
                }

                const quote = document.createElement('p');
                quote.className = 'testimonial-text';
                const quoteText = typeof review.quote === 'string' && review.quote.trim()
                    ? review.quote.trim()
                    : '';
                quote.textContent = quoteText ? `“${quoteText}”` : '“A happy customer story will appear here.”';

                const author = document.createElement('p');
                author.className = 'testimonial-author';
                const name = typeof review.author === 'string' ? review.author.trim() : '';
                const location = typeof review.location === 'string' ? review.location.trim() : '';
                const authorLine = [name, location].filter(Boolean).join(', ');
                author.textContent = authorLine ? `- ${authorLine}` : '- Anonymous';

                card.appendChild(quote);
                card.appendChild(author);
                fragment.appendChild(card);

                if (reviews.length > 1) {
                    const dot = document.createElement('span');
                    dot.className = 'testimonial-dot';
                    dot.dataset.index = String(index);
                    if (index === 0) {
                        dot.classList.add('active');
                    }
                    nav.appendChild(dot);
                }
            });

            testimonialSlider.appendChild(fragment);
            if (reviews.length > 1) {
                testimonialSlider.appendChild(nav);
            }

            testimonialCards = Array.from(testimonialSlider.querySelectorAll('.testimonial'));
            testimonialDots = Array.from(testimonialSlider.querySelectorAll('.testimonial-dot'));

            testimonialDots.forEach((dot) => {
                dot.addEventListener('click', () => {
                    const index = Number.parseInt(dot.dataset.index || '0', 10);
                    setActiveTestimonial(index);
                    startTestimonialRotation();
                });
            });

            setActiveTestimonial(0);
            startTestimonialRotation();
        }

        async function loadTestimonialsFromEndpoint(endpoint) {
            const absolutePattern = /^https?:\/\//i;
            const url = (() => {
                if (absolutePattern.test(endpoint)) {
                    return new URL(endpoint);
                }
                if (endpoint.startsWith('/api/')) {
                    return new URL(endpoint, API_BASE || window.location.origin);
                }
                if (endpoint.startsWith('/')) {
                    return new URL(endpoint, window.location.origin);
                }
                return new URL(endpoint, window.location.href);
            })();
            url.searchParams.set('_', Date.now().toString());
            const res = await fetch(url.href, { cache: 'no-store' });
            if (!res.ok) {
                throw new Error(`Unable to load testimonials from ${endpoint}.`);
            }

            const data = await res.json();
            if (Array.isArray(data)) {
                return data;
            }

            if (data && Array.isArray(data.reviews)) {
                return data.reviews;
            }

            return [];
        }

        async function fetchTestimonials() {
            if (!testimonialSlider) {
                return;
            }
            showTestimonialStatus('Loading testimonials…');
            let lastError = null;
            try {
                const reviews = await loadTestimonialsFromEndpoint('/api/reviews');
                renderTestimonials(reviews);
                return;
            } catch (error) {
                lastError = error;
                console.warn('Unable to load testimonials from /api/reviews.', error);
            }

            try {
                const reviews = await loadTestimonialsFromEndpoint('/reviews.json');
                renderTestimonials(reviews);
                return;
            } catch (error) {
                lastError = error;
                console.warn('Unable to load testimonials from /reviews.json.', error);
            }

            if (Array.isArray(BUILT_IN_TESTIMONIALS) && BUILT_IN_TESTIMONIALS.length) {
                if (lastError) {
                    console.warn('Displaying built-in testimonials because the live data could not be loaded.');
                }
                renderTestimonials(BUILT_IN_TESTIMONIALS);
                return;
            }

            showTestimonialStatus(lastError?.message || 'Testimonials are unavailable at the moment.', true);
        }

        fetchTestimonials();

        // Smooth scrolling for anchor links (outside of <nav>).
        // Nav-link scrolling is handled exclusively by the nav click handler above.
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function(e) {
                // Let the dedicated nav click handler deal with nav links.
                if (nav && nav.contains(this)) return;

                e.preventDefault();

                const targetId = this.getAttribute('href');
                if (targetId === '#') return;

                const targetElement = document.querySelector(targetId);
                if (targetElement) {
                    const headerH = header ? Math.round(header.getBoundingClientRect().height) : 92;
                    const top = Math.max(0, targetElement.getBoundingClientRect().top + (window.scrollY || window.pageYOffset || 0) - headerH - 8);
                    window.scrollTo({ top, behavior: 'smooth' });
                }
            });
        });
        window.__payAsYouMowAnchorScrollBound = true;

        // YouTube video thumbnails
        const youtubeVideoFrames = Array.from(document.querySelectorAll('.video-frame[data-video-id]'));
        const youtubePlayers = [];
        const youtubeOverlays = [];

        function addThumbnailOverlay(frame, index) {
            const iframe = frame.querySelector('iframe');
            if (!iframe) return;

            const videoId = frame.dataset.videoId;
            if (!videoId) return;

            if (!iframe.src.includes('enablejsapi=1')) {
                const separator = iframe.src.includes('?') ? '&' : '?';
                iframe.src = `${iframe.src}${separator}enablejsapi=1`;
            }

            if (!iframe.id) {
                iframe.id = `video-player-${index}`;
            }

            const overlay = document.createElement('div');
            overlay.className = 'video-thumbnail';
            overlay.style.backgroundImage = `url(https://img.youtube.com/vi/${videoId}/hqdefault.jpg)`;
            overlay.setAttribute('role', 'button');
            overlay.setAttribute('tabindex', '0');
            overlay.setAttribute('aria-label', 'Replay video');

            const replayVideo = () => {
                overlay.classList.remove('visible');
                const player = youtubePlayers[index];
                if (player && typeof player.seekTo === 'function') {
                    player.seekTo(0);
                    player.playVideo();
                }
            };

            overlay.addEventListener('click', replayVideo);
            overlay.addEventListener('keydown', event => {
                if (event.key === 'Enter' || event.key === ' ') {
                    event.preventDefault();
                    replayVideo();
                }
            });

            frame.appendChild(overlay);
            youtubeOverlays[index] = overlay;
        }

        function handleYouTubeVideoState(event, overlay) {
            if (!overlay || typeof YT === 'undefined' || !YT.PlayerState) return;

            if (event.data === YT.PlayerState.ENDED) {
                if (event.target && typeof event.target.stopVideo === 'function') {
                    event.target.stopVideo();
                }
                overlay.classList.add('visible');
            } else if (event.data === YT.PlayerState.PLAYING) {
                overlay.classList.remove('visible');
            }
        }

        if (youtubeVideoFrames.length > 0) {
            youtubeVideoFrames.forEach((frame, index) => {
                addThumbnailOverlay(frame, index);
            });

            window.onYouTubeIframeAPIReady = function() {
                youtubeVideoFrames.forEach((frame, index) => {
                    const iframe = frame.querySelector('iframe');
                    if (!iframe) return;

                    const overlay = youtubeOverlays[index];

                    youtubePlayers[index] = new YT.Player(iframe.id, {
                        events: {
                            onStateChange: event => handleYouTubeVideoState(event, overlay)
                        }
                    });
                });
            };

            const ytScript = document.createElement('script');
            ytScript.src = 'https://www.youtube.com/iframe_api';
            document.body.appendChild(ytScript);
        }

        // Booking System
        const timeSelect = document.getElementById('customerTime');
        const availabilityGrid = document.getElementById('availabilityGrid');
        const bookingForm = document.getElementById('bookingForm');
        const bookingSubmitButton = bookingForm ? bookingForm.querySelector('.booking-submit') : null;
        const bookingResponse = document.getElementById('bookingResponse');
        const bookingModal = document.getElementById('bookingModal');
        const bookingDetailsForm = document.getElementById('bookingDetailsForm');
        const closeBookingModalBtn = document.getElementById('closeBookingModal');
        const modalTimeInput = document.getElementById('modalTimeInput');
        const selectedSlotDisplay = document.getElementById('selectedSlotDisplay');
        const modalFeedback = document.getElementById('modalFeedback');
        const modalSubmitButton = document.getElementById('modalSubmitButton');
        const modalSubmitText = modalSubmitButton ? modalSubmitButton.querySelector('.modal-submit-text') : null;
        const modalCustomerName = document.getElementById('modalCustomerName');
        const modalLocation = document.getElementById('modalLocation');
        const modalEmail = document.getElementById('modalEmail');
        const modalPhone = document.getElementById('modalPhone');
        const bookingThankYou = document.getElementById('bookingThankYou');
        const closeBookingThanksBtn = document.getElementById('closeBookingThanks');
        const contactForm = document.getElementById('contactForm');
        const contactResponse = document.getElementById('contactResponse');
        const contactSubmitButton = contactForm ? contactForm.querySelector('button[type="submit"]') : null;
        const customerLoginForm = document.getElementById('customerLoginForm');
        const customerAccessCode = document.getElementById('customerAccessCode');
        const customerLoginStatus = document.getElementById('customerLoginStatus');
        const customerPortal = document.getElementById('customerPortal');
        const customerSlotList = document.getElementById('customerSlotList');
        const customerSelectedSlot = document.getElementById('customerSelectedSlot');
        const customerBookingForm = document.getElementById('customerBookingForm');
        const customerName = document.getElementById('customerName');
        const customerPhone = document.getElementById('customerPhone');
        const customerBookingFeedback = document.getElementById('customerBookingFeedback');

        let lastFocusedElement = null;
        let customerLoggedIn = false;
        let selectedCustomerSlot = null;

        function formatSlotLabel(slot) {
            if (!slot || typeof slot !== 'string') return slot;

            const normalized = slot.trim();
            const match = normalized.match(/^(\d{4})-(\d{2})-(\d{2})[ T](\d{1,2}):(\d{2})(?::\d{2})?$/);
            if (!match) return slot;

            const year = Number(match[1]);
            const monthIndex = Number(match[2]) - 1;
            const day = Number(match[3]);
            const hours24 = Number(match[4]);
            const minutes = Number(match[5]);
            if (
                !Number.isFinite(year) ||
                !Number.isFinite(monthIndex) ||
                !Number.isFinite(day) ||
                !Number.isFinite(hours24) ||
                !Number.isFinite(minutes)
            ) {
                return slot;
            }

            const dateForMonth = new Date(year, monthIndex, day);
            if (Number.isNaN(dateForMonth.getTime())) return slot;

            const month = dateForMonth.toLocaleDateString('en-GB', { month: 'short' });
            const isPm = hours24 >= 12;
            const hours12 = ((hours24 + 11) % 12) + 1;
            const minutesPart = minutes === 0 ? '' : `:${String(minutes).padStart(2, '0')}`;
            const ampm = isPm ? 'pm' : 'am';
            const time = `${hours12}${minutesPart}${ampm}`;

            return `${day} ${month} ${year} ${time}`;
        }

        function updateSelectedSlotDetails(slot) {
            const friendlyLabel = formatSlotLabel(slot) || (slot || 'your chosen slot');
            if (selectedSlotDisplay) {
                selectedSlotDisplay.textContent = friendlyLabel;
            }
        }

        function renderAvailabilityGrid(slots = []) {
            if (!availabilityGrid) return;

            availabilityGrid.innerHTML = '';

            // Filter out any slots that are in the past
            const now = Date.now();
            if (Array.isArray(slots)) {
                slots = slots.filter((slot) => {
                    if (!slot || typeof slot !== 'string') return false;
                    const normalized = slot.trim().replace(' ', 'T');
                    const d = new Date(normalized);
                    return !Number.isNaN(d.getTime()) && d.getTime() > now;
                });
            }

            if (!Array.isArray(slots) || slots.length === 0) {
                const empty = document.createElement('div');
                empty.className = 'availability-empty';
                empty.textContent = 'Sorry — no slots are available right now. Please try again later or call Andy to arrange one.';
                availabilityGrid.appendChild(empty);
                return;
            }

            slots.forEach((slot) => {
                const button = document.createElement('button');
                button.type = 'button';
                button.className = 'availability-slot';
                button.dataset.slot = slot;
                button.innerHTML = `
                    <span class="slot-label">${formatSlotLabel(slot)}</span>
                    <span class="slot-sub"><span class="slot-badge">Free</span> Tap to book</span>
                `;

                availabilityGrid.appendChild(button);
            });
        }

        function hydrateServerRenderedAvailabilityLabels() {
            const buttons = Array.from(document.querySelectorAll('#availabilityGrid .availability-slot[data-slot]'));
            buttons.forEach((button) => {
                const slot = button.getAttribute('data-slot') || '';
                const label = button.querySelector('.slot-label');
                if (label) {
                    label.textContent = formatSlotLabel(slot) || slot;
                }
            });
        }

        // Handle slot clicks (works for both server-rendered and JS-rendered buttons)
        if (availabilityGrid) {
            availabilityGrid.addEventListener('click', (event) => {
                const button = event.target?.closest?.('.availability-slot');
                if (!button) return;
                const slot = button.dataset?.slot;
                if (!slot) return;
                bookingResponse?.classList.remove('visible', 'success', 'error');
                if (typeof openAutoQuoteWithSlot === 'function') {
                    openAutoQuoteWithSlot(slot);
                }
            });
        }

        // Load available times
        async function loadAvailability() {
            if (!timeSelect && !availabilityGrid) return;

            if (availabilityGrid) {
                availabilityGrid.innerHTML = '<div class="availability-empty">Loading available appointments…</div>';
            }
            try {
                const candidates = [];
                const overrideBase = typeof window.APP_API_BASE === 'string' ? window.APP_API_BASE.trim() : '';
                if (overrideBase) candidates.push(overrideBase);
                if (window.location?.origin) candidates.push(window.location.origin);
                if (typeof DEFAULT_API_BASE === 'string' && DEFAULT_API_BASE) candidates.push(DEFAULT_API_BASE);

                const seen = new Set();
                const uniqueCandidates = candidates.filter((base) => {
                    if (!base || seen.has(base)) return false;
                    seen.add(base);
                    return true;
                });

                let slots = [];
                let lastError = null;

                for (const base of uniqueCandidates) {
                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => controller.abort(), 8000);
                    try {
                        const res = await fetch(`${base}/availability`, {
                            signal: controller.signal,
                            cache: 'no-store'
                        });

                        if (!res.ok) {
                            throw new Error(`${base}/availability returned ${res.status}`);
                        }

                        const data = await res.json();
                        if (!Array.isArray(data)) {
                            throw new Error(`${base}/availability returned an unexpected response`);
                        }

                        slots = data;
                        lastError = null;
                        break;
                    } catch (error) {
                        lastError = error;
                    } finally {
                        clearTimeout(timeoutId);
                    }
                }

                if (lastError) {
                    throw lastError;
                }

                if (timeSelect) {
                    timeSelect.innerHTML = "";

                    // Filter out past slots for the dropdown too
                const nowTs = Date.now();
                const futureSlots = slots.filter((slot) => {
                    if (!slot || typeof slot !== 'string') return false;
                    const d = new Date(slot.trim().replace(' ', 'T'));
                    return !Number.isNaN(d.getTime()) && d.getTime() > nowTs;
                });

                if (futureSlots.length === 0) {
                        const opt = document.createElement("option");
                        opt.text = "Sorry no slots available at the moment";
                        opt.disabled = true;
                        opt.selected = true;
                        opt.value = "";
                        timeSelect.add(opt);
                    } else {
                        const defaultOpt = document.createElement("option");
                        defaultOpt.text = "Select a time";
                        defaultOpt.value = "";
                        timeSelect.add(defaultOpt);

                        futureSlots.forEach((slot) => {
                            const opt = document.createElement("option");
                            opt.value = slot;
                            opt.text = formatSlotLabel(slot);
                            timeSelect.add(opt);
                        });
                    }
                }

                renderAvailabilityGrid(slots);
            } catch (err) {
                console.error("Error loading availability:", err);
                if (timeSelect) {
                    timeSelect.innerHTML = "<option>Error loading times</option>";
                }
                if (availabilityGrid) {
                    const msg = (err && err.name === 'AbortError')
                        ? 'The booking server is taking too long to respond. Please try again in a moment.'
                        : 'Error loading available times. Please refresh or try again shortly.';
                    availabilityGrid.innerHTML = `<div class="availability-empty">${msg}</div>`;
                }
            }
        }

        function setCustomerPortalLocked(locked) {
            if (!customerPortal) return;
            customerPortal.classList.toggle('customer-locked', locked);
            customerPortal.querySelectorAll('input, button').forEach((control) => {
                control.disabled = locked;
            });
        }

        function renderCustomerSlots(slots = []) {
            if (!customerSlotList || !customerSelectedSlot) return;

            customerSlotList.innerHTML = '';
            selectedCustomerSlot = null;
            customerSelectedSlot.textContent = 'Select a customer slot to continue.';

            if (!slots.length) {
                const empty = document.createElement('p');
                empty.textContent = 'No customer slots are currently available. Please check back or contact us.';
                customerSlotList.appendChild(empty);
                return;
            }

            slots.forEach((slot) => {
                const row = document.createElement('div');
                row.className = 'customer-slot';
                row.innerHTML = `<div><strong>${slot.label}</strong></div>`;

                const button = document.createElement('button');
                button.type = 'button';
                button.textContent = 'Select';
                button.addEventListener('click', () => {
                    selectedCustomerSlot = slot;
                    customerSelectedSlot.innerHTML = `Selected: <span class="customer-selected-slot">${slot.label}</span>`;
                    customerBookingFeedback?.classList.remove('visible', 'error', 'success');
                    customerBookingFeedback.textContent = '';
                });

                row.appendChild(button);
                customerSlotList.appendChild(row);
            });
        }

        async function loadCustomerSlotsForPortal() {
            if (!customerLoggedIn) return;
            try {
                const res = await fetch(`${API_BASE}/customer/slots?available_only=1`);
                const data = await res.json();
                renderCustomerSlots(Array.isArray(data.slots) ? data.slots : []);
            } catch (error) {
                console.error('Unable to load customer slots', error);
                if (customerSlotList) {
                    customerSlotList.innerHTML = '<p>Unable to load customer slots right now.</p>';
                }
            }
        }

        function openBookingDetailsModal() {
            lastFocusedElement = document.activeElement;
            if (!bookingModal) return;

            bookingModal.classList.add('visible');
            bookingModal.setAttribute('aria-hidden', 'false');
            document.body.classList.add('modal-open');
            if (modalFeedback) {
                modalFeedback.classList.remove('visible', 'error');
                modalFeedback.textContent = '';
            }
            if (modalCustomerName) {
                setTimeout(() => modalCustomerName.focus(), 50);
            }
        }

        function closeBookingDetailsModal({ returnFocus = false, resetForm = false } = {}) {
            if (!bookingModal) return;

            bookingModal.classList.remove('visible');
            bookingModal.setAttribute('aria-hidden', 'true');
            document.body.classList.remove('modal-open');
            if (modalFeedback) {
                modalFeedback.classList.remove('visible', 'error');
                modalFeedback.textContent = '';
            }
            if (resetForm && bookingDetailsForm) {
                bookingDetailsForm.reset();
            }
            if (returnFocus) {
                const focusTarget = lastFocusedElement || bookingSubmitButton;
                if (focusTarget && typeof focusTarget.focus === 'function') {
                    focusTarget.focus();
                }
            }
        }

        function showBookingThankYou() {
            if (!bookingThankYou) return;
            bookingThankYou.classList.add('visible');
            bookingThankYou.setAttribute('aria-hidden', 'false');
            const closeBtn = bookingThankYou.querySelector('.booking-thanks-close');
            if (closeBtn) {
                closeBtn.focus();
            }
        }

        function hideBookingThankYou() {
            if (!bookingThankYou) return;
            bookingThankYou.classList.remove('visible');
            bookingThankYou.setAttribute('aria-hidden', 'true');
            const fallbackTarget = lastFocusedElement || bookingSubmitButton || availabilityGrid?.querySelector('button');
            if (fallbackTarget && typeof fallbackTarget.focus === 'function') {
                fallbackTarget.focus();
            }
        }

        updateSelectedSlotDetails('');
        setCustomerPortalLocked(true);

        if (customerLoginForm) {
            customerLoginForm.addEventListener('submit', async (event) => {
                event.preventDefault();

                customerLoginStatus?.classList.remove('error', 'success');
                if (customerLoginStatus) {
                    customerLoginStatus.textContent = '';
                }

                try {
                    const res = await fetch(`${API_BASE}/customer/login`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ code: customerAccessCode.value.trim() })
                    });
                    const data = await res.json();
                    if (!res.ok) {
                        throw new Error(data.message || 'Unable to log in.');
                    }
                    customerLoggedIn = true;
                    setCustomerPortalLocked(false);
                    customerAccessCode.value = '';
                    if (customerLoginStatus) {
                        customerLoginStatus.textContent = data.message || 'Access granted.';
                        customerLoginStatus.classList.add('success');
                    }
                    await loadCustomerSlotsForPortal();
                } catch (error) {
                    customerLoggedIn = false;
                    setCustomerPortalLocked(true);
                    if (customerLoginStatus) {
                        customerLoginStatus.textContent = error.message || 'Incorrect access code.';
                        customerLoginStatus.classList.add('error');
                    }
                }
            });
        }

        if (customerBookingForm) {
            customerBookingForm.addEventListener('submit', async (event) => {
                event.preventDefault();
                customerBookingFeedback?.classList.remove('visible', 'success', 'error');
                if (!customerLoggedIn) {
                    customerBookingFeedback.textContent = 'Please log in first to view and book customer slots.';
                    customerBookingFeedback.classList.add('visible', 'error');
                    return;
                }

                if (!selectedCustomerSlot) {
                    customerBookingFeedback.textContent = 'Select a customer slot before booking.';
                    customerBookingFeedback.classList.add('visible', 'error');
                    return;
                }

                const payload = {
                    slot_id: selectedCustomerSlot.id,
                    name: customerName.value.trim(),
                    phone: customerPhone.value.trim(),
                };

                if (!payload.name || !payload.phone) {
                    customerBookingFeedback.textContent = 'Name and phone are required to reserve your slot.';
                    customerBookingFeedback.classList.add('visible', 'error');
                    return;
                }

                try {
                    const res = await fetch(`${API_BASE}/customer/slots/book`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    const data = await res.json();
                    if (!res.ok) {
                        throw new Error(data.message || 'Unable to book this slot.');
                    }
                    customerBookingFeedback.textContent = data.message || 'Slot saved.';
                    customerBookingFeedback.classList.add('visible', 'success');
                    customerBookingForm.reset();
                    selectedCustomerSlot = null;
                    await loadCustomerSlotsForPortal();
                } catch (error) {
                    customerBookingFeedback.textContent = error.message || 'Unable to book this slot right now.';
                    customerBookingFeedback.classList.add('visible', 'error');
                }
            });
        }

        // Handle booking submission (step 1: choose slot)
        if (bookingForm && timeSelect && bookingResponse && modalTimeInput) {
            bookingForm.addEventListener('submit', (e) => {
                e.preventDefault();

                const chosenTime = timeSelect.value;

                bookingResponse.classList.remove('visible', 'success', 'error');

                if (!chosenTime) {
                    bookingResponse.innerText = '? Please choose a booking date and time first.';
                    bookingResponse.classList.add('visible', 'error');
                    return;
                }

                modalTimeInput.value = chosenTime;
                updateSelectedSlotDetails(chosenTime);
                openBookingDetailsModal();
            });
        }

        if (closeBookingModalBtn) {
            closeBookingModalBtn.addEventListener('click', () => {
                closeBookingDetailsModal({ returnFocus: true });
            });
        }

        if (bookingModal) {
            bookingModal.addEventListener('click', (event) => {
                if (event.target === bookingModal) {
                    closeBookingDetailsModal({ returnFocus: true });
                }
            });
        }

        document.addEventListener('keydown', (event) => {
            if (event.key === 'Escape') {
                if (bookingModal && bookingModal.classList.contains('visible')) {
                    closeBookingDetailsModal({ returnFocus: true });
                    return;
                }
                if (bookingThankYou && bookingThankYou.classList.contains('visible')) {
                    hideBookingThankYou();
                }
            }
        });

        if (bookingThankYou) {
            bookingThankYou.addEventListener('click', (event) => {
                if (event.target === bookingThankYou) {
                    hideBookingThankYou();
                }
            });
        }

        if (closeBookingThanksBtn) {
            closeBookingThanksBtn.addEventListener('click', hideBookingThankYou);
        }

        // Handle contact details submission (step 2)
        if (bookingDetailsForm) {
            bookingDetailsForm.addEventListener('submit', async (e) => {
                e.preventDefault();

            const payload = {
                name: modalCustomerName.value.trim(),
                location: modalLocation.value,
                email: modalEmail.value.trim(),
                phone: modalPhone.value.trim(),
                time: modalTimeInput.value,
            };

            modalFeedback.classList.remove('visible', 'error');
            modalFeedback.textContent = '';

            if (!payload.time) {
                modalFeedback.textContent = '? Please choose a booking slot again.';
                modalFeedback.classList.add('visible', 'error');
                return;
            }

            modalSubmitButton.disabled = true;
            modalSubmitText.textContent = 'Booking...';

            try {
                const res = await fetch(`${API_BASE}/book`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const data = await res.json();

                if (!res.ok) {
                    throw new Error(data.message || '? Error sending booking!');
                }

                closeBookingDetailsModal({ returnFocus: true, resetForm: true });

                bookingResponse.classList.remove('visible', 'success', 'error');
                bookingResponse.innerText = data.message;
                bookingResponse.classList.add('visible', 'success');

                if (bookingForm && typeof bookingForm.reset === 'function') {
                    bookingForm.reset();
                }
                showBookingThankYou();
                await loadAvailability();

            } catch (error) {
                modalFeedback.textContent = error.message || '? Error sending booking! Please try again.';
                modalFeedback.classList.add('visible', 'error');
            } finally {
                modalSubmitButton.disabled = false;
                modalSubmitText.textContent = 'Confirm booking';
            }
            });
        }

        if (contactForm) {
            contactForm.addEventListener('submit', async (event) => {
                event.preventDefault();

                const payload = {
                    name: document.getElementById('contactName').value.trim(),
                    phone: document.getElementById('contactPhone').value.trim(),
                    email: document.getElementById('contactEmail').value.trim(),
                    enquiry: document.getElementById('contactEnquiry').value.trim()
                };

                contactResponse.classList.remove('visible', 'success', 'error');
                contactResponse.textContent = '';

                if (contactSubmitButton) {
                    contactSubmitButton.disabled = true;
                    contactSubmitButton.classList.add('loading');
                }

                try {
                    const res = await fetch(`${API_BASE}/contact`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    const data = await res.json();
                    if (!res.ok) {
                        throw new Error(data.message || '? Unable to send your enquiry.');
                    }
                    contactForm.reset();
                    contactResponse.textContent = data.message || '? Thanks! We will be in touch soon.';
                    contactResponse.classList.add('visible', 'success');
                } catch (error) {
                    contactResponse.textContent = error.message || '? Unable to send your enquiry. Please try again.';
                    contactResponse.classList.add('visible', 'error');
                } finally {
                    if (contactSubmitButton) {
                        contactSubmitButton.disabled = false;
                        contactSubmitButton.classList.remove('loading');
                    }
                }
            });
        }

        // Load availability on page load
        if (Array.isArray(window.INITIAL_AVAILABILITY)) {
            renderAvailabilityGrid(window.INITIAL_AVAILABILITY);
        }
        hydrateServerRenderedAvailabilityLabels();
        loadAvailability();

        // ===== AUTO QUOTE POPUP FUNCTIONALITY =====
        const autoQuotePopup = document.getElementById('autoQuotePopup');
        const autoQuoteClose = document.getElementById('autoQuoteClose');
        const autoQuoteContent = document.getElementById('autoQuoteContent');
        const autoQuoteHeader = document.getElementById('autoQuoteHeader');
        const autoQuoteBtnYes = document.getElementById('autoQuoteBtnYes');
        const autoQuoteBtnNo = document.getElementById('autoQuoteBtnNo');
        const autoQuoteFeedback = document.getElementById('autoQuoteFeedback');

        let popupDismissed = false;
        let uploadedPhotos = [];

        function focusFirstAutoQuoteField() {
            if (!autoQuotePopup) return;
            const selector = [
                'button:not([disabled])',
                'input:not([disabled])',
                'select:not([disabled])',
                'textarea:not([disabled])',
                'a[href]'
            ].join(',');
            const el = autoQuotePopup.querySelector(selector);
            if (el && typeof el.focus === 'function') {
                el.focus({ preventScroll: true });
            }
        }

        function showAutoQuotePopup() {
            if (!autoQuotePopup) return;
            autoQuotePopup.classList.add('visible');
            autoQuotePopup.setAttribute('aria-hidden', 'false');
            document.body.classList.add('modal-open');
            popupDismissed = false;
            setTimeout(focusFirstAutoQuoteField, 80);
        }

        // Auto popup disabled: only show when the user chooses to (buttons/slots).

        // Close popup
        function closeAutoQuotePopup() {
            if (autoQuotePopup) {
                autoQuotePopup.classList.remove('visible');
                autoQuotePopup.setAttribute('aria-hidden', 'true');
                popupDismissed = true;
            }
            document.body.classList.remove('modal-open');
            window.__preselectedQuoteSlot = '';
        }

        if (autoQuoteClose) {
            autoQuoteClose.addEventListener('click', closeAutoQuotePopup);
        }

        // Close on outside click
        if (autoQuotePopup) {
            autoQuotePopup.addEventListener('click', (e) => {
                if (e.target === autoQuotePopup) {
                    closeAutoQuotePopup();
                }
            });
        }

        // Close on Escape
        document.addEventListener('keydown', (event) => {
            if (event.key === 'Escape' && autoQuotePopup && autoQuotePopup.classList.contains('visible')) {
                closeAutoQuotePopup();
            }
        });

        // Handle "No" button
        if (autoQuoteBtnNo) {
            autoQuoteBtnNo.addEventListener('click', closeAutoQuotePopup);
        }

        // Open auto-quote popup with a pre-selected slot.
        // We store it globally so the date/time step can be auto-filled.
        function openAutoQuoteWithSlot(selectedSlot) {
            if (!autoQuotePopup) return;

            const slot = (typeof selectedSlot === 'string') ? selectedSlot.trim() : '';
            window.__preselectedQuoteSlot = slot;

            // Show the popup and immediately start the quote flow.
            showAutoQuotePopup();

            // Prefer the existing "Yes" handler(s) to drive the flow.
            // Some parts of this page define multiple quote flows; triggering the button
            // lets the active one run without duplicating logic.
            if (autoQuoteBtnYes) {
                autoQuoteBtnYes.dispatchEvent(new MouseEvent('click', { bubbles: true }));
            }
        }

        // Smooth content transition with enhanced animations
        function transitionContent(newHTML, headerText = null) {
            if (!autoQuoteContent) return;

            autoQuoteContent.classList.add('fading');

            setTimeout(() => {
                autoQuoteContent.innerHTML = newHTML;
                if (headerText && autoQuoteHeader) {
                    autoQuoteHeader.querySelector('h3').textContent = headerText;
                }
                autoQuoteContent.classList.remove('fading');
                autoQuoteContent.classList.add('entering');
                
                // Trigger reflow
                autoQuoteContent.offsetHeight;
                
                autoQuoteContent.classList.remove('entering');
                autoQuoteContent.classList.add('entered');
                
                setTimeout(() => {
                    autoQuoteContent.classList.remove('entered');
                }, 400);

                setTimeout(() => {
                    // Move focus into the newly rendered step (mobile keyboard + accessibility)
                    if (!autoQuotePopup || !autoQuotePopup.classList.contains('visible')) return;
                    const field = autoQuoteContent.querySelector('input, select, textarea, button');
                    if (field && typeof field.focus === 'function') {
                        field.focus({ preventScroll: true });
                    }
                }, 30);
            }, 400);
        }

        // Handle "Yes" button - show area selection
        if (autoQuoteBtnYes) {
            autoQuoteBtnYes.addEventListener('click', () => {
                const areaHTML = `
                    <div class="auto-quote-text">
                        <p>What area are you in?</p>
                        <p style="font-size: 0.9rem; color: var(--text-light); margin-top: 8px;">These are the areas we cover</p>
                    </div>
                    <div class="auto-quote-form">
                        <div class="auto-quote-form-group">
                            <label for="autoQuoteArea">Select Your Area</label>
                            <select id="autoQuoteArea" required>
                                <option value="">Please select your area</option>
                                <option value="Audenshaw">Audenshaw</option>
                                <option value="Denton">Denton</option>
                                <option value="Dukinfield">Dukinfield</option>
                            </select>
                        </div>
                        <button type="button" id="autoQuoteAreaNext" class="auto-quote-submit">Next</button>
                    </div>
                `;

                transitionContent(areaHTML, 'Select Your Area');

                // Add event listener to the next button
                setTimeout(() => {
                    const areaNextBtn = document.getElementById('autoQuoteAreaNext');
                    const areaSelect = document.getElementById('autoQuoteArea');

                    if (areaNextBtn && areaSelect) {
                        areaNextBtn.addEventListener('click', () => {
                            const selectedArea = areaSelect.value;
                            if (!selectedArea) {
                                alert('Please select your area');
                                return;
                            }
                            showDateSelection(selectedArea);
                        });
                    }
                }, 450);
            });
        }

        // Show date selection
        async function showDateSelection(selectedArea) {
            try {
                const preselected = typeof window.__preselectedQuoteSlot === 'string' ? window.__preselectedQuoteSlot.trim() : '';
                // Fetch available dates
                const candidates = [];
                const overrideBase = typeof window.APP_API_BASE === 'string' ? window.APP_API_BASE.trim() : '';
                if (overrideBase) candidates.push(overrideBase);
                if (window.location?.origin) candidates.push(window.location.origin);
                if (typeof DEFAULT_API_BASE === 'string' && DEFAULT_API_BASE) candidates.push(DEFAULT_API_BASE);

                const seen = new Set();
                const uniqueCandidates = candidates.filter((base) => {
                    if (!base || seen.has(base)) return false;
                    seen.add(base);
                    return true;
                });

                let slots = [];
                let lastError = null;

                for (const base of uniqueCandidates) {
                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => controller.abort(), 8000);
                    try {
                        const res = await fetch(`${base}/availability`, {
                            signal: controller.signal,
                            cache: 'no-store'
                        });
                        if (!res.ok) {
                            throw new Error(`${base}/availability returned ${res.status}`);
                        }
                        const data = await res.json();
                        if (!Array.isArray(data)) {
                            throw new Error(`${base}/availability returned an unexpected response`);
                        }
                        slots = data;
                        lastError = null;
                        break;
                    } catch (error) {
                        lastError = error;
                    } finally {
                        clearTimeout(timeoutId);
                    }
                }

                if (lastError) {
                    throw lastError;
                }

                let dateOptionsHTML = '';
                if (slots.length === 0) {
                    dateOptionsHTML = '<option value="">No slots available at the moment</option>';
                } else {
                    dateOptionsHTML = '<option value="">Please select a date and time</option>';

                    if (preselected && !slots.includes(preselected)) {
                        dateOptionsHTML += `<option value="${preselected}" selected>${formatSlotLabel(preselected)}</option>`;
                    }

                    slots.forEach((slot) => {
                        const formattedSlot = formatSlotLabel(slot);
                        const selectedAttr = preselected && slot === preselected ? ' selected' : '';
                        dateOptionsHTML += `<option value="${slot}"${selectedAttr}>${formattedSlot}</option>`;
                    });
                }

                const newHTML = `
                    <div class="auto-quote-text">
                        <p>We have the following dates and times available. Please choose which is best for you:</p>
                    </div>
                    <div class="auto-quote-form">
                        <input type="hidden" id="autoQuoteSelectedArea" value="${selectedArea}">
                        <div class="auto-quote-form-group">
                            <label for="autoQuoteDate">Available Dates & Times</label>
                            <select id="autoQuoteDate" required>
                                ${dateOptionsHTML}
                            </select>
                        </div>
                        <button type="button" id="autoQuoteDateNext" class="auto-quote-submit" ${slots.length === 0 ? 'disabled' : ''}>Next</button>
                    </div>
                `;

                transitionContent(newHTML, 'Choose Your Appointment');

                // Add event listener to the next button
                setTimeout(() => {
                    const dateNextBtn = document.getElementById('autoQuoteDateNext');
                    const dateSelect = document.getElementById('autoQuoteDate');

                    if (dateNextBtn && dateSelect) {
                        if (preselected) {
                            dateSelect.value = preselected;
                        }
                        dateNextBtn.addEventListener('click', () => {
                            const selectedDate = dateSelect.value;
                            if (!selectedDate) {
                                alert('Please select a date and time');
                                return;
                            }
                            showPhotoUpload(selectedDate, selectedArea);
                        });
                    }
                }, 450);

            } catch (error) {
                console.error('Error loading dates:', error);
                const message = error && error.name === 'AbortError'
                    ? 'The booking server is taking too long to respond. Please try again in a moment.'
                    : 'Unable to load available dates. Please try again or contact us directly.';
                const errorHTML = `
                    <div class="auto-quote-text">
                        <p style="color: var(--secondary);">${message}</p>
                    </div>
                    <div class="auto-quote-actions">
                        <button type="button" class="auto-quote-btn auto-quote-btn-no" onclick="closeAutoQuotePopup()">Close</button>
                    </div>
                `;
                transitionContent(errorHTML);
            }
        }

        // Show photo upload screen
        function showPhotoUpload(selectedSlot, selectedArea) {
            const photoHTML = `
                <div class="auto-quote-text">
                    <p>Would you like to upload some photos of your garden?</p>
                    <p style="font-size: 0.9rem; color: var(--text-light); margin-top: 8px;">This helps us provide a more accurate quote</p>
                </div>
                <div class="auto-quote-form">
                    <input type="hidden" id="autoQuoteSelectedSlot" value="${selectedSlot}">
                    <input type="hidden" id="autoQuoteSelectedArea" value="${selectedArea}">
                    <div class="auto-quote-form-group">
                        <label for="autoQuotePhotos">Garden Photos (optional)</label>
                        <input type="file" id="autoQuotePhotos" accept="image/*" multiple style="padding: 8px; cursor: pointer;">
                        <p style="font-size: 0.85rem; color: var(--text-light); margin-top: 4px;">You can select multiple photos</p>
                    </div>
                    <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                        <button type="button" id="autoQuotePhotosNext" class="auto-quote-submit" style="flex: 1;">Continue</button>
                        <button type="button" id="autoQuotePhotosSkip" class="auto-quote-btn auto-quote-btn-no" style="flex: 1;">Skip</button>
                    </div>
                </div>
            `;

            transitionContent(photoHTML, 'Upload Photos');

            // Add event listeners
            setTimeout(() => {
                const photosNextBtn = document.getElementById('autoQuotePhotosNext');
                const photosSkipBtn = document.getElementById('autoQuotePhotosSkip');
                const photosInput = document.getElementById('autoQuotePhotos');

                if (photosNextBtn) {
                    photosNextBtn.addEventListener('click', async () => {
                        const files = photosInput ? photosInput.files : null;
                        
                        if (files && files.length > 0) {
                            photosNextBtn.disabled = true;
                            photosNextBtn.textContent = 'Processing photos...';
                            
                            uploadedPhotos = [];
                            for (let i = 0; i < files.length; i++) {
                                try {
                                    const base64 = await fileToBase64(files[i]);
                                    uploadedPhotos.push({
                                        name: files[i].name,
                                        data: base64
                                    });
                                } catch (err) {
                                    console.error('Error converting image:', err);
                                }
                            }
                        }
                        
                        showServiceType(selectedSlot, selectedArea);
                    });
                }

                if (photosSkipBtn) {
                    photosSkipBtn.addEventListener('click', () => {
                        uploadedPhotos = [];
                        showServiceType(selectedSlot, selectedArea);
                    });
                }
            }, 450);
        }

        // Helper function to convert file to base64
        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
            });
        }

        // Show service type selection (one-off or regular)
        function showServiceType(selectedSlot, selectedArea) {
            const serviceHTML = `
                <div class="auto-quote-text">
                    <p>What type of service would you like?</p>
                </div>
                <div class="auto-quote-form">
                    <input type="hidden" id="autoQuoteSelectedSlot" value="${selectedSlot}">
                    <input type="hidden" id="autoQuoteSelectedArea" value="${selectedArea}">
                    <div class="auto-quote-form-group">
                        <label for="autoQuoteServiceType">Service Type</label>
                        <select id="autoQuoteServiceType" required>
                            <option value="">Please select</option>
                            <option value="one-off">One-off Cut</option>
                            <option value="regular">Regular Cuts</option>
                        </select>
                    </div>
                    <button type="button" id="autoQuoteServiceNext" class="auto-quote-submit">Next</button>
                </div>
            `;

            transitionContent(serviceHTML, 'Service Type');

            // Add event listener
            setTimeout(() => {
                const serviceNextBtn = document.getElementById('autoQuoteServiceNext');
                const serviceSelect = document.getElementById('autoQuoteServiceType');

                if (serviceNextBtn && serviceSelect) {
                    serviceNextBtn.addEventListener('click', () => {
                        const serviceType = serviceSelect.value;
                        if (!serviceType) {
                            alert('Please select a service type');
                            return;
                        }
                        showDetailsForm(selectedSlot, selectedArea, serviceType);
                    });
                }
            }, 450);
        }

        // Show details form
        function showDetailsForm(selectedSlot, selectedArea, serviceType) {
            const formHTML = `
                <div class="auto-quote-text">
                    <p>Great! Please provide your details to complete your free quote request:</p>
                </div>
                <form class="auto-quote-form compact" id="autoQuoteDetailsForm">
                    <input type="hidden" id="autoQuoteSelectedSlot" value="${selectedSlot}">
                    <input type="hidden" id="autoQuoteSelectedArea" value="${selectedArea}">
                    <input type="hidden" id="autoQuoteServiceType" value="${serviceType}">
                    <div class="auto-quote-form-group">
                        <label for="autoQuoteName">Your Name *</label>
                        <input type="text" id="autoQuoteName" required placeholder="Enter your full name">
                    </div>
                    <div class="auto-quote-form-group">
                        <label for="autoQuoteAddress">Address (optional)</label>
                        <input type="text" id="autoQuoteAddress" placeholder="House number + postcode">
                    </div>
                    <div class="auto-quote-form-row">
                        <div class="auto-quote-form-group">
                            <label for="autoQuoteEmail">Email Address *</label>
                            <input type="email" id="autoQuoteEmail" required placeholder="your.email@example.com">
                        </div>
                        <div class="auto-quote-form-group">
                            <label for="autoQuotePhone">Mobile Number *</label>
                            <input type="tel" id="autoQuotePhone" required placeholder="07123 456789">
                        </div>
                    </div>
                    <button type="submit" class="auto-quote-submit">Get My Free Quote</button>
                    <div class="auto-quote-feedback" id="autoQuoteFeedback"></div>
                </form>
            `;

            transitionContent(formHTML, 'Your Details');

            // Add form submit handler
            setTimeout(() => {
                const detailsForm = document.getElementById('autoQuoteDetailsForm');
                if (detailsForm) {
                    detailsForm.addEventListener('submit', async function(e) {
                        e.preventDefault();
                        
                        const name = document.getElementById('autoQuoteName').value.trim();
                        const email = document.getElementById('autoQuoteEmail').value.trim();
                        const phone = document.getElementById('autoQuotePhone').value.trim();
                        
                        if (!name || !email || !phone) {
                            alert('Please fill in all required fields');
                            return;
                        }
                        
                        // Send SMS verification code
                        await sendSmsVerification(selectedSlot, selectedArea, serviceType, name, email, phone);
                    });
                }
            }, 450);
        }

        // Send SMS verification code to the customer's mobile number
        // Helper: fetch with timeout
        function fetchWithTimeout(url, options, timeoutMs = 30000) {
            const controller = new AbortController();
            const timer = setTimeout(() => controller.abort(), timeoutMs);
            return fetch(url, { ...options, signal: controller.signal })
                .catch(err => {
                    if (err.name === 'AbortError') throw new Error('Request timed out. Please check your connection and try again.');
                    throw new Error('Unable to reach the server. Please check your internet connection.');
                })
                .finally(() => clearTimeout(timer));
        }

        async function sendSmsVerification(selectedSlot, selectedArea, serviceType, name, email, phone) {
            const sendingHTML = `
                <div class="auto-quote-text">
                    <p><i class="fas fa-spinner fa-spin" aria-hidden="true"></i> Sending a verification code to <strong>${phone}</strong>…</p>
                </div>
            `;
            transitionContent(sendingHTML, 'Verify Mobile');

            try {
                const sendRes = await fetchWithTimeout(API_BASE + '/api/send-verification', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ phone })
                });
                const sendData = await sendRes.json().catch(() => ({}));
                if (!sendRes.ok) throw new Error(sendData.message || 'Unable to send SMS code.');
            } catch (err) {
                // SMS not configured – submit without verification
                const friendlyMsg = (err.message || 'Unable to send verification code.').replace(/</g, '&lt;');
                const errorHTML = `
                    <div class="auto-quote-text">
                        <p style="color: var(--secondary);">${friendlyMsg}</p>
                        <p style="margin-top: 16px; font-size: 0.9rem;">We'll process your quote without phone verification.</p>
                    </div>
                    <div class="auto-quote-actions">
                        <button type="button" class="auto-quote-btn auto-quote-btn-yes" id="continueWithoutVerification">Continue</button>
                    </div>
                `;
                transitionContent(errorHTML, 'Verification Unavailable');
                setTimeout(() => {
                    document.getElementById('continueWithoutVerification')?.addEventListener('click', () => {
                        submitQuote(selectedSlot, selectedArea, serviceType, name, email, phone, null);
                    });
                }, 450);
                return;
            }

            const codeHTML = `
                <div class="auto-quote-text">
                    <p style="margin-bottom: 12px;">We've sent a <strong>4-digit code</strong> to <strong>${phone}</strong>.</p>
                    <p style="font-size: 0.9rem; color: var(--text-light);">Enter it below to verify it's you.</p>
                </div>
                <div class="auto-quote-form">
                    <div class="auto-quote-form-group">
                        <label for="smsVerifyCode">Verification Code</label>
                        <input type="text" id="smsVerifyCode" maxlength="4" pattern="[0-9]{4}" inputmode="numeric" autocomplete="one-time-code" required placeholder="Enter 4-digit code" style="text-align:center; font-size:1.6rem; letter-spacing:0.5em; font-weight:700;" />
                    </div>
                    <button type="button" id="smsVerifyBtn" class="auto-quote-submit">Verify</button>
                    <p style="font-size: 0.85rem; color: var(--text-light); margin: 10px 0 0; text-align: center;">Didn't get a code? Close this and try again in a minute.</p>
                    <div class="auto-quote-feedback" id="smsVerifyFeedback" style="margin-top: 14px;"></div>
                </div>
            `;

            transitionContent(codeHTML, 'Verify Mobile');

            setTimeout(() => {
                const codeInput = document.getElementById('smsVerifyCode');
                const verifyBtn = document.getElementById('smsVerifyBtn');
                const feedback = document.getElementById('smsVerifyFeedback');

                codeInput?.focus();

                verifyBtn?.addEventListener('click', async () => {
                    const code = (codeInput?.value || '').trim();
                    if (!code || code.length !== 4) {
                        if (feedback) {
                            feedback.textContent = 'Please enter the 4-digit code.';
                            feedback.className = 'auto-quote-feedback visible error';
                        }
                        return;
                    }
                    verifyBtn.disabled = true;
                    verifyBtn.textContent = 'Verifying…';
                    try {
                        const res = await fetchWithTimeout(API_BASE + '/api/verify-code', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ phone, code })
                        });
                        const data = await res.json().catch(() => ({}));
                        if (!res.ok) throw new Error(data.message || 'Invalid code.');
                        submitQuote(selectedSlot, selectedArea, serviceType, name, email, phone, true);
                    } catch (err) {
                        verifyBtn.disabled = false;
                        verifyBtn.textContent = 'Verify';
                        if (feedback) {
                            feedback.textContent = err.message || 'Verification failed.';
                            feedback.className = 'auto-quote-feedback visible error';
                        }
                    }
                });
            }, 450);
        }

        // Submit the final quote
        async function submitQuote(selectedSlot, selectedArea, serviceType, name, email, phone, verified) {
            try {
                const res = await fetch(`${API_BASE}/book`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        name: name,
                        email: email,
                        phone: phone,
                        location: selectedArea,
                        time: selectedSlot,
                        service_type: serviceType,
                        photos: uploadedPhotos,
                        verified: verified
                    })
                });

                const data = await res.json();

                if (!res.ok) {
                    throw new Error(data.message || 'Unable to submit your quote request.');
                }

                // Show success message
                const successHTML = `
                    <div class="auto-quote-text" style="padding: 24px 0;">
                        <div style="font-size: 64px; margin-bottom: 16px; color: var(--primary);"><i class="fas fa-seedling" aria-hidden="true"></i></div>
                        <p style="font-size: 1.3rem; font-weight: 700; color: var(--primary); margin-bottom: 12px;">Quote Request Received!</p>
                        <p style="margin-bottom: 20px;">${data.message || 'Thank you! We\'ll be in touch soon to discuss your free quote.'}</p>
                        ${verified ? '<p style="font-size: 0.9rem; color: var(--primary);"><i class="fas fa-check-circle" aria-hidden="true"></i> Phone verified</p>' : ''}
                        <button type="button" class="auto-quote-btn auto-quote-btn-yes" onclick="closeAutoQuotePopup()" style="margin-top: 16px;">Close</button>
                    </div>
                `;

                transitionContent(successHTML, 'Success!');
                await loadAvailability(); // Reload availability
                uploadedPhotos = []; // Clear uploaded photos

            } catch (error) {
                const errorHTML = `
                    <div class="auto-quote-text">
                        <p style="color: var(--secondary);">${error.message || 'Unable to submit. Please try again.'}</p>
                    </div>
                    <div class="auto-quote-actions">
                        <button type="button" class="auto-quote-btn auto-quote-btn-no" onclick="closeAutoQuotePopup()">Close</button>
                    </div>
                `;
                transitionContent(errorHTML);
            }
        }

        // Handle form submission (DEPRECATED - now using submitQuote)
        async function handleQuoteSubmission(e) {
            e.preventDefault();

            const feedback = document.getElementById('autoQuoteFeedback');
            const submitBtn = e.target.querySelector('button[type="submit"]');
            const selectedSlot = document.getElementById('autoQuoteSelectedSlot').value;
            const selectedArea = document.getElementById('autoQuoteSelectedArea').value;
            const serviceType = document.getElementById('autoQuoteServiceType').value;
            const name = document.getElementById('autoQuoteName').value.trim();
            const email = document.getElementById('autoQuoteEmail').value.trim();
            const phone = document.getElementById('autoQuotePhone').value.trim();

            if (!name || !email || !phone) {
                if (feedback) {
                    feedback.textContent = 'Please fill in all required fields.';
                    feedback.className = 'auto-quote-feedback visible error';
                }
                return;
            }

            if (submitBtn) {
                submitBtn.disabled = true;
                submitBtn.textContent = 'Submitting...';
            }

            if (feedback) {
                feedback.classList.remove('visible', 'error', 'success');
            }

            try {
                const res = await fetch(`${API_BASE}/book`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        name: name,
                        email: email,
                        phone: phone,
                        location: selectedArea,
                        time: selectedSlot,
                        service_type: serviceType,
                        photos: uploadedPhotos
                    })
                });

                const data = await res.json();

                if (!res.ok) {
                    throw new Error(data.message || 'Unable to submit your quote request.');
                }

                // Show success message
                const successHTML = `
                    <div class="auto-quote-text" style="padding: 24px 0;">
                        <div style="font-size: 64px; margin-bottom: 16px; color: var(--primary);"><i class="fas fa-seedling" aria-hidden="true"></i></div>
                        <p style="font-size: 1.3rem; font-weight: 700; color: var(--primary); margin-bottom: 12px;">Quote Request Received!</p>
                        <p style="margin-bottom: 20px;">${data.message || 'Thank you! We\'ll be in touch soon to discuss your free quote.'}</p>
                        <button type="button" class="auto-quote-btn auto-quote-btn-yes" onclick="closeAutoQuotePopup()">Close</button>
                    </div>
                `;

                transitionContent(successHTML, 'Success!');
                await loadAvailability(); // Reload availability

            } catch (error) {
                if (feedback) {
                    feedback.textContent = error.message || 'Unable to submit. Please try again.';
                    feedback.className = 'auto-quote-feedback visible error';
                }
                if (submitBtn) {
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'Get My Free Quote';
                }
            }
        }

        // Make closeAutoQuotePopup available globally
        window.closeAutoQuotePopup = closeAutoQuotePopup;
    </script>

    <!-- Firebase/Google auth removed – SMS verification is used instead -->

    <!-- Auto Quote Popup: resilient flow (runs even if earlier script errors) -->
    <script>
        (() => {
            const DEFAULT_API_BASE = "https://booking-app-1-gh2v.onrender.com";
            const APP_API_BASE = typeof window.APP_API_BASE === 'string' ? window.APP_API_BASE.trim() : '';
            const PAGE_ORIGIN = window.location?.origin || '';
            const ORIGIN_LOOKS_LIKE_BACKEND = /(localhost|127\.0\.0\.1|onrender\.com)/i.test(PAGE_ORIGIN);
            const API_BASE = APP_API_BASE || (ORIGIN_LOOKS_LIKE_BACKEND ? PAGE_ORIGIN : DEFAULT_API_BASE);

            const popup = document.getElementById('autoQuotePopup');
            const content = document.getElementById('autoQuoteContent');
            const header = document.getElementById('autoQuoteHeader');
            const btnYes = document.getElementById('autoQuoteBtnYes');
            const btnNo = document.getElementById('autoQuoteBtnNo');
            const closeBtn = document.getElementById('autoQuoteClose');

            if (!popup || !content) return;

            let selectedArea = '';
            let selectedSlot = '';
            let uploadedPhotos = [];
            let serviceType = '';
            let customerName = '';
            let customerAddress = '';
            let customerEmail = '';
            let customerPhone = '';
            let verified = false;

            const close = () => {
                popup.classList.remove('visible');
                window.__preselectedQuoteSlot = '';
            };
            const show = () => popup.classList.add('visible');

            closeBtn?.addEventListener('click', close);
            btnNo?.addEventListener('click', close);
            popup.addEventListener('click', (e) => {
                if (e.target === popup) close();
            });

            // Allow the appointments section to open the quote popup reliably.
            // This lives inside the "resilient" popup script so it still works even if
            // earlier scripts fail to load/bind.
            const openWithSlot = (slotValue) => {
                const slot = (typeof slotValue === 'string') ? slotValue.trim() : '';
                if (!slot) return;
                window.__preselectedQuoteSlot = slot;
                show();
                // Trigger the existing flow.
                btnYes?.dispatchEvent(new MouseEvent('click', { bubbles: true }));
            };
            window.openAutoQuoteWithSlot = openWithSlot;

            // Click on an appointment card
            document.addEventListener('click', (event) => {
                const target = event.target;
                const button = target?.closest ? target.closest('.availability-slot') : null;
                if (!button) return;
                const slot = button.getAttribute('data-slot') || '';
                openWithSlot(slot);
            });


            const setHeader = (text) => {
                if (!header) return;
                const h3 = header.querySelector('h3');
                if (h3) h3.textContent = text;
            };

            const transition = (newHTML, headerText) => {
                if (headerText) setHeader(headerText);

                content.classList.add('fading');
                window.setTimeout(() => {
                    try {
                        content.innerHTML = newHTML;
                    } finally {
                        content.classList.remove('fading');
                        content.classList.add('entering');
                        void content.offsetHeight;
                        content.classList.remove('entering');
                        content.classList.add('entered');
                        window.setTimeout(() => content.classList.remove('entered'), 400);
                    }
                }, 400);
            };

            const formatSlotLabel = (slot) => {
                if (!slot || typeof slot !== 'string') return slot;
                const parts = slot.split(' ');
                if (parts.length < 2) return slot;
                const [datePart, timePart] = parts;
                const date = new Date(`${datePart}T${timePart}`);
                if (Number.isNaN(date.getTime())) return slot;
                const weekday = date.toLocaleDateString('en-GB', { weekday: 'short' });
                const day = date.getDate();
                const suffix = (day % 10 === 1 && day % 100 !== 11)
                    ? 'st'
                    : (day % 10 === 2 && day % 100 !== 12)
                    ? 'nd'
                    : (day % 10 === 3 && day % 100 !== 13)
                    ? 'rd'
                    : 'th';
                const month = date.toLocaleDateString('en-GB', { month: 'short' });
                const year = String(date.getFullYear()).slice(-2);
                return `${weekday} ${day}${suffix} ${month} ${year} ${timePart}`;
            };

            const showAreaStep = () => {
                const areaHTML = `
                    <div class="auto-quote-text">
                        <p>What area are you in?</p>
                        <p style="font-size: 0.9rem; color: var(--text-light); margin-top: 8px;">These are the areas we cover</p>
                    </div>
                    <div class="auto-quote-form">
                        <div class="auto-quote-form-group">
                            <label for="autoQuoteArea">Select Your Area</label>
                            <select id="autoQuoteArea" required>
                                <option value="">Please select your area</option>
                                <option value="Audenshaw">Audenshaw</option>
                                <option value="Denton">Denton</option>
                                <option value="Dukinfield">Dukinfield</option>
                            </select>
                        </div>
                        <button type="button" id="autoQuoteAreaNext" class="auto-quote-submit">Next</button>
                        <div id="autoQuoteAreaFeedback" class="auto-quote-feedback" style="margin-top: 14px;"></div>
                    </div>
                `;

                transition(areaHTML, 'Select Your Area');

                window.setTimeout(() => {
                    const nextBtn = document.getElementById('autoQuoteAreaNext');
                    const areaSelect = document.getElementById('autoQuoteArea');
                    const feedback = document.getElementById('autoQuoteAreaFeedback');

                    nextBtn?.addEventListener('click', () => {
                        const value = (areaSelect?.value || '').trim();
                        if (!value) {
                            if (feedback) {
                                feedback.textContent = 'Please select your area.';
                                feedback.className = 'auto-quote-feedback visible error';
                            }
                            return;
                        }
                        selectedArea = value;
                        showDateStep();
                    });
                }, 450);
            };

            const showDateStep = async () => {
                const loadingHTML = `
                    <div class="auto-quote-text">
                        <p>Loading available dates and times…</p>
                    </div>
                `;
                transition(loadingHTML, 'Choose a Date');

                const candidates = [];
                const overrideBase = typeof window.APP_API_BASE === 'string' ? window.APP_API_BASE.trim() : '';
                if (overrideBase) candidates.push(overrideBase);
                if (window.location?.origin) candidates.push(window.location.origin);
                if (typeof DEFAULT_API_BASE === 'string' && DEFAULT_API_BASE) candidates.push(DEFAULT_API_BASE);

                const seen = new Set();
                const uniqueCandidates = candidates.filter((base) => {
                    if (!base || seen.has(base)) return false;
                    seen.add(base);
                    return true;
                });

                let slots = [];
                for (const base of uniqueCandidates) {
                    const controller = new AbortController();
                    const timeoutId = window.setTimeout(() => controller.abort(), 8000);
                    try {
                        const res = await fetch(`${base}/availability`, {
                            signal: controller.signal,
                            cache: 'no-store'
                        });
                        if (!res.ok) throw new Error('bad-status');
                        const data = await res.json();
                        if (Array.isArray(data)) {
                            slots = data;
                            break;
                        }
                    } catch (e) {
                        // try next base
                    } finally {
                        window.clearTimeout(timeoutId);
                    }
                }

                const options = slots.length
                    ? ['<option value="">Please select a date and time</option>', ...slots.map(s => `<option value="${s}">${formatSlotLabel(s)}</option>`)].join('')
                    : '<option value="">No slots available at the moment</option>';

                const html = `
                    <div class="auto-quote-text">
                        <p>We have the following dates and times available. Please choose which is best for you:</p>
                    </div>
                    <div class="auto-quote-form">
                        <div class="auto-quote-form-group">
                            <label for="autoQuoteSlot">Select a Date & Time</label>
                            <select id="autoQuoteSlot" ${slots.length ? 'required' : 'disabled'}>
                                ${options}
                            </select>
                        </div>
                        <button type="button" id="autoQuoteSlotNext" class="auto-quote-submit" ${slots.length ? '' : 'disabled'}>Next</button>
                        <div id="autoQuoteSlotFeedback" class="auto-quote-feedback" style="margin-top: 14px;"></div>
                    </div>
                `;

                transition(html, 'Choose a Date');

                window.setTimeout(() => {
                    const nextBtn = document.getElementById('autoQuoteSlotNext');
                    const select = document.getElementById('autoQuoteSlot');
                    const feedback = document.getElementById('autoQuoteSlotFeedback');

                    const preselected = typeof window.__preselectedQuoteSlot === 'string' ? window.__preselectedQuoteSlot.trim() : '';
                    if (select && preselected) {
                        // If the slot is missing for any reason, inject it.
                        if (!Array.from(select.options).some((o) => o.value === preselected)) {
                            const opt = document.createElement('option');
                            opt.value = preselected;
                            opt.textContent = formatSlotLabel(preselected);
                            select.insertBefore(opt, select.options.length > 0 ? select.options[1] : null);
                        }
                        select.value = preselected;
                    }

                    nextBtn?.addEventListener('click', () => {
                        const value = (select?.value || '').trim();
                        if (!value) {
                            if (feedback) {
                                feedback.textContent = 'Please select a date and time.';
                                feedback.className = 'auto-quote-feedback visible error';
                            }
                            return;
                        }
                        selectedSlot = value;
                        showPhotosStep();
                    });
                }, 450);
            };

            const fileToBase64 = (file) => new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(String(reader.result || ''));
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });

            const showPhotosStep = () => {
                const html = `
                    <div class="auto-quote-text">
                        <p>Upload a few photos of your garden (optional)</p>
                        <p style="font-size: 0.9rem; color: var(--text-light); margin-top: 8px;">Photos help us give a more accurate quote.</p>
                    </div>
                    <div class="auto-quote-form">
                        <div class="auto-quote-form-group">
                            <input type="file" id="autoQuotePhotos" accept="image/*" multiple />
                            <div id="autoQuotePhotoPreview" style="display:flex; gap:10px; flex-wrap:wrap; margin-top:12px;"></div>
                        </div>
                        <button type="button" id="autoQuotePhotosNext" class="auto-quote-submit">Next</button>
                        <button type="button" id="autoQuotePhotosSkip" class="auto-quote-btn auto-quote-btn-no" style="width:100%; margin-top:10px;">Skip</button>
                        <div id="autoQuotePhotosFeedback" class="auto-quote-feedback" style="margin-top: 14px;"></div>
                    </div>
                `;

                transition(html, 'Upload Photos');

                window.setTimeout(() => {
                    const input = document.getElementById('autoQuotePhotos');
                    const preview = document.getElementById('autoQuotePhotoPreview');
                    const nextBtn = document.getElementById('autoQuotePhotosNext');
                    const skipBtn = document.getElementById('autoQuotePhotosSkip');
                    const feedback = document.getElementById('autoQuotePhotosFeedback');

                    const renderPreview = () => {
                        if (!preview) return;
                        preview.innerHTML = '';
                        uploadedPhotos.slice(0, 6).forEach((src) => {
                            const img = document.createElement('img');
                            img.src = src;
                            img.alt = 'Uploaded garden photo';
                            img.style.cssText = 'width:68px;height:68px;object-fit:cover;border-radius:12px;border:1px solid rgba(0,0,0,.08)';
                            preview.appendChild(img);
                        });
                    };

                    input?.addEventListener('change', async () => {
                        try {
                            const files = Array.from(input.files || []);
                            if (!files.length) return;
                            const base64 = await Promise.all(files.slice(0, 6).map(fileToBase64));
                            uploadedPhotos = base64;
                            renderPreview();
                            if (feedback) {
                                feedback.textContent = `${uploadedPhotos.length} photo(s) added.`;
                                feedback.className = 'auto-quote-feedback visible success';
                            }
                        } catch (e) {
                            if (feedback) {
                                feedback.textContent = 'Unable to read photos. Please try different images.';
                                feedback.className = 'auto-quote-feedback visible error';
                            }
                        }
                    });

                    nextBtn?.addEventListener('click', () => showServiceTypeStep());
                    skipBtn?.addEventListener('click', () => {
                        uploadedPhotos = [];
                        showServiceTypeStep();
                    });
                }, 450);
            };

            const showServiceTypeStep = () => {
                const html = `
                    <div class="auto-quote-text">
                        <p>Is this a one-off cut or regular cuts?</p>
                    </div>
                    <div class="auto-quote-form">
                        <div class="auto-quote-form-group" style="text-align:left;">
                            <label style="display:flex; gap:10px; align-items:center; margin:10px 0;">
                                <input type="radio" name="autoQuoteServiceType" value="One-off" ${serviceType === 'One-off' ? 'checked' : ''} />
                                <span>One-off cut</span>
                            </label>
                            <label style="display:flex; gap:10px; align-items:center; margin:10px 0;">
                                <input type="radio" name="autoQuoteServiceType" value="Regular" ${serviceType === 'Regular' ? 'checked' : ''} />
                                <span>Regular cuts</span>
                            </label>
                        </div>
                        <button type="button" id="autoQuoteServiceNext" class="auto-quote-submit">Next</button>
                        <div id="autoQuoteServiceFeedback" class="auto-quote-feedback" style="margin-top: 14px;"></div>
                    </div>
                `;

                transition(html, 'Service Type');

                window.setTimeout(() => {
                    const nextBtn = document.getElementById('autoQuoteServiceNext');
                    const feedback = document.getElementById('autoQuoteServiceFeedback');

                    nextBtn?.addEventListener('click', () => {
                        const selected = document.querySelector('input[name="autoQuoteServiceType"]:checked');
                        const value = (selected?.value || '').trim();
                        if (!value) {
                            if (feedback) {
                                feedback.textContent = 'Please choose one option.';
                                feedback.className = 'auto-quote-feedback visible error';
                            }
                            return;
                        }
                        serviceType = value;
                        showDetailsStep();
                    });
                }, 450);
            };

            const showDetailsStep = () => {
                const html = `
                    <div class="auto-quote-text">
                        <p>Great — where should we send your quote?</p>
                        <p style="font-size: 0.9rem; color: var(--text-light); margin-top: 8px;">We’ll send a verification code to your mobile to confirm it’s you.</p>
                    </div>
                    <form class="auto-quote-form compact" id="autoQuoteDetailsForm">
                        <div class="auto-quote-form-group">
                            <label for="autoQuoteName">Full Name</label>
                            <input id="autoQuoteName" type="text" required value="${customerName.replace(/"/g, '&quot;')}" />
                        </div>
                        <div class="auto-quote-form-group">
                            <label for="autoQuoteAddress">Address (optional)</label>
                            <input id="autoQuoteAddress" type="text" value="${customerAddress.replace(/"/g, '&quot;')}" />
                        </div>
                        <div class="auto-quote-form-row">
                            <div class="auto-quote-form-group">
                                <label for="autoQuoteEmail">Email</label>
                                <input id="autoQuoteEmail" type="email" required value="${customerEmail.replace(/"/g, '&quot;')}" />
                            </div>
                            <div class="auto-quote-form-group">
                                <label for="autoQuotePhone">Mobile Number</label>
                                <input id="autoQuotePhone" type="tel" required placeholder="e.g. 07123 456789" value="${customerPhone.replace(/"/g, '&quot;')}" />
                            </div>
                        </div>
                        <button type="submit" class="auto-quote-submit">Send Verification Code</button>
                        <div id="autoQuoteDetailsFeedback" class="auto-quote-feedback" style="margin-top: 14px;"></div>
                    </form>
                `;

                transition(html, 'Your Details');

                window.setTimeout(() => {
                    const form = document.getElementById('autoQuoteDetailsForm');
                    const feedback = document.getElementById('autoQuoteDetailsFeedback');

                    form?.addEventListener('submit', async (e) => {
                        e.preventDefault();

                        const nameEl = document.getElementById('autoQuoteName');
                        const addressEl = document.getElementById('autoQuoteAddress');
                        const emailEl = document.getElementById('autoQuoteEmail');
                        const phoneEl = document.getElementById('autoQuotePhone');

                        customerName = (nameEl?.value || '').trim();
                        customerAddress = (addressEl?.value || '').trim();
                        customerEmail = (emailEl?.value || '').trim();
                        customerPhone = (phoneEl?.value || '').trim();
                        verified = false;

                        if (!customerName || !customerEmail || !customerPhone) {
                            if (feedback) {
                                feedback.textContent = 'Please enter name, email, and mobile.';
                                feedback.className = 'auto-quote-feedback visible error';
                            }
                            return;
                        }

                        showSmsVerifyStep();
                    });
                }, 450);
            };

            const showSmsVerifyStep = async () => {
                // Helper: fetch with timeout for resilient popup
                const fetchT = (url, opts, ms = 30000) => {
                    const c = new AbortController();
                    const t = setTimeout(() => c.abort(), ms);
                    return fetch(url, { ...opts, signal: c.signal })
                        .catch(err => {
                            if (err.name === 'AbortError') throw new Error('Request timed out. Please check your connection and try again.');
                            throw new Error('Unable to reach the server. Please check your internet connection.');
                        })
                        .finally(() => clearTimeout(t));
                };

                const sendingHTML = `
                    <div class="auto-quote-text">
                        <p><i class="fas fa-spinner fa-spin" aria-hidden="true"></i> Sending a verification code to <strong>${customerPhone.replace(/</g, '&lt;')}</strong>…</p>
                    </div>
                `;
                transition(sendingHTML, 'Verify Mobile');

                try {
                    const sendRes = await fetchT(API_BASE + '/api/send-verification', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ phone: customerPhone })
                    });
                    const sendData = await sendRes.json().catch(() => ({}));
                    if (!sendRes.ok) throw new Error(sendData.message || 'Unable to send SMS code.');
                } catch (err) {
                    // SMS not configured – submit without verification
                    const friendlyMsg = String(err.message || 'Unable to send verification code.').replace(/</g, '&lt;');
                    const errorHTML = `
                        <div class="auto-quote-text">
                            <p style="color: var(--secondary);">${friendlyMsg}</p>
                            <p style="margin-top: 16px; font-size: 0.9rem;">We'll process your quote without phone verification.</p>
                        </div>
                        <div class="auto-quote-actions" style="margin-top:16px;">
                            <button type="button" class="auto-quote-btn auto-quote-btn-yes" id="resilientContinueNoVerify">Continue</button>
                        </div>
                    `;
                    transition(errorHTML, 'Verification Unavailable');
                    window.setTimeout(() => {
                        document.getElementById('resilientContinueNoVerify')?.addEventListener('click', () => {
                            verified = false;
                            submitQuote();
                        });
                    }, 450);
                    return;
                }

                const codeHTML = `
                    <div class="auto-quote-text">
                        <p style="margin-bottom: 12px;">We've sent a <strong>4-digit code</strong> to <strong>${customerPhone.replace(/</g, '&lt;')}</strong>.</p>
                        <p style="font-size: 0.9rem; color: var(--text-light);">Enter it below to verify it's you.</p>
                    </div>
                    <div class="auto-quote-form">
                        <div class="auto-quote-form-group">
                            <label for="resilientSmsCode">Verification Code</label>
                            <input type="text" id="resilientSmsCode" maxlength="4" pattern="[0-9]{4}" inputmode="numeric" autocomplete="one-time-code" required placeholder="Enter 4-digit code" style="text-align:center; font-size:1.6rem; letter-spacing:0.5em; font-weight:700;" />
                        </div>
                        <button type="button" id="resilientSmsVerifyBtn" class="auto-quote-submit">Verify</button>
                        <p style="font-size: 0.85rem; color: var(--text-light); margin: 10px 0 0; text-align: center;">Didn't get a code? Close this and try again in a minute.</p>
                        <div class="auto-quote-feedback" id="resilientSmsFeedback" style="margin-top: 14px;"></div>
                    </div>
                `;

                transition(codeHTML, 'Verify Mobile');

                window.setTimeout(() => {
                    const codeInput = document.getElementById('resilientSmsCode');
                    const verifyBtn = document.getElementById('resilientSmsVerifyBtn');
                    const feedback = document.getElementById('resilientSmsFeedback');

                    codeInput?.focus();

                    verifyBtn?.addEventListener('click', async () => {
                        const code = (codeInput?.value || '').trim();
                        if (!code || code.length !== 4) {
                            if (feedback) {
                                feedback.textContent = 'Please enter the 4-digit code.';
                                feedback.className = 'auto-quote-feedback visible error';
                            }
                            return;
                        }
                        verifyBtn.disabled = true;
                        verifyBtn.textContent = 'Verifying…';
                        try {
                            const res = await fetchT(API_BASE + '/api/verify-code', {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({ phone: customerPhone, code })
                            });
                            const data = await res.json().catch(() => ({}));
                            if (!res.ok) throw new Error(data.message || 'Invalid code.');
                            verified = true;
                            submitQuote();
                        } catch (err) {
                            verifyBtn.disabled = false;
                            verifyBtn.textContent = 'Verify';
                            if (feedback) {
                                feedback.textContent = err.message || 'Verification failed.';
                                feedback.className = 'auto-quote-feedback visible error';
                            }
                        }
                    });
                }, 450);
            };

            const submitQuote = async () => {
                const html = `
                    <div class="auto-quote-text" style="padding: 18px 0;">
                        <div style="font-size: 42px; margin-bottom: 12px; color: var(--primary);"><i class="fas fa-seedling" aria-hidden="true"></i></div>
                        <p style="font-size: 1.1rem; font-weight: 700; margin-bottom: 8px;">Submitting…</p>
                        <p>Please wait a moment.</p>
                    </div>
                `;
                transition(html, 'Submitting');

                try {
                    const res = await fetch(`${API_BASE}/book`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            name: customerName,
                            time: selectedSlot,
                            location: selectedArea,
                            email: customerEmail,
                            phone: customerPhone,
                            service_type: serviceType,
                            photos: uploadedPhotos,
                            verified
                        })
                    });
                    const data = await res.json();
                    if (!res.ok) throw new Error(data?.message || 'Unable to submit your quote request.');

                    const success = `
                        <div class="auto-quote-text" style="padding: 24px 0;">
                            <div style="font-size: 64px; margin-bottom: 16px; color: var(--primary);"><i class="fas fa-seedling" aria-hidden="true"></i></div>
                            <p style="font-size: 1.3rem; font-weight: 700; color: var(--primary); margin-bottom: 12px;">Quote Request Received!</p>
                            <p style="margin-bottom: 20px;">${(data?.message || "Thank you! We'll be in touch soon.").replace(/</g, '&lt;')}</p>
                            <button type="button" class="auto-quote-btn auto-quote-btn-yes" id="autoQuoteDone">Close</button>
                        </div>
                    `;
                    transition(success, 'Success!');

                    window.setTimeout(() => {
                        document.getElementById('autoQuoteDone')?.addEventListener('click', close);
                    }, 450);
                } catch (err) {
                    const fail = `
                        <div class="auto-quote-text" style="padding: 18px 0;">
                            <div style="font-size: 48px; margin-bottom: 12px; color: var(--primary);"><i class="fas fa-seedling" aria-hidden="true"></i></div>
                            <p style="font-size: 1.1rem; font-weight: 700; margin-bottom: 8px;">Something went wrong</p>
                            <p style="margin-bottom: 16px;">${String(err.message || 'Unable to submit. Please try again.').replace(/</g, '&lt;')}</p>
                            <button type="button" class="auto-quote-btn auto-quote-btn-yes" id="autoQuoteBackToDetails">Back</button>
                        </div>
                    `;
                    transition(fail, 'Error');
                    window.setTimeout(() => {
                        document.getElementById('autoQuoteBackToDetails')?.addEventListener('click', showDetailsStep);
                    }, 450);
                }
            };

            // Ensure the "Yes" button always progresses (capture to avoid conflicts)
            btnYes?.addEventListener('click', (e) => {
                e.preventDefault();
                e.stopImmediatePropagation();
                showAreaStep();
            }, true);

            // Debug helper: add `?forceQuotePopup=1` to show instantly.
            const params = new URLSearchParams(window.location.search);
            if (params.has('forceQuotePopup')) {
                show();
                return;
            }

            // Timed popup disabled: only show via user action (or ?forceQuotePopup=1).
        })();
    </script>
    <script>
        (() => {
            if (window.__payAsYouMowLiveChatInitOk) return;

            const API_BASE = window.APP_API_BASE || window.location.origin || "https://booking-app-1-gh2v.onrender.com";
            const ENDPOINTS = {
                session: `${API_BASE}/chat/session`,
                send: `${API_BASE}/chat/send`,
                messages: `${API_BASE}/chat/messages`,
            };

            const widget = document.getElementById('liveChatWidget');
            const toggle = document.getElementById('liveChatToggle');
            const windowEl = document.getElementById('liveChatWindow');
            const closeBtn = document.getElementById('liveChatClose');
            const form = document.getElementById('liveChatForm');
            const input = document.getElementById('liveChatInput');
            const submit = document.getElementById('liveChatSubmit');
            const messagesEl = document.getElementById('liveChatMessages');
            const emptyState = document.getElementById('liveChatEmptyState');
            const statusBanner = document.getElementById('liveChatStatusBanner');
            if (!widget || !toggle || !windowEl) return;

            const storageKey = 'payAsYouMowLiveChatSessionId';
            let sessionId = '';
            let lastMessageId = 0;
            try {
                sessionId = localStorage.getItem(storageKey) || '';
            } catch {
                sessionId = '';
            }

            const open = () => {
                windowEl.classList.add('visible');
                windowEl.setAttribute('aria-hidden', 'false');
                toggle.setAttribute('aria-expanded', 'true');
            };
            const close = () => {
                windowEl.classList.remove('visible');
                windowEl.setAttribute('aria-hidden', 'true');
                toggle.setAttribute('aria-expanded', 'false');
            };
            const isOpen = () => windowEl.classList.contains('visible') || toggle.getAttribute('aria-expanded') === 'true';

            const showBanner = (text, kind = 'online') => {
                if (!statusBanner) return;
                statusBanner.textContent = text;
                statusBanner.classList.add('visible');
                statusBanner.classList.toggle('error', kind === 'error');
                statusBanner.classList.toggle('offline', kind === 'offline');
                statusBanner.classList.toggle('online', kind === 'online');
            };

            const createMessageEl = (message) => {
                if (!message || !messagesEl) return null;
                const sender = typeof message.sender === 'string' ? message.sender : 'visitor';
                const isAdmin = sender === 'admin' || sender === 'autopilot';
                const wrapper = document.createElement('div');
                wrapper.className = `live-chat-message ${isAdmin ? 'from-admin' : 'from-visitor'}`;
                if (sender === 'autopilot') wrapper.classList.add('autopilot');

                const bubble = document.createElement('div');
                bubble.className = 'message-bubble';
                bubble.textContent = message.text || '';
                wrapper.appendChild(bubble);

                const meta = document.createElement('span');
                meta.className = 'message-meta';
                meta.textContent = isAdmin ? 'Team' : 'You';
                wrapper.appendChild(meta);

                return wrapper;
            };

            const autopilotTypingQueue = Promise.resolve();
            let autopilotQueueChain = autopilotTypingQueue;

            const getRandomBetween = (minValue, maxValue) => {
                const minNum = Number(minValue);
                const maxNum = Number(maxValue);
                if (!Number.isFinite(minNum) || !Number.isFinite(maxNum) || maxNum <= minNum) {
                    return 0;
                }
                return minNum + Math.random() * (maxNum - minNum);
            };

            const getAutopilotTypingIndicatorDelay = () => getRandomBetween(2000, 7000);

            const getAutopilotTypingDelay = (text) => {
                const content = typeof text === 'string' ? text.trim() : '';
                const length = content.length;
                if (length <= 90) return getRandomBetween(2000, 4000);
                if (length <= 240) return getRandomBetween(3500, 6500);
                return getRandomBetween(5000, 8000);
            };

            const createAutopilotTypingIndicator = () => {
                const wrapper = document.createElement('div');
                wrapper.className = 'live-chat-message from-admin autopilot typing';

                const bubble = document.createElement('div');
                bubble.className = 'message-bubble';
                for (let index = 0; index < 3; index += 1) {
                    const dot = document.createElement('span');
                    dot.className = 'live-chat-typing-dot';
                    bubble.appendChild(dot);
                }
                wrapper.appendChild(bubble);

                const meta = document.createElement('span');
                meta.className = 'message-meta';
                meta.textContent = 'Agent is typing…';
                wrapper.appendChild(meta);

                return wrapper;
            };

            const appendMessage = (message, { allowTypingDelay = false } = {}) => {
                if (!messagesEl) return;
                if (emptyState) emptyState.classList.add('hidden');

                const sender = typeof message?.sender === 'string' ? message.sender : 'visitor';
                const isAutopilot = sender === 'autopilot';

                if (!allowTypingDelay || !isAutopilot) {
                    const el = createMessageEl(message);
                    if (!el) return;
                    messagesEl.appendChild(el);
                    messagesEl.scrollTop = messagesEl.scrollHeight;
                    return;
                }

                autopilotQueueChain = autopilotQueueChain.then(
                    () =>
                        new Promise((resolve) => {
                            const indicator = createAutopilotTypingIndicator();
                            const indicatorDelay = getAutopilotTypingIndicatorDelay();
                            const typingDelay = getAutopilotTypingDelay(message?.text);

                            const showIndicator = () => {
                                if (!messagesEl) return;
                                messagesEl.appendChild(indicator);
                                messagesEl.scrollTop = messagesEl.scrollHeight;
                            };

                            const showMessage = () => {
                                const el = createMessageEl(message);
                                if (indicator.parentNode && el) {
                                    indicator.replaceWith(el);
                                } else if (el && messagesEl) {
                                    messagesEl.appendChild(el);
                                } else if (indicator.parentNode) {
                                    indicator.remove();
                                }
                                if (messagesEl) {
                                    messagesEl.scrollTop = messagesEl.scrollHeight;
                                }
                                resolve();
                            };

                            window.setTimeout(showIndicator, indicatorDelay);
                            window.setTimeout(showMessage, indicatorDelay + typingDelay);
                        })
                );
            };

            const ensureSession = async () => {
                const res = await fetch(ENDPOINTS.session, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        session_id: sessionId,
                        page: window.location.pathname || '/',
                    }),
                });
                const data = await res.json();
                if (!res.ok) throw new Error(data?.message || 'Unable to start live chat.');

                if (data.session_id) {
                    sessionId = data.session_id;
                    try {
                        localStorage.setItem(storageKey, sessionId);
                    } catch {
                        // ignore
                    }
                }

                if (typeof data.online === 'boolean' && !data.online) {
                    showBanner("We're offline right now. Please use WhatsApp or the contact form.", 'offline');
                } else {
                    showBanner('Typically replies within a few minutes.', 'online');
                }

                if (Array.isArray(data.messages) && messagesEl) {
                    messagesEl.innerHTML = '';
                    lastMessageId = 0;
                    data.messages.forEach((m) => {
                        const idNum = Number(m?.id);
                        if (Number.isFinite(idNum)) lastMessageId = Math.max(lastMessageId, idNum);
                        appendMessage(m, { allowTypingDelay: false });
                    });
                }
            };

            const fetchUpdates = async () => {
                if (!sessionId) return;
                const params = new URLSearchParams({ session_id: sessionId, page: window.location.pathname || '/' });
                if (lastMessageId) params.set('after', String(lastMessageId));
                const res = await fetch(`${ENDPOINTS.messages}?${params.toString()}`);
                const data = await res.json();
                if (!res.ok) return;
                if (typeof data.online === 'boolean' && !data.online) {
                    showBanner("We're offline right now. Please use WhatsApp or the contact form.", 'offline');
                }
                if (Array.isArray(data.messages)) {
                    data.messages.forEach((m) => {
                        const idNum = Number(m?.id);
                        if (Number.isFinite(idNum)) lastMessageId = Math.max(lastMessageId, idNum);
                        appendMessage(m, { allowTypingDelay: true });
                    });
                }
            };

            const sendMessage = async (text) => {
                if (!text) return;
                if (!sessionId) {
                    await ensureSession();
                }

                appendMessage({ sender: 'visitor', text });

                const res = await fetch(ENDPOINTS.send, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        session_id: sessionId,
                        message: text,
                        page: window.location.pathname || '/',
                    }),
                });
                const data = await res.json();
                if (!res.ok) {
                    throw new Error(data?.message || 'Unable to send your message.');
                }
                if (data.entry) {
                    const idNum = Number(data.entry?.id);
                    if (Number.isFinite(idNum)) lastMessageId = Math.max(lastMessageId, idNum);
                }
                if (data.autopilot_entry) {
                    const idNum = Number(data.autopilot_entry?.id);
                    if (Number.isFinite(idNum)) lastMessageId = Math.max(lastMessageId, idNum);
                    appendMessage(data.autopilot_entry, { allowTypingDelay: true });
                } else {
                    // Pull any admin replies
                    await fetchUpdates();
                }
            };

            // If the main live-chat script is working, it will toggle the UI immediately.
            // This fallback only kicks in if nothing changed after the click.
            toggle.addEventListener(
                'click',
                () => {
                    const before = isOpen();
                    window.setTimeout(() => {
                        const after = isOpen();
                        if (after === before) {
                            before ? close() : open();
                            if (!before) {
                                ensureSession().catch((err) => {
                                    showBanner(err.message || 'Unable to start live chat.', 'error');
                                });
                            }
                        }
                    }, 0);
                },
                false
            );
            closeBtn?.addEventListener('click', () => close(), false);

            // Prevent full page reload on submit if the main handler didn't bind.
            if (form && form.dataset.liveChatBound !== '1') {
                form.dataset.liveChatBound = '1';
                form.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const text = (input?.value || '').trim();
                    if (!text) return;
                    if (submit) submit.disabled = true;
                    try {
                        await sendMessage(text);
                        if (input) input.value = '';
                    } catch (err) {
                        showBanner(err.message || 'Unable to send your message.', 'error');
                    } finally {
                        if (submit) submit.disabled = false;
                    }
                });
            }

            // Light polling while open
            window.setInterval(() => {
                if (isOpen()) {
                    fetchUpdates().catch(() => {});
                }
            }, 3500);
        })();
    </script>

    <!-- Preloader Script -->
    <script>
        (function() {
            const preloader = document.getElementById('preloader');
            const progressBar = document.querySelector('.progress-bar');
            const progressText = document.querySelector('.progress-text');
            
            const startTime = Date.now();
            const minimumDisplayTime = 3000; // 3 seconds minimum
            
            let progress = 0;
            const totalResources = document.images.length + document.querySelectorAll('link[rel="stylesheet"]').length;
            let loadedResources = 0;

            // Simulate initial progress
            const initialInterval = setInterval(() => {
                if (progress < 30) {
                    progress += Math.random() * 3;
                    updateProgress(progress);
                }
            }, 100);

            // Track actual resource loading
            const updateLoadProgress = () => {
                loadedResources++;
                const realProgress = 30 + (loadedResources / totalResources) * 60;
                progress = Math.max(progress, realProgress);
                updateProgress(progress);
            };

            // Monitor images
            Array.from(document.images).forEach(img => {
                if (img.complete) {
                    updateLoadProgress();
                } else {
                    img.addEventListener('load', updateLoadProgress);
                    img.addEventListener('error', updateLoadProgress);
                }
            });

            // Monitor stylesheets
            Array.from(document.querySelectorAll('link[rel="stylesheet"]')).forEach(link => {
                link.addEventListener('load', updateLoadProgress);
                link.addEventListener('error', updateLoadProgress);
            });

            function updateProgress(value) {
                const percent = Math.min(Math.floor(value), 100);
                progressBar.style.width = percent + '%';
                progressText.textContent = `Loading ${percent}%`;
            }

            function hidePreloader() {
                const elapsed = Date.now() - startTime;
                const remainingTime = Math.max(0, minimumDisplayTime - elapsed);
                
                setTimeout(() => {
                    preloader.classList.add('hidden');
                    setTimeout(() => {
                        preloader.style.display = 'none';
                    }, 500);
                }, remainingTime);
            }

            // Complete loading
            window.addEventListener('load', () => {
                clearInterval(initialInterval);
                progress = 100;
                updateProgress(100);
                hidePreloader();
            });

            // Fallback: hide after 8 seconds regardless (5s + 3s minimum)
            setTimeout(() => {
                if (!preloader.classList.contains('hidden')) {
                    progress = 100;
                    updateProgress(100);
                    hidePreloader();
                }
            }, 8000);
        })();
    </script>

    <!-- Testimonials: resilient loader (runs even if earlier scripts error) -->
    <script>
        (() => {
            const slider = document.getElementById('testimonialSlider');
            if (!slider) return;

            const initRotationFromDom = () => {
                const cards = Array.from(slider.querySelectorAll('.testimonial'));
                if (cards.length <= 1) {
                    return;
                }

                // Ensure nav + dots exist and are wired.
                let nav = slider.querySelector('.testimonial-nav');
                if (!nav) {
                    nav = document.createElement('div');
                    nav.className = 'testimonial-nav';
                    slider.appendChild(nav);
                }

                // Rebuild dots to guarantee correct count + click handlers.
                nav.innerHTML = '';
                const dots = cards.map((_, index) => {
                    const dot = document.createElement('span');
                    dot.className = 'testimonial-dot';
                    dot.dataset.index = String(index);
                    nav.appendChild(dot);
                    return dot;
                });

                const setActive = (index) => {
                    const nextIndex = ((index % cards.length) + cards.length) % cards.length;
                    cards.forEach((card, i) => card.classList.toggle('active', i === nextIndex));
                    dots.forEach((dot, i) => dot.classList.toggle('active', i === nextIndex));
                    return nextIndex;
                };

                let currentIndex = 0;
                const initiallyActive = cards.findIndex((card) => card.classList.contains('active'));
                currentIndex = setActive(initiallyActive >= 0 ? initiallyActive : 0);

                let timer = null;
                const start = () => {
                    if (timer) clearInterval(timer);
                    timer = setInterval(() => {
                        currentIndex = setActive(currentIndex + 1);
                    }, 5000);
                };

                dots.forEach((dot) => {
                    dot.addEventListener('click', () => {
                        const index = Number.parseInt(dot.dataset.index || '0', 10);
                        currentIndex = setActive(index);
                        start();
                    });
                });

                start();
            };

            // If testimonials already exist (server-rendered fallback or earlier script), wire up rotation.
            if (slider.querySelector('.testimonial')) {
                initRotationFromDom();
                return;
            }

            const showStatus = (message, isError = false) => {
                slider.innerHTML = '';
                const status = document.createElement('div');
                status.className = 'testimonial-status' + (isError ? ' error' : '');
                status.textContent = message;
                slider.appendChild(status);
            };

            const render = (reviews) => {
                slider.innerHTML = '';
                if (!Array.isArray(reviews) || reviews.length === 0) {
                    showStatus('No testimonials have been published yet.');
                    return;
                }

                const fragment = document.createDocumentFragment();
                const nav = document.createElement('div');
                nav.className = 'testimonial-nav';

                const cards = [];
                const dots = [];

                const setActive = (index) => {
                    const nextIndex = ((index % cards.length) + cards.length) % cards.length;
                    cards.forEach((card, i) => card.classList.toggle('active', i === nextIndex));
                    dots.forEach((dot, i) => dot.classList.toggle('active', i === nextIndex));
                    return nextIndex;
                };

                let currentIndex = 0;
                let timer = null;

                const start = () => {
                    if (timer) clearInterval(timer);
                    if (cards.length <= 1) return;
                    timer = setInterval(() => {
                        currentIndex = setActive(currentIndex + 1);
                    }, 5000);
                };

                reviews.forEach((review, index) => {
                    const card = document.createElement('div');
                    card.className = 'testimonial' + (index === 0 ? ' active' : '');

                    const quote = document.createElement('p');
                    quote.className = 'testimonial-text';
                    const quoteText = typeof review?.quote === 'string' ? review.quote.trim() : '';
                    quote.textContent = quoteText ? `“${quoteText}”` : '“A happy customer story will appear here.”';

                    const author = document.createElement('p');
                    author.className = 'testimonial-author';
                    const name = typeof review?.author === 'string' ? review.author.trim() : '';
                    const location = typeof review?.location === 'string' ? review.location.trim() : '';
                    const authorLine = [name, location].filter(Boolean).join(', ');
                    author.textContent = authorLine ? `- ${authorLine}` : '- Anonymous';

                    card.appendChild(quote);
                    card.appendChild(author);
                    fragment.appendChild(card);
                    cards.push(card);

                    if (reviews.length > 1) {
                        const dot = document.createElement('span');
                        dot.className = 'testimonial-dot' + (index === 0 ? ' active' : '');
                        dot.addEventListener('click', () => {
                            currentIndex = setActive(index);
                            start();
                        });
                        nav.appendChild(dot);
                        dots.push(dot);
                    }
                });

                slider.appendChild(fragment);
                if (reviews.length > 1) {
                    slider.appendChild(nav);
                }

                currentIndex = setActive(0);
                start();
            };

            const load = async () => {
                try {
                    showStatus('Loading testimonials…');
                    const url = new URL('/api/reviews', window.location.origin);
                    url.searchParams.set('_', Date.now().toString());
                    const res = await fetch(url.href, { cache: 'no-store' });
                    if (!res.ok) throw new Error('Unable to load testimonials.');
                    const data = await res.json();
                    const reviews = Array.isArray(data) ? data : (Array.isArray(data?.reviews) ? data.reviews : []);
                    render(reviews);
                } catch (err) {
                    console.warn('Testimonials loader failed:', err);
                    showStatus('Testimonials are unavailable at the moment.', true);
                }
            };

            load();
        })();
    </script>

    <!-- Mobile nav: resilient binder (ensures hamburger works even if other scripts fail) -->
    <script>
        (() => {
            try {
                const btn = document.getElementById('mobileMenuBtn');
                const navEl = document.getElementById('nav');
                const headerEl = document.getElementById('header');
                if (!btn || !navEl) return;
                if (btn.dataset.navToggleBound === '1') return;

                let backdrop = document.querySelector('.nav-backdrop');
                if (!backdrop) {
                    backdrop = document.createElement('div');
                    backdrop.className = 'nav-backdrop';
                    document.body.appendChild(backdrop);
                }

                const syncHeaderHeight = () => {
                    if (!headerEl) return;
                    const height = Math.max(0, Math.round(headerEl.getBoundingClientRect().height));
                    if (height) document.documentElement.style.setProperty('--header-height', `${height}px`);
                };

                const setOpen = (open) => {
                    const nextOpen = typeof open === 'boolean' ? open : !navEl.classList.contains('active');
                    navEl.classList.toggle('active', nextOpen);
                    document.body.classList.toggle('nav-open', nextOpen);
                    backdrop.classList.toggle('visible', nextOpen);
                    btn.setAttribute('aria-expanded', nextOpen ? 'true' : 'false');
                    btn.setAttribute('aria-label', nextOpen ? 'Close menu' : 'Open menu');
                    btn.innerHTML = nextOpen ? '<i class="fas fa-times"></i>' : '<i class="fas fa-bars"></i>';
                };

                btn.addEventListener('click', () => {
                    syncHeaderHeight();
                    setOpen();
                });

                // Ensure nav links actually navigate (and don't get trapped by nav-open scroll lock)
                if (!window.__payAsYouMowAnchorScrollBound) {
                    navEl.addEventListener('click', (event) => {
                        const link = event.target && event.target.closest ? event.target.closest('a[href^="#"]') : null;
                        if (!link) return;
                        const targetId = link.getAttribute('href');
                        if (!targetId || targetId === '#') return;

                        event.preventDefault();
                        event.stopPropagation();

                        const target = document.querySelector(targetId);

                        // Close the menu FIRST so overflow:hidden is removed.
                        syncHeaderHeight();
                        setOpen(false);

                        if (!target) return;

                        // setTimeout(100) gives the browser time to fully repaint
                        // and restore scrollY after removing overflow:hidden.
                        window.setTimeout(() => {
                            const headerH = headerEl ? Math.round(headerEl.getBoundingClientRect().height) : 92;
                            const top = Math.max(0, target.getBoundingClientRect().top + (window.scrollY || window.pageYOffset || 0) - headerH - 8);
                            window.scrollTo({ top, behavior: 'smooth' });
                        }, 100);
                    });
                    window.__payAsYouMowAnchorScrollBound = true;
                }

                backdrop.addEventListener('click', () => setOpen(false));
                document.addEventListener('keydown', (event) => {
                    if (event.key === 'Escape' && navEl.classList.contains('active')) {
                        setOpen(false);
                    }
                });

                syncHeaderHeight();
                window.addEventListener('resize', syncHeaderHeight);
                btn.dataset.navToggleBound = '1';
            } catch (e) {
                // Intentionally swallow to avoid breaking the page.
            }
        })();
    </script>

</body>
</html>
