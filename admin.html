<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Admin | Pay As You Mow Bookings</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet">
<style>
body{
  font-family:'Montserrat',sans-serif;
  background:linear-gradient(135deg,#74ABE2,#5563DE);
  color:#fff;
  margin:0;
  min-height:100vh;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:flex-start;
  padding:2rem 1rem;
}
h1{margin-top:0.5rem;}
#login-box{
  background:rgba(255,255,255,0.1);
  padding:2rem;
  border-radius:15px;
  box-shadow:0 4px 15px rgba(0,0,0,0.3);
  text-align:center;
  margin-top:5rem;
}
#login-box input{
  padding:10px;border:none;border-radius:8px;width:200px;margin:0.5rem 0;
}
#login-box button{
  background:#00C9A7;border:none;border-radius:8px;padding:10px 15px;
  color:#fff;cursor:pointer;font-weight:600;
}
#login-box button:hover{background:#00A387;}
#panel{display:none;width:100%;max-width:1000px;text-align:center;}
form.add-slot{
  background:rgba(255,255,255,0.15);
  padding:1rem;border-radius:12px;margin-top:1.5rem;
}
form.add-slot input,form.add-slot select,form.add-slot button{
  margin:0.3rem;
  padding:10px;
  border:none;
  border-radius:8px;
  font-size:1rem;
}
form.add-slot button{background:#00C9A7;color:#fff;cursor:pointer;}
form.add-slot button:hover{background:#00A387;}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:1rem;margin-top:1.5rem;}
.card{
  background:rgba(255,255,255,0.15);
  padding:1rem;
  border-radius:12px;
  box-shadow:0 4px 12px rgba(0,0,0,0.3);
}
.card h3{margin:0;color:#00FFB3;}
.logout{margin-top:1rem;cursor:pointer;text-decoration:underline;color:#00FFB3;}
</style>
</head>
<body>
<h1><i class="fa-solid fa-leaf"></i> Admin Bookings Panel</h1>

<div id="login-box">
  <p>Enter admin password</p>
  <input type="password" id="password" placeholder="Password">
  <button onclick="checkPassword()">Login</button>
  <p id="login-msg" style="color:#ffbaba;"></p>
</div>

<div id="panel">
  <h2>üóìÔ∏è Set Available Slots</h2>
  <form class="add-slot" onsubmit="addSlot(event)">
    <input type="date" id="slot-date" required>
    <select id="slot-time" required>
      <option value="18:00">6:00 PM</option>
      <option value="20:00">8:00 PM</option>
    </select>
    <button type="submit">Add Slot</button>
  </form>

  <h2 style="margin-top:2rem;">üìó Current Free Slots</h2>
  <div id="avail" class="grid"></div>

  <h2 style="margin-top:2rem;">üìò Booked Appointments</h2>
  <div id="bookings" class="grid"></div>

  <p class="logout" onclick="logout()">Log out</p>
</div>

<script>
const PASSWORD="891133kk";
const API="https://booking-app-p8q8.onrender.com";

function checkPassword(){
  const pass=document.getElementById("password").value.trim();
  if(pass===PASSWORD){
    document.getElementById("login-box").style.display="none";
    document.getElementById("panel").style.display="block";
    loadAll();
  }else{
    document.getElementById("login-msg").textContent="‚ùå Incorrect password";
  }
}
function logout(){
  document.getElementById("panel").style.display="none";
  document.getElementById("login-box").style.display="block";
  document.getElementById("password").value="";
}
async function addSlot(e){
  e.preventDefault();
  const date=document.getElementById("slot-date").value;
  const time=document.getElementById("slot-time").value;
  try{
    await fetch(`${API}/bookings`,{
      method:"POST",
      headers:{"Content-Type":"application/x-www-form-urlencoded"},
      body:`date=${date}&time=${time}`
    });
    loadAvailability();
    alert("‚úÖ Slot added!");
  }catch(err){alert("‚ùå Error adding slot.");}
}
async function loadAvailability(){
  const c=document.getElementById("avail");
  c.innerHTML="<p>Loading...</p>";
  try{
    const r=await fetch(`${API}/availability`);
    const data=await r.json();
    c.innerHTML="";
    if(data.length===0){c.innerHTML="<p>No available slots.</p>";return;}
    data.forEach(t=>{
      const div=document.createElement("div");
      div.className="card";
      div.innerHTML=`<h3>${t}</h3>`;
      c.appendChild(div);
    });
  }catch(e){c.innerHTML="<p>‚ùå Error loading slots.</p>";}
}
async function loadBookings(){
  const c=document.getElementById("bookings");
  c.innerHTML="<p>Loading...</p>";
  try{
    const r=await fetch(`${API}/bookings_json`);
    const data=await r.json();
    c.innerHTML="";
    if(!data.bookings||data.bookings.length===0){
      c.innerHTML="<p>No bookings yet.</p>";return;
    }
    data.bookings.forEach(b=>{
      const div=document.createElement("div");
      div.className="card";
      div.innerHTML=`<h3>${b.name||"Unknown"}</h3><p><i class='fa-regular fa-clock'></i> ${b.time||"‚Äì"}</p>`;
      c.appendChild(div);
    });
  }catch(e){c.innerHTML="<p>‚ùå Error loading bookings.</p>";}
}
function loadAll(){loadAvailability();loadBookings();}
</script>
</body>
</html>
